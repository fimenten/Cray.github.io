(()=>{"use strict";var e={859:(e,t,n)=>{n.d(t,{P:()=>d});var r=n(185),o=n(681),i=n(973),s=n(640),a=n(278),c=n(668),l=n(527);const d=new WeakMap;new Map,window.addEventListener("storage",(e=>{if("hidden"===document.visibilityState){const t=(0,r.Vf)("sessionId")||"trayData";e.key===`update_${t}`&&(0,o.loadFromIndexedDB)(t)}})),window.addEventListener("DOMContentLoaded",(()=>{return e=void 0,t=void 0,u=function*(){let e=(0,r.Vf)("sessionId");if("new"==e){let e=(0,r.lk)();window.location.replace(window.location.href.replace("?sessionId=new","?sessionId="+e))}if(e?yield(0,o.loadFromIndexedDB)(e):yield(0,o.loadFromIndexedDB)(),console.log("loaded"),e){const t=localStorage.getItem(e+"_title");t&&(document.title=t)}try{const e=yield c.j.getEnabledPlugins();for(const t of e)try{yield s.X.registerPlugin(t),console.log(`Plugin ${t.manifest.name} loaded successfully`)}catch(e){console.error(`Failed to load plugin ${t.manifest.name}:`,e)}}catch(e){console.error("Failed to initialize plugin system:",e)}try{console.log("Initializing sync indicator system"),l.O.initialize()}catch(e){console.error("Failed to initialize sync indicator system:",e)}try{console.log("Initializing global sync manager"),(0,a.zC)(),a.io.forceSyncCheck()}catch(e){console.error("Failed to initialize global sync manager:",e)}const t=(0,r.p0)();if(t){const e=d.get(t);e&&(yield(0,i.U2)(e),e.autoUpload&&(0,i.N)(e))}},new((n=void 0)||(n=Promise))((function(r,o){function i(e){try{a(u.next(e))}catch(e){o(e)}}function s(e){try{a(u.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}a((u=u.apply(e,t||[])).next())}));var e,t,n,u}))},830:(e,t,n)=>{n.d(t,{fK:()=>u,oo:()=>d});var r,o,i,s=n(935),a=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};!function(e){e.NAME="name",e.CHILDREN="children",e.PROPERTIES="properties",e.HOOKS="hooks",e.BORDER_COLOR="borderColor",e.FLEX_DIRECTION="flexDirection",e.DONE_STATUS="isDone",e.STRUCTURE="structure"}(r||(r={})),function(e){e.LOW="low",e.MEDIUM="medium",e.HIGH="high",e.CRITICAL="critical"}(o||(o={})),function(e){e.KEEP_LOCAL="keepLocal",e.KEEP_REMOTE="keepRemote",e.KEEP_BOTH="keepBoth",e.MANUAL_MERGE="manualMerge",e.AUTO_MERGE="autoMerge"}(i||(i={}));class c{static detectConflict(e,t,n,r){return a(this,void 0,void 0,(function*(){if(r){if(r(e)===r(t))return null}else if(JSON.stringify(e)===JSON.stringify(t))return null;const o=this.analyzeChanges(e,t,n),i=this.calculateSeverity(o,e,t);return 0===o.length?null:{tray:e,localVersion:r?r(e):JSON.stringify(e),remoteVersion:r?r(t):JSON.stringify(t),localTimestamp:this.getTimestamp(e),remoteTimestamp:this.getTimestamp(t),changeTypes:o,severity:i}}))}static analyzeChanges(e,t,n){const o=[];return e.name!==t.name&&o.push(r.NAME),this.compareChildren(e,t)||o.push(r.CHILDREN),this.compareProperties(e.properties,t.properties)||o.push(r.PROPERTIES),this.compareArrays(e.hooks,t.hooks)||o.push(r.HOOKS),e.borderColor!==t.borderColor&&o.push(r.BORDER_COLOR),e.flexDirection!==t.flexDirection&&o.push(r.FLEX_DIRECTION),e.isDone!==t.isDone&&o.push(r.DONE_STATUS),this.hasStructuralChanges(e,t)&&o.push(r.STRUCTURE),o}static calculateSeverity(e,t,n){return e.includes(r.STRUCTURE)||e.includes(r.CHILDREN)?o.HIGH:e.includes(r.NAME)||e.includes(r.PROPERTIES)||e.includes(r.HOOKS)?o.MEDIUM:(e.includes(r.BORDER_COLOR)||e.includes(r.FLEX_DIRECTION)||e.includes(r.DONE_STATUS),o.LOW)}static compareChildren(e,t){if(e.children.length!==t.children.length)return!1;for(let n=0;n<e.children.length;n++){const r=e.children[n],o=t.children[n];if(r.id!==o.id||r.name!==o.name)return!1}return!0}static compareProperties(e,t){if(!e&&!t)return!0;if(!e||!t)return!1;const n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(const r of n)if(e[r]!==t[r])return!1;return!0}static compareArrays(e,t){if(!e&&!t)return!0;if(!e||!t)return!1;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}static hasStructuralChanges(e,t){return e.parentId!==t.parentId||e.host_url!==t.host_url||e.filename!==t.filename}static getTimestamp(e){return new Date(e.created_dt).getTime()}}class l{static resolveConflict(e,t,n){return a(this,void 0,void 0,(function*(){try{const t=yield s.D.createPreConflictBackup(e.tray);console.log(`Pre-conflict backup created for ${e.tray.name}: ${t}`)}catch(t){console.warn(`Failed to create pre-conflict backup for ${e.tray.name}:`,t)}switch(t){case i.KEEP_LOCAL:return this.resolveKeepLocal(e);case i.KEEP_REMOTE:return this.resolveKeepRemote(e,n);case i.KEEP_BOTH:return this.resolveKeepBoth(e,n);case i.AUTO_MERGE:return this.resolveAutoMerge(e,n);case i.MANUAL_MERGE:return this.prepareManualMerge(e,n);default:throw new Error(`Unknown resolution strategy: ${t}`)}}))}static resolveKeepLocal(e){return a(this,void 0,void 0,(function*(){return{strategy:i.KEEP_LOCAL,resolvedTray:e.tray}}))}static resolveKeepRemote(e,t){return a(this,void 0,void 0,(function*(){return{strategy:i.KEEP_REMOTE,resolvedTray:t}}))}static resolveKeepBoth(e,t){return a(this,void 0,void 0,(function*(){const n=e.tray,r=` (Remote ${(new Date).toLocaleTimeString()})`;t.name=t.name+r;const o=e.changeTypes.map((e=>({type:e,localValue:this.getValueByChangeType(n,e),remoteValue:this.getValueByChangeType(t,e),path:`tray.${e}`})));return{strategy:i.KEEP_BOTH,resolvedTray:n,conflictMarkers:o}}))}static resolveAutoMerge(e,t){return a(this,void 0,void 0,(function*(){const n=Object.assign({},e.tray);for(const o of e.changeTypes)switch(o){case r.BORDER_COLOR:e.remoteTimestamp>e.localTimestamp&&(n.borderColor=t.borderColor);break;case r.DONE_STATUS:n.isDone=e.tray.isDone||t.isDone;break;case r.PROPERTIES:n.properties=Object.assign(Object.assign({},e.tray.properties),t.properties);break;case r.HOOKS:const o=[...e.tray.hooks,...t.hooks];n.hooks=[...new Set(o)];break;case r.NAME:e.remoteTimestamp>e.localTimestamp&&(n.name=t.name);break;case r.CHILDREN:case r.STRUCTURE:if(e.remoteTimestamp>e.localTimestamp)return{strategy:i.KEEP_REMOTE,resolvedTray:t}}return{strategy:i.AUTO_MERGE,resolvedTray:n}}))}static prepareManualMerge(e,t){return a(this,void 0,void 0,(function*(){const n=e.changeTypes.map((n=>({type:n,localValue:this.getValueByChangeType(e.tray,n),remoteValue:this.getValueByChangeType(t,n),path:`tray.${n}`})));return{strategy:i.MANUAL_MERGE,conflictMarkers:n}}))}static getValueByChangeType(e,t){switch(t){case r.NAME:return e.name;case r.CHILDREN:return e.children.map((e=>({id:e.id,name:e.name})));case r.PROPERTIES:return e.properties;case r.HOOKS:return e.hooks;case r.BORDER_COLOR:return e.borderColor;case r.FLEX_DIRECTION:return e.flexDirection;case r.DONE_STATUS:return e.isDone;case r.STRUCTURE:return{parentId:e.parentId,host_url:e.host_url,filename:e.filename};default:return null}}}class d{static handleSyncConflict(e,t,n,r){return a(this,void 0,void 0,(function*(){if("undefined"==typeof window||"undefined"!=typeof process||!window.location||"string"!=typeof window.location.href||0===window.location.href.length)return this.simpleTimestampResolution(e,t);const s=yield c.detectConflict(e,t,n,r);if(!s)return t;if(console.log(`Conflict detected for tray ${e.id}:`,{severity:s.severity,changes:s.changeTypes}),this.pendingConflicts.set(e.id,s),s.severity===o.LOW||s.severity===o.MEDIUM){const n=yield l.resolveConflict(s,i.AUTO_MERGE,t);if(n.resolvedTray)return this.pendingConflicts.delete(e.id),n.resolvedTray}throw new u(`Sync conflict detected for tray "${e.name}". Manual resolution required.`,s)}))}static getPendingConflicts(){return Array.from(this.pendingConflicts.values())}static resolvePendingConflict(e,t,n){return a(this,void 0,void 0,(function*(){const r=this.pendingConflicts.get(e);if(!r)throw new Error(`No pending conflict found for tray ${e}`);const o=yield l.resolveConflict(r,t,n);if(o.resolvedTray)return this.pendingConflicts.delete(e),o.resolvedTray;throw new Error(`Failed to resolve conflict for tray ${e}`)}))}static clearPendingConflicts(){this.pendingConflicts.clear()}static simpleTimestampResolution(e,t){const n=new Date(e.created_dt).getTime();return new Date(t.created_dt).getTime()>n?t:e}}d.pendingConflicts=new Map;class u extends Error{constructor(e,t){super(e),this.name="ConflictError",this.conflict=t}}},935:(e,t,n)=>{n.d(t,{D:()=>s});var r=n(527),o=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};class i{constructor(){this.BACKUP_STORAGE_KEY="tray_backups",this.MAX_BACKUPS_PER_TRAY=10,this.MAX_TOTAL_BACKUPS=100,this.BACKUP_CLEANUP_DAYS=30}static getInstance(){return i.instance||(i.instance=new i),i.instance}createBackup(e){return o(this,arguments,void 0,(function*(e,t="manual",n){try{const r=n?n(e):JSON.stringify(e),o=yield this.calculateChecksum(r),i={id:`backup_${e.id}_${Date.now()}`,timestamp:new Date,trayId:e.id,trayName:e.name,operation:t,data:r,checksum:o,metadata:{version:"1.0",size:r.length,childCount:this.countChildren(e)}};return yield this.storeBackup(i),console.log(`Backup created for tray ${e.name}: ${i.id}`),i.id}catch(e){throw console.error("Failed to create backup:",e),new Error(`Backup creation failed: ${e instanceof Error?e.message:"Unknown error"}`)}}))}validateTray(e){const t=[],n=[];e.id&&"string"==typeof e.id||t.push({type:"structure",message:"Tray ID is missing or invalid",trayId:e.id}),e.name&&"string"==typeof e.name||t.push({type:"structure",message:"Tray name is missing or invalid",trayId:e.id}),Array.isArray(e.children)||t.push({type:"structure",message:"Tray children array is invalid",trayId:e.id}),e.children&&Array.isArray(e.children)&&e.children.forEach(((n,r)=>{n&&"object"==typeof n?n.parentId!==e.id&&t.push({type:"reference",message:`Child ${n.id} has incorrect parentId`,trayId:e.id}):t.push({type:"reference",message:`Child at index ${r} is null or invalid`,trayId:e.id})})),!e.created_dt||e.created_dt instanceof Date||n.push({type:"data",message:"Created date is not a Date object",trayId:e.id}),e.borderColor&&!/^#[0-9A-Fa-f]{6}$/.test(e.borderColor)&&n.push({type:"data",message:"Border color format may be invalid",trayId:e.id});const r=this.countChildren(e);r>1e3&&n.push({type:"performance",message:`Large number of children (${r}) may impact performance`,trayId:e.id});const o=JSON.stringify(e).length;return o>1048576&&n.push({type:"performance",message:`Large tray size (${Math.round(o/1024)}KB) may impact sync performance`,trayId:e.id}),e.children&&Array.isArray(e.children)&&e.children.forEach((e=>{const r=this.validateTray(e);t.push(...r.errors),n.push(...r.warnings)})),{isValid:0===t.length,errors:t,warnings:n}}getRecoveryOptions(e){return o(this,void 0,void 0,(function*(){return(yield this.getBackupsForTray(e)).map((e=>({id:e.id,label:`${e.operation} - ${e.timestamp.toLocaleString()}`,description:`Backup from ${e.operation} operation at ${e.timestamp.toLocaleString()}`,backupEntry:e,riskLevel:this.assessRecoveryRisk(e)})))}))}recoverFromBackup(e,t){return o(this,void 0,void 0,(function*(){try{const n=yield this.getBackup(e);if(!n)throw new Error(`Backup ${e} not found`);if((yield this.calculateChecksum(n.data))!==n.checksum)throw new Error("Backup data integrity check failed - checksum mismatch");const o=t?t(n.data):JSON.parse(n.data),i=this.validateTray(o);if(!i.isValid){const e=i.errors.map((e=>e.message)).join(", ");throw new Error(`Recovered tray validation failed: ${e}`)}return console.log(`Successfully recovered tray ${o.name} from backup ${e}`),r.O.showSyncSuccess(`Recovered: ${o.name}`),o}catch(e){throw console.error("Recovery failed:",e),r.O.showSyncError("Recovery failed",e instanceof Error?e.message:"Unknown error"),e}}))}createPreSyncBackup(e,t){return o(this,void 0,void 0,(function*(){return this.createBackup(e,"pre-sync",t)}))}createPreConflictBackup(e,t){return o(this,void 0,void 0,(function*(){return this.createBackup(e,"pre-conflict",t)}))}cleanupBackups(){return o(this,void 0,void 0,(function*(){try{const e=yield this.getAllBackups(),t=Date.now()-24*this.BACKUP_CLEANUP_DAYS*60*60*1e3,n=e.filter((e=>e.timestamp.getTime()>t)),r=new Map,o=n.sort(((e,t)=>t.timestamp.getTime()-e.timestamp.getTime())).filter((e=>{const t=r.get(e.trayId)||0;return t<this.MAX_BACKUPS_PER_TRAY&&(r.set(e.trayId,t+1),!0)})).slice(0,this.MAX_TOTAL_BACKUPS);yield this.storeAllBackups(o);const i=e.length-o.length;console.log(`Backup cleanup completed: removed ${i} old backups`)}catch(e){console.error("Backup cleanup failed:",e)}}))}getBackupStats(){return o(this,void 0,void 0,(function*(){const e=yield this.getAllBackups(),t={totalBackups:e.length,totalSize:e.reduce(((e,t)=>e+t.data.length),0),oldestBackup:e.length>0?new Date(Math.min(...e.map((e=>e.timestamp.getTime())))):void 0,newestBackup:e.length>0?new Date(Math.max(...e.map((e=>e.timestamp.getTime())))):void 0,backupsByOperation:{}};return e.forEach((e=>{t.backupsByOperation[e.operation]=(t.backupsByOperation[e.operation]||0)+1})),t}))}calculateChecksum(e){return o(this,void 0,void 0,(function*(){const t=(new TextEncoder).encode(e),n=yield crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map((e=>e.toString(16).padStart(2,"0"))).join("")}))}countChildren(e){let t=e.children?e.children.length:0;return e.children&&e.children.forEach((e=>{t+=this.countChildren(e)})),t}storeBackup(e){return o(this,void 0,void 0,(function*(){const t=yield this.getAllBackups();t.push(e),yield this.storeAllBackups(t)}))}getAllBackups(){return o(this,void 0,void 0,(function*(){try{const e=localStorage.getItem(this.BACKUP_STORAGE_KEY);return e?JSON.parse(e).map((e=>Object.assign(Object.assign({},e),{timestamp:new Date(e.timestamp)}))):[]}catch(e){return console.error("Failed to load backups:",e),[]}}))}storeAllBackups(e){return o(this,void 0,void 0,(function*(){try{localStorage.setItem(this.BACKUP_STORAGE_KEY,JSON.stringify(e))}catch(e){throw console.error("Failed to store backups:",e),new Error("Failed to store backup data")}}))}getBackupsForTray(e){return o(this,void 0,void 0,(function*(){return(yield this.getAllBackups()).filter((t=>t.trayId===e)).sort(((e,t)=>t.timestamp.getTime()-e.timestamp.getTime()))}))}getBackup(e){return o(this,void 0,void 0,(function*(){return(yield this.getAllBackups()).find((t=>t.id===e))||null}))}assessRecoveryRisk(e){const t=(Date.now()-e.timestamp.getTime())/36e5;return t<1?"low":t<24?"medium":"high"}}i.instance=null;const s=i.getInstance();"undefined"!=typeof window&&setInterval((()=>{s.cleanupBackups()}),864e5)},669:(e,t,n)=>{n.d(t,{wC:()=>u,Ci:()=>h,rQ:()=>y,ql:()=>g,ii:()=>p,Lg:()=>l,Iz:()=>f});var r=n(681),o=n(627),i=n(185),s=n(896),a=n(598),c=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};function l(e){const t=(0,s.yr)(e.parentId);t&&(e.children.forEach((e=>{t.addChild(e)})),e.children.length=0,t.removeChild(e.id),e.element.remove(),t.element.focus(),(0,r.saveToIndexedDB)())}function d(e,t=0){let n=`${"  ".repeat(t)}- ${e.name}\n`;for(const r of e.children)n+=d(r,t+1);return n}function u(e){const t=d(e);navigator.clipboard&&navigator.clipboard.writeText(t).catch((()=>{}))}function p(e){const t=d(e),n=new Blob([t],{type:"text/markdown"}),r=document.createElement("a");r.href=URL.createObjectURL(n),r.download="tray_structure.md",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(r.href)}function h(e){const t=(0,r.serialize)((0,a.g)(e));navigator.clipboard.writeText(t)}function y(e){const t=(0,r.serialize)((0,a.g)(e));navigator.clipboard.writeText(t)}function f(e){return c(this,void 0,void 0,(function*(){if(navigator.clipboard.read)try{const t=yield navigator.clipboard.read();for(const n of t)for(const t of n.types)if(t.startsWith("image/")){const r=yield n.getType(t),s=URL.createObjectURL(r),a=new o.f(e.id,(0,i.lk)(),s);return void e.addChild(a)}}catch(e){}const t=yield navigator.clipboard.readText();try{let n=(0,r.deserialize)(t);if(!n)return;e.addChild(n)}catch(n){!function(e,t){const n=e.split(/\r?\n/).filter((e=>""!==e.trim())),r=[];for(const e of n){const n=e.match(/^(\s*)/),s=n?Math.floor(n[1].length/2):0,a=e.trim().replace(/^[-*]\s*/,""),c=0===s?t:r[s-1]||t,l=new o.f(c.id,(0,i.lk)(),a);c.addChild(l),r[s]=l,r.length=s+1}}(t,e)}}))}function g(e){const t=(0,s.yr)(e.parentId),n=t.children.findIndex((t=>t.id===e.id));t.removeChild(e.id),e.element.remove(),e.moveFocusAfterDelete(t,n),(0,r.saveToIndexedDB)()}},278:(e,t,n)=>{n.d(t,{io:()=>h,zC:()=>y});var r=n(973),o=n(185),i=n(859),s=n(33),a=n(569),c=n(830),l=n(527),d=n(935),u=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};class p{constructor(){this.syncInterval=null,this.syncQueue=[],this.activeSyncs=new Set,this.DEFAULT_SYNC_INTERVAL=6e4,this.MAX_CONCURRENT_SYNCS=3,this.MAX_RETRY_COUNT=3,this.isRunning=!1}static getInstance(){return p.instance||(p.instance=new p),p.instance}start(){if(this.isRunning)return;console.log("Starting global sync manager"),this.isRunning=!0,(0,r.H6)();const e="undefined"!=typeof window&&window.setInterval||setInterval;this.syncInterval=e((()=>{this.processSync()}),this.DEFAULT_SYNC_INTERVAL),this.processSync()}stop(){this.isRunning&&(console.log("Stopping global sync manager"),this.isRunning=!1,null!==this.syncInterval&&(clearInterval(this.syncInterval),this.syncInterval=null),this.syncQueue=[],this.activeSyncs.clear())}forceSyncCheck(){this.isRunning&&this.processSync()}queueTraySync(e,t=1){this.shouldSyncTray(e)&&(this.syncQueue=this.syncQueue.filter((t=>t.tray.id!==e.id)),this.syncQueue.push({tray:e,priority:t,retryCount:0}),this.syncQueue.sort(((e,t)=>t.priority-e.priority)))}removeTrayFromSync(e){this.syncQueue=this.syncQueue.filter((t=>t.tray.id!==e)),this.activeSyncs.delete(e)}getSyncStatus(){const e=i.P.get((0,o.p0)()),t=e?this.getAllNetworkTrays(e):[],n=t.filter((e=>this.shouldSyncTray(e)));return{isRunning:this.isRunning,queueLength:this.syncQueue.length,activeSyncs:this.activeSyncs.size,networkTrays:t.length,autoSyncTrays:n.length}}getResourceStats(){const e=200*this.syncQueue.length+100*this.activeSyncs.size;return{queueItems:this.syncQueue.length,activeSyncs:this.activeSyncs.size,intervalActive:null!=this.syncInterval,memoryEstimate:`~${e} bytes`}}performIntegrityCheck(){return u(this,void 0,void 0,(function*(){const e=i.P.get((0,o.p0)());if(!e)return{totalTrays:0,validTrays:0,invalidTrays:0,warnings:0,details:[]};const t=this.getAllNetworkTrays(e),n={totalTrays:t.length,validTrays:0,invalidTrays:0,warnings:0,details:[]};for(const e of t){const t=d.D.validateTray(e);n.details.push({trayId:e.id,trayName:e.name,isValid:t.isValid,errorCount:t.errors.length,warningCount:t.warnings.length}),t.isValid?n.validTrays++:n.invalidTrays++,n.warnings+=t.warnings.length}return console.log("Data integrity check completed:",n),n}))}getRecoveryOptions(e){return u(this,void 0,void 0,(function*(){return d.D.getRecoveryOptions(e)}))}recoverTrayFromBackup(e){return u(this,void 0,void 0,(function*(){try{const t=yield d.D.recoverFromBackup(e);console.log(`Successfully recovered tray ${t.name} from backup ${e}`),this.forceSyncCheck()}catch(e){throw console.error("Tray recovery failed:",e),e}}))}processSync(){return u(this,void 0,void 0,(function*(){const e=s.A.getState();(0,a.Q1)(e)&&(this.cleanupStaleItems(),this.discoverAndQueueTrays(),yield this.processQueue())}))}discoverAndQueueTrays(){const e=i.P.get((0,o.p0)());e&&this.getAllNetworkTrays(e).forEach((e=>{if(this.shouldSyncTray(e)&&!this.activeSyncs.has(e.id)){const t=this.calculatePriority(e);this.queueTraySync(e,t)}}))}processQueue(){return u(this,void 0,void 0,(function*(){const e=this.MAX_CONCURRENT_SYNCS-this.activeSyncs.size;if(e<=0)return;const t=this.syncQueue.splice(0,e);for(const e of t)this.processSyncItem(e)}))}processSyncItem(e){return u(this,void 0,void 0,(function*(){const{tray:t}=e;if(!this.activeSyncs.has(t.id)){this.activeSyncs.add(t.id);try{let e=null;try{e=yield d.D.createPreSyncBackup(t),console.log(`Pre-sync backup created for ${t.name}: ${e}`)}catch(e){console.warn(`Failed to create pre-sync backup for ${t.name}:`,e)}const n=d.D.validateTray(t);if(!n.isValid){const e=n.errors.map((e=>e.message)).join(", ");throw new Error(`Tray validation failed before sync: ${e}`)}n.warnings.length>0&&console.warn(`Tray validation warnings for ${t.name}:`,n.warnings),s.A.dispatch((0,a.II)({id:t.id,status:"syncing"})),yield(0,r.U2)(t),s.A.dispatch((0,a.II)({id:t.id,status:"synced"})),l.O.showSyncSuccess(`Synced: ${t.name}`),console.log(`Successfully synced tray: ${t.name} (${t.id})`)}catch(n){console.error(`Sync failed for tray ${t.name} (${t.id}):`,n),n instanceof c.fK?(console.log(`Conflict detected for tray ${t.name}, requiring manual resolution`),s.A.dispatch((0,a.II)({id:t.id,status:"error"})),s.A.dispatch((0,a.tz)(`Sync conflict: ${n.message}`)),l.O.showSyncError(`Conflict: ${t.name}`,"Manual resolution required")):(s.A.dispatch((0,a.II)({id:t.id,status:"error"})),s.A.dispatch((0,a.tz)(n instanceof Error?n.message:"Sync failed")),l.O.showSyncError(`Sync failed: ${t.name}`,n instanceof Error?n.message:"Unknown error"),e.retryCount++,e.lastAttempt=new Date,e.retryCount<this.MAX_RETRY_COUNT&&setTimeout((()=>{e.priority=Math.max(1,e.priority-1),this.syncQueue.push(e),this.syncQueue.sort(((e,t)=>t.priority-e.priority))}),this.calculateBackoffDelay(e.retryCount)))}finally{this.activeSyncs.delete(t.id)}}}))}shouldSyncTray(e){if(!e.host_url||!e.filename)return!1;const t=s.A.getState(),n=(0,a.B5)(t,e.id);return void 0!==n?n:e.autoUpload}getAllNetworkTrays(e){const t=[];return e.host_url&&e.filename&&t.push(e),e.children.forEach((e=>{t.push(...this.getAllNetworkTrays(e))})),t}calculatePriority(e){var t;let n=1;const r=Date.now(),o=(r-((null===(t=e.created_dt)||void 0===t?void 0:t.getTime())||r))/864e5;return o<1?n+=3:o<7?n+=2:o<30&&(n+=1),e.children.length>0&&(n+=Math.min(e.children.length,3)),e.hooks&&e.hooks.length>0&&(n+=2),n}calculateBackoffDelay(e){return Math.min(1e3*Math.pow(2,e),3e4)}cleanupStaleItems(){const e=Date.now();this.syncQueue=this.syncQueue.filter((t=>!(t.lastAttempt&&e-t.lastAttempt.getTime()>6e5)||(console.log(`Removing stale queue item for tray ${t.tray.id}`),!1))),this.syncQueue.length>100&&(console.log(`Queue size ${this.syncQueue.length} exceeds limit, trimming to 100`),this.syncQueue=this.syncQueue.slice(0,100)),Array.from(this.activeSyncs).forEach((e=>{const t=i.P.get((0,o.p0)());t&&(this.getAllNetworkTrays(t).some((t=>t.id===e))||(console.log(`Cleaning up orphaned active sync for tray ${e}`),this.activeSyncs.delete(e)))}))}}p.instance=null;const h=p.getInstance();function y(){if("undefined"!=typeof window){const e=s.A.getState();(0,a.Q1)(e)&&h.start()}}s.A.subscribe((()=>{const e=s.A.getState(),t=(0,a.Q1)(e);t&&!h.getSyncStatus().isRunning?h.start():!t&&h.getSyncStatus().isRunning&&h.stop()})),"undefined"!=typeof window&&window.addEventListener("beforeunload",(()=>{h.stop()}))},20:(e,t,n)=>{n.d(t,{$R:()=>F,T0:()=>D,qb:()=>R,jG:()=>B,km:()=>x,o1:()=>w,mT:()=>H});var r=n(185),o=n(598),i=n(896),s=n(681),a=n(859),c=n(627),l=n(973),d=n(669),u=n(569),p=n(640),h=n(668),y=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};function f(){console.log("showPluginManagerDialog called");const e=document.createElement("div");e.classList.add("plugin-manager-dialog"),e.style.cssText="\n    position: fixed;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    background: white;\n    border: 1px solid #ccc;\n    border-radius: 8px;\n    padding: 20px;\n    z-index: 10000;\n    width: 90vw;\n    max-width: 900px;\n    min-width: 320px;\n    max-height: 80vh;\n    overflow-y: auto;\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);\n  ",e.innerHTML='\n    <h3>Plugin Manager</h3>\n    <div style="margin-bottom: 20px;">\n      <button id="add-plugin-btn" style="padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">Add New Plugin</button>\n    </div>\n    <div id="plugins-list" style="max-height: 50vh; overflow-y: auto;">\n      <div style="text-align: center; color: #999; padding: 20px;">Loading plugins...</div>\n    </div>\n    <div style="margin-top: 15px; text-align: right;">\n      <button id="close-plugin-manager" style="padding: 8px 16px; background: #f0f0f0; border: 1px solid #ccc; border-radius: 4px; cursor: pointer;">Close</button>\n    </div>\n  ',document.body.appendChild(e),console.log("Dialog added to body");const t=e.querySelector("#plugins-list"),n=e.querySelector("#close-plugin-manager"),r=e.querySelector("#add-plugin-btn");function o(){return y(this,void 0,void 0,(function*(){console.log("Loading plugins list...");try{const e=yield h.j.getAllPlugins();if(console.log("Plugins loaded:",e.length),0===e.length)t.innerHTML='<div style="text-align: center; color: #999; padding: 20px;">No plugins installed. Click "Add New Plugin" to get started.</div>';else{t.innerHTML="";for(const n of e){const e=i(n);t.appendChild(e)}}}catch(e){t.innerHTML='<div style="text-align: center; color: red; padding: 20px;">Error loading plugins</div>',console.error("Failed to load plugins:",e)}}))}function i(e){var t;const n=document.createElement("div");n.style.cssText=`\n      margin-bottom: 15px;\n      padding: 15px;\n      border: 1px solid #ddd;\n      border-radius: 6px;\n      background: ${e.enabled?"#f0fff4":"#f8f9fa"};\n    `;const r=(null===(t=e.manifest.permissions)||void 0===t?void 0:t.join(", "))||"None";n.innerHTML=`\n      <div style="display: flex; justify-content: space-between; align-items: center;">\n        <div>\n          <h4 style="margin: 0 0 5px 0;">${e.manifest.name} v${e.manifest.version}</h4>\n          <p style="margin: 0 0 5px 0; color: #666;">${e.manifest.description||"No description"}</p>\n          <p style="margin: 0; font-size: 0.9em; color: #999;">\n            Permissions: ${r} | \n            Installed: ${new Date(e.installDate).toLocaleDateString()}\n          </p>\n        </div>\n        <div style="display: flex; gap: 10px;">\n          <button class="toggle-plugin" data-id="${e.id}" style="\n            padding: 6px 12px;\n            background: ${e.enabled?"#dc3545":"#28a745"};\n            color: white;\n            border: none;\n            border-radius: 4px;\n            cursor: pointer;\n          ">${e.enabled?"Disable":"Enable"}</button>\n          <button class="edit-plugin" data-id="${e.id}" style="\n            padding: 6px 12px;\n            background: #007bff;\n            color: white;\n            border: none;\n            border-radius: 4px;\n            cursor: pointer;\n          ">Edit</button>\n          <button class="delete-plugin" data-id="${e.id}" style="\n            padding: 6px 12px;\n            background: #6c757d;\n            color: white;\n            border: none;\n            border-radius: 4px;\n            cursor: pointer;\n          ">Delete</button>\n        </div>\n      </div>\n    `;const i=n.querySelector(".toggle-plugin"),s=n.querySelector(".edit-plugin"),a=n.querySelector(".delete-plugin");return i.addEventListener("click",(()=>y(this,void 0,void 0,(function*(){try{const t=!e.enabled;yield h.j.updatePluginStatus(e.id,t),t?yield p.X.registerPlugin(e):yield p.X.unregisterPlugin(e.id),yield o()}catch(t){alert(`Failed to ${e.enabled?"disable":"enable"} plugin: ${t instanceof Error?t.message:String(t)}`)}})))),s.addEventListener("click",(()=>{g(e)})),a.addEventListener("click",(()=>y(this,void 0,void 0,(function*(){if(confirm(`Are you sure you want to delete "${e.manifest.name}"?`))try{yield p.X.unregisterPlugin(e.id),yield h.j.deletePlugin(e.id),yield o()}catch(e){alert(`Failed to delete plugin: ${e instanceof Error?e.message:String(e)}`)}})))),n}function s(e){"Escape"===e.key&&c()}function a(t){e.contains(t.target)||c()}function c(){document.removeEventListener("keydown",s),document.removeEventListener("click",a),e.remove()}console.log("Dialog elements found:",{pluginsList:!!t,closeButton:!!n,addPluginButton:!!r}),o(),r.addEventListener("click",(()=>{g(null)})),n.addEventListener("click",(()=>{c()})),document.addEventListener("keydown",s),setTimeout((()=>{document.addEventListener("click",a)}),100),e.addEventListener("click",(e=>{e.stopPropagation()}))}function g(e){var t,n,r,o;const i=!e,s=document.createElement("div");s.classList.add("plugin-editor-dialog"),s.style.cssText="\n    position: fixed;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    background: white;\n    border: 1px solid #ccc;\n    border-radius: 8px;\n    padding: 20px;\n    z-index: 10001;\n    width: 90vw;\n    max-width: 900px;\n    min-width: 320px;\n    max-height: 90vh;\n    overflow-y: auto;\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);\n  ",s.innerHTML=`\n    <h3>${i?"Add New Plugin":"Edit Plugin"}</h3>\n    <form id="plugin-form">\n      <div style="margin-bottom: 15px;">\n        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Plugin ID:</label>\n        <input type="text" id="plugin-id" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;" \n          value="${(null==e?void 0:e.manifest.id)||""}" ${i?"":"readonly"}>\n      </div>\n      \n      <div style="margin-bottom: 15px;">\n        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Name:</label>\n        <input type="text" id="plugin-name" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;"\n          value="${(null==e?void 0:e.manifest.name)||""}">\n      </div>\n      \n      <div style="margin-bottom: 15px;">\n        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Version:</label>\n        <input type="text" id="plugin-version" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;"\n          value="${(null==e?void 0:e.manifest.version)||"1.0.0"}">\n      </div>\n      \n      <div style="margin-bottom: 15px;">\n        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Description:</label>\n        <textarea id="plugin-description" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; min-height: 60px;">${(null==e?void 0:e.manifest.description)||""}</textarea>\n      </div>\n      \n      <div style="margin-bottom: 15px;">\n        <label style="display: block; margin-bottom: 5px; font-weight: bold;">Permissions:</label>\n        <div style="display: flex; gap: 15px; flex-wrap: wrap;">\n          <label><input type="checkbox" name="permissions" value="storage" ${(null===(t=null==e?void 0:e.manifest.permissions)||void 0===t?void 0:t.includes("storage"))?"checked":""}> Storage</label>\n          <label><input type="checkbox" name="permissions" value="network" ${(null===(n=null==e?void 0:e.manifest.permissions)||void 0===n?void 0:n.includes("network"))?"checked":""}> Network</label>\n          <label><input type="checkbox" name="permissions" value="clipboard" ${(null===(r=null==e?void 0:e.manifest.permissions)||void 0===r?void 0:r.includes("clipboard"))?"checked":""}> Clipboard</label>\n          <label><input type="checkbox" name="permissions" value="notifications" ${(null===(o=null==e?void 0:e.manifest.permissions)||void 0===o?void 0:o.includes("notifications"))?"checked":""}> Notifications</label>\n        </div>\n      </div>\n      \n      <div style="margin-bottom: 15px;">\n        <label style="display: block; margin-bottom: 5px; font-weight: bold;">\n          Plugin Code:\n          <span style="font-weight: normal; color: #666; font-size: 0.9em;">\n            (JavaScript object with hooks)\n          </span>\n        </label>\n        <textarea id="plugin-code" required style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; min-height: 300px; font-family: monospace; font-size: 13px;">${(null==e?void 0:e.code)||"{\n  hooks: {\n    onTaskHooked: async (task, context) => {\n      console.log('Task hooked:', task.text);\n      \n      // Example: Send notification\n      if (api.notifications) {\n        await api.notifications.show('Task Added', {\n          body: `New task: ${task.text}`\n        });\n      }\n      \n      // Example: Store task data\n      if (api.storage) {\n        const tasks = await api.storage.get('hooked_tasks') || [];\n        tasks.push(task);\n        await api.storage.set('hooked_tasks', tasks);\n      }\n    },\n    \n    onTaskCompleted: async (task, context) => {\n      console.log('Task completed:', task.text);\n    }\n  }\n}"}</textarea>\n      </div>\n      \n      <div style="display: flex; gap: 10px; justify-content: flex-end;">\n        <button type="button" id="cancel-btn" style="padding: 8px 16px; background: #f0f0f0; border: 1px solid #ccc; border-radius: 4px; cursor: pointer;">Cancel</button>\n        <button type="submit" style="padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">Save Plugin</button>\n      </div>\n    </form>\n  `,document.body.appendChild(s);const a=s.querySelector("#plugin-form"),c=s.querySelector("#cancel-btn");a.addEventListener("submit",(t=>y(this,void 0,void 0,(function*(){t.preventDefault();const n=new FormData(a),r=Array.from(n.getAll("permissions")),o={id:s.querySelector("#plugin-id").value,name:s.querySelector("#plugin-name").value,version:s.querySelector("#plugin-version").value,description:s.querySelector("#plugin-description").value,permissions:r},c=s.querySelector("#plugin-code").value;try{if(new Function("api",c),i)yield h.j.installPlugin(o,c),alert("Plugin installed successfully!");else{const t=Object.assign(Object.assign({},e),{manifest:o,code:c,lastUpdated:Date.now()});yield h.j.savePlugin(t),t.enabled&&(yield p.X.unregisterPlugin(t.id),yield p.X.registerPlugin(t)),alert("Plugin updated successfully!")}s.remove();const t=document.querySelector(".plugin-manager-dialog");t&&(t.remove(),f())}catch(e){alert(`Plugin validation failed: ${e instanceof Error?e.message:String(e)}`)}})))),c.addEventListener("click",(()=>{s.remove()})),s.addEventListener("click",(e=>{e.stopPropagation()}))}var m=n(33),v=n(278),b=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};function w(e){if(0===e.length)return;const t=document.createElement("div");t.classList.add("hook-notification"),t.style.cssText="\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    background: #28a745;\n    color: white;\n    padding: 12px 16px;\n    border-radius: 6px;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n    z-index: 10001;\n    font-size: 14px;\n    max-width: 300px;\n    animation: slideInRight 0.3s ease-out;\n  ";const n=e.map((e=>`@${e}`)).join(", ");t.innerHTML=`\n    <div style="display: flex; align-items: center; gap: 8px;">\n      <span>🏷️</span>\n      <span>Task added with hooks: ${n}</span>\n    </div>\n  `,document.body.appendChild(t),setTimeout((()=>{t.style.animation="slideOutRight 0.3s ease-in",setTimeout((()=>{t.parentNode&&t.parentNode.removeChild(t)}),300)}),3e3)}let x=[];function k(e){try{const t=new URL(e);let n=t.origin;return t.pathname&&"/"!==t.pathname&&(n+=t.pathname.replace(/\/$/,"")),n}catch(t){return e.trim().replace(/\/$/,"")}}const E=[{action:"search",label:"🔍 Search Trays"},{action:"autoSyncSettings",label:"🔄 Auto-Sync Settings"},{action:"reset",label:"トレイをリセット"},{action:"save",label:"現在の状態を保存"},{action:"load",label:"保存した状態を読み込む"},{action:"export",label:"データのエクスポート"},{action:"import",label:"データのインポート"},{action:"set_default_server",label:"set_default_server"},{action:"manage_server_passwords",label:"Manage Server Passwords"},{action:"import_network_tray_directly_as_root",label:"import_network_tray_directly_as_root"},{action:"editTitle",label:"ページタイトルを編集"},{action:"uploadAll",label:"Upload All"},{action:"downloadAll",label:"Download All"},{action:"editSessionId",label:"セッションIDを編集"},{action:"newSession",label:"New Session"},{action:"temporalTray",label:"Temporal Tray"},{action:"pluginManager",label:"🔌 Plugin Manager"}],S=[{action:"copySelected",label:"Copy selected"},{action:"cutSelected",label:"Cut selected"}];function T(e,t){t.forEach((({action:t,label:n})=>{const r=document.createElement("div");r.classList.add("menu-item"),r.dataset.action=t,r.textContent=n,e.appendChild(r)}))}function C(){x=[],document.querySelectorAll(".tray-checkbox").forEach((e=>{e.checked=!1}))}function D(){const e=document.createElement("div");e.classList.add("left-bar"),document.body.appendChild(e);const t=document.createElement("div");t.classList.add("hamburger-menu"),t.innerHTML="☰",e.appendChild(t);const n=document.createElement("div");n.classList.add("session-list-button"),n.innerHTML="📑",e.appendChild(n),n.addEventListener("click",P);const r=document.createElement("div");r.classList.add("selection-menu-button"),r.innerHTML="✔",e.appendChild(r);const i=document.createElement("div");i.classList.add("hook-view-button"),i.innerHTML="🏷️",e.appendChild(i),i.addEventListener("click",H);const a=document.createElement("div");a.classList.add("selection-menu-items"),a.style.display="none",e.appendChild(a),a.style.position="fixed",T(a,S);const c=document.createElement("div");c.classList.add("hamburger-menu-items"),c.style.display="none",e.appendChild(c),c.style.position="fixed",T(c,E),document.body.appendChild(c);const l=c.querySelectorAll(".menu-item");l.forEach((e=>{e.style.padding="5px 10px",e.style.cursor="pointer",e.style.transition="background-color 0.3s"})),t.addEventListener("click",(t=>{if(c.style.display="none"===c.style.display?"block":"none","block"===c.style.display){const t=e.getBoundingClientRect();c.style.left=`${t.right}px`,c.style.top=`${t.top}px`}t.stopPropagation()})),r.addEventListener("click",(t=>{if(a.style.display="none"===a.style.display?"block":"none","block"===a.style.display){const t=e.getBoundingClientRect();a.style.left=`${t.right}px`,a.style.top=`${t.top}px`}t.stopPropagation()})),document.addEventListener("click",(e=>{const n=e.target;c.contains(n)||n===t||a.contains(n)||n===r||(c.style.display="none",a.style.display="none")}));const d={search:q,autoSyncSettings:K,reset:()=>{confirm("すべてのトレイをリセットしますか？この操作は元に戻せません。")&&function(){localStorage.removeItem("trayData");const e=(0,o.e)();document.body.innerHTML="",document.body.appendChild(e.element),D()}()},export:s.exportData,import:s.importData,set_default_server:M,manage_server_passwords:j,editTitle:_,uploadAll:()=>I(),downloadAll:()=>L(),editSessionId:A,newSession:O,temporalTray:N,cutSelected:R,copySelected:F,pluginManager:f};return c.addEventListener("click",(e=>{const t=e.target.getAttribute("data-action")||"",n=d[t];n&&n(),c.style.display="none"})),a.addEventListener("click",(e=>{const t=e.target.getAttribute("data-action")||"",n=d[t];n&&n(),a.style.display="none"})),l.forEach((e=>{e.addEventListener("mouseover",(()=>{e.style.backgroundColor="#f0f0f0"})),e.addEventListener("mouseout",(()=>{e.style.backgroundColor="transparent"}))})),{hamburger:t,menu:c,selectionMenu:a,leftBar:e}}function _(){const e=document.title,t=prompt("新しいページタイトルを入力してください:",e);if(null!==t&&""!==t.trim()){document.title=t.trim();const e=(0,r.Vf)("sessionId");e&&(localStorage.setItem(e+"_title",t.trim()),alert("ページタイトルを更新しました。"))}}function A(){const e=(0,r.Vf)("sessionId"),t=prompt("新しいセッションIDを入力してください:",e||"");t&&""!==t.trim()&&(window.location.href=`${window.location.pathname}?sessionId=${t.trim()}`)}function I(e=null){e||(e=a.P.get((0,r.p0)())),e.host_url&&(0,l.CW)(e),e.children.length&&e.children.map((e=>I(e)))}function L(e=null){e||(e=a.P.get((0,r.p0)())),e.host_url&&(0,l.XF)(e),e.children.length&&e.children.map((e=>L(e)))}function P(){return b(this,void 0,void 0,(function*(){const e=(yield(0,s.getAllSessionIds)()).filter((e=>"trayData"!==e)),t=document.createElement("div");t.classList.add("session-selection-dialog"),t.innerHTML=`\n      <h3>Sessions</h3>\n      <select id="session-select">\n        ${e.map((e=>`<option value="${e}">${e}</option>`)).join("")}\n      </select>\n      <button id="session-open">Open</button>\n      <button id="session-cancel">Cancel</button>\n    `,document.body.appendChild(t);const n=t.querySelector("#session-open"),r=t.querySelector("#session-cancel"),o=t.querySelector("#session-select");n.addEventListener("click",(()=>{const e=o.value;e&&(window.location.href=`${window.location.pathname}?sessionId=${e}`)})),r.addEventListener("click",(()=>t.remove()))}))}function O(){const e=(0,r.lk)();window.open(`${window.location.pathname}?sessionId=${e}`,"_blank")}const $="temp-global";function N(){window.open(`${window.location.pathname}?sessionId=${$}`,"_blank")}function M(){let e=localStorage.getItem("defaultServer");e=prompt("set default URL",e||""),e&&localStorage.setItem("defaultServer",k(e))}function R(){if(0!==x.length){const e=new c.f((0,r.lk)(),(0,r.lk)(),"selected Trays");x.forEach((t=>e.children.push((0,o.g)(t)))),(0,d.Ci)(e),x.forEach((e=>(0,d.ql)(e))),C()}}function F(){if(0!==x.length){const e=new c.f((0,r.lk)(),(0,r.lk)(),"selected Trays");x.forEach((t=>e.children.push((0,o.g)(t)))),(0,d.Ci)(e),C()}}function B(){0!==x.length&&(x.forEach((e=>(0,d.ql)(e))),C())}function j(){const e=JSON.parse(localStorage.getItem("serverPasswords")||"{}"),t=document.createElement("div");function n(){const n=t.querySelector("#server-list");n.innerHTML="",Object.entries(e).forEach((([e])=>{const t=document.createElement("div");t.style.cssText="display: flex; align-items: center; margin-bottom: 10px; padding: 10px; border: 1px solid #eee; border-radius: 4px;",t.innerHTML=`\n        <span style="flex: 1; font-weight: bold;">${e}</span>\n        <span style="flex: 1; font-family: monospace;">••••••••</span>\n        <button class="edit-btn" data-server="${e}" style="margin-left: 10px;">Edit</button>\n        <button class="delete-btn" data-server="${e}" style="margin-left: 5px;">Delete</button>\n      `,n.appendChild(t)}))}t.classList.add("server-password-dialog"),t.style.cssText="\n    position: fixed;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    background: white;\n    border: 1px solid #ccc;\n    border-radius: 8px;\n    padding: 20px;\n    z-index: 10000;\n    width: 90vw;\n    max-width: 600px;\n    min-width: 320px;\n    max-height: 70vh;\n    overflow-y: auto;\n  ",t.innerHTML='\n    <h3>Manage Server Passwords</h3>\n    <div id="server-list"></div>\n    <div style="margin-top: 15px;">\n      <input type="text" id="new-server" placeholder="Server URL" style="width: 200px; margin-right: 10px;">\n      <input type="password" id="new-password" placeholder="Password" style="width: 150px; margin-right: 10px;">\n      <button id="add-server">Add</button>\n    </div>\n    <div style="margin-top: 15px;">\n      <button id="close-dialog">Close</button>\n    </div>\n  ',document.body.appendChild(t),n(),t.addEventListener("click",(r=>{const o=r.target;if(o.classList.contains("delete-btn")){const t=o.getAttribute("data-server");confirm(`Delete password for ${t}?`)&&(delete e[t],localStorage.setItem("serverPasswords",JSON.stringify(e)),n())}if(o.classList.contains("edit-btn")){const t=o.getAttribute("data-server"),r=prompt(`Enter new password for ${t}:`,"");null!==r&&(e[t]=r,localStorage.setItem("serverPasswords",JSON.stringify(e)),n())}if("add-server"===o.id){const r=t.querySelector("#new-server"),o=t.querySelector("#new-password"),i=r.value.trim(),s=o.value;if(i&&s){const t=k(i);e[t]=s,localStorage.setItem("serverPasswords",JSON.stringify(e)),r.value="",o.value="",n()}else alert("Please enter both server URL and password")}"close-dialog"===o.id&&t.remove()}))}function U(e){const t=[],n=new Set;return function e(r){if(r&&!n.has(r.id)&&(n.add(r.id),t.push(r),r.children&&Array.isArray(r.children)))for(const t of r.children)e(t)}(e),t}function z(e){console.log("expandAllParentsAndFocus called for:",e.name,e.id);try{if(!a.P.get((0,r.p0)()))return void console.log("No root tray found");const t=[],n=new Set;let o=e;for(;o&&o.parentId&&!n.has(o.id);){n.add(o.id);const e=(0,i.yr)(o.parentId);if(!e||n.has(e.id))break;t.push(e),o=e}console.log("Path to root:",t.map((e=>e.name))),t.reverse().forEach((e=>{e.isFolded&&(console.log("Expanding parent:",e.name),e.isFolded=!1,e.updateAppearance())})),(0,s.saveToIndexedDB)(),console.log("Focusing and scrolling to:",e.name),(0,u.Go)(e),setTimeout((()=>{e.element.focus(),e.element.scrollIntoView({behavior:"smooth",block:"center"})}),100)}catch(e){console.error("Error in expandAllParentsAndFocus:",e)}}function q(){const e=a.P.get((0,r.p0)());if(!e)return;const t=document.createElement("div");t.classList.add("search-dialog"),t.style.cssText="\n    position: fixed;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    background: white;\n    border: 1px solid #ccc;\n    border-radius: 8px;\n    padding: 20px;\n    z-index: 10000;\n    width: 90vw;\n    max-width: 600px;\n    min-width: 320px;\n    max-height: 70vh;\n    overflow-y: auto;\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);\n  ",t.innerHTML='\n    <h3>Search Trays</h3>\n    <div style="margin-bottom: 15px;">\n      <input type="text" id="search-input" placeholder="Enter search term..." \n             style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 16px;">\n    </div>\n    <div id="search-results" style="max-height: 300px; overflow-y: auto; border: 1px solid #eee; border-radius: 4px; padding: 10px;">\n      <div style="text-align: center; color: #999; padding: 20px;">Enter a search term to find trays</div>\n    </div>\n    <div style="margin-top: 15px; text-align: right;">\n      <button id="close-search" style="padding: 8px 16px; background: #f0f0f0; border: 1px solid #ccc; border-radius: 4px; cursor: pointer;">Close</button>\n    </div>\n  ',document.body.appendChild(t);const n=t.querySelector("#search-input"),o=t.querySelector("#search-results"),i=t.querySelector("#close-search");n.addEventListener("input",(n=>{!function(n){if(!n.trim())return void(o.innerHTML='<div style="text-align: center; color: #999; padding: 20px;">Enter a search term to find trays</div>');const r=U(e).filter((e=>{if(!e||!e.name)return!1;try{const t=e.name.toLowerCase().includes(n.toLowerCase()),r=e.properties&&"object"==typeof e.properties&&Object.values(e.properties).some((e=>null!=e&&String(e).toLowerCase().includes(n.toLowerCase())));return t||r}catch(t){return console.error("Error filtering tray:",t,e),!1}}));0!==r.length?(o.innerHTML="",r.forEach((e=>{const n=document.createElement("div");n.style.cssText="\n        padding: 10px;\n        border-bottom: 1px solid #eee;\n        cursor: pointer;\n        transition: background-color 0.2s;\n      ";const r=e.name||"Untitled",i=e.id||"unknown",s=e.created_dt?e.created_dt.toLocaleDateString():"unknown date";n.innerHTML=`\n        <div style="font-weight: bold; margin-bottom: 4px;">${r}</div>\n        <div style="font-size: 0.8em; color: #666;">ID: ${i}</div>\n        <div style="font-size: 0.8em; color: #666;">Created: ${s}</div>\n      `,n.addEventListener("mouseenter",(()=>{n.style.backgroundColor="#f0f0f0"})),n.addEventListener("mouseleave",(()=>{n.style.backgroundColor="transparent"})),n.addEventListener("click",(n=>{n.preventDefault(),n.stopPropagation(),console.log("Search result clicked:",e.name,e.id),z(e),t.remove()})),o.appendChild(n)}))):o.innerHTML='<div style="text-align: center; color: #999; padding: 20px;">No trays found matching your search</div>'}(n.target.value)})),n.addEventListener("keydown",(e=>{"Escape"===e.key&&t.remove()})),i.addEventListener("click",(()=>{t.remove()})),n.focus(),t.addEventListener("click",(e=>{e.target===t&&t.remove()})),o.addEventListener("click",(e=>{e.stopPropagation()}))}function H(){const e=a.P.get((0,r.p0)());if(!e)return;const t=document.createElement("div");t.classList.add("hook-view-dialog");const n=window.innerWidth<=768,o=n?"15px":"20px";t.style.cssText=`\n    position: fixed;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    background: white;\n    border: 1px solid #ccc;\n    border-radius: 8px;\n    padding: ${o};\n    z-index: 10000;\n    width: 90vw;\n    max-width: 800px;\n    min-width: 320px;\n    max-height: 80vh;\n    overflow-y: auto;\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);\n  `,t.innerHTML='\n    <h3 style="margin-bottom: 15px;">Tasks Organized by Hooks</h3>\n    <div id="hook-content" style="max-height: 60vh; overflow-y: auto;">\n      <div style="text-align: center; color: #999; padding: 20px;">Loading hooks...</div>\n    </div>\n    <div style="margin-top: 15px; text-align: right;">\n      <button id="close-hook-view" style="padding: 8px 16px; background: #f0f0f0; border: 1px solid #ccc; border-radius: 4px; cursor: pointer;">Close</button>\n    </div>\n  ',document.body.appendChild(t);const i=t.querySelector("#hook-content"),s=t.querySelector("#close-hook-view"),c=new Map,l=U(e),d=new Map;if(l.forEach((e=>{e.hooks&&e.hooks.length>0&&e.hooks.forEach((t=>{d.has(t)||d.set(t,[]),d.get(t).push(e)}))})),0===d.size)i.innerHTML='<div style="text-align: center; color: #999; padding: 20px;">No tasks with hooks found. Use @hookname in tray names to organize by hooks.</div>';else{i.innerHTML="";const e=Array.from(d.entries());e.sort(((e,t)=>{const n=e[1].every((e=>e.isDone));return n!==t[1].every((e=>e.isDone))?n?1:-1:t[1].length!==e[1].length?t[1].length-e[1].length:e[0].localeCompare(t[0])})),e.forEach((([e,r])=>{const o=document.createElement("div"),s=n?"10px":"15px";o.style.cssText=`margin-bottom: 20px; border: 1px solid #ddd; border-radius: 6px; padding: ${s};`;const a=document.createElement("h4");a.textContent=`@${e}`;const l=n?"1em":"1.1em";a.style.cssText=`margin: 0 0 10px 0; color: #333; font-size: ${l}; font-weight: bold; cursor: pointer; transition: color 0.2s; user-select: none;`;const d=r.some((e=>e.isDone));c.set(e,!1);const u=document.createElement("div");function p(){const n=c.get(e)||!1;u.innerHTML="",r.forEach((e=>{const r=e.isDone;if(r&&!n)return;const o=document.createElement("div");o.style.cssText=`\n            padding: 8px 12px;\n            margin-bottom: 6px;\n            background: ${r?"#f0f0f0":"#f8f9fa"};\n            border-radius: 4px;\n            cursor: pointer;\n            transition: background-color 0.2s;\n            border-left: 3px solid ${e.borderColor};\n            ${r?"opacity: 0.7;":""}\n          `;const i=e.name||"Untitled",s=e.created_dt?e.created_dt.toLocaleDateString():"unknown date";o.innerHTML=`\n            <div style="font-weight: 500; margin-bottom: 2px; ${r?"text-decoration: line-through; color: #999;":""}">${i}</div>\n            <div style="font-size: 0.8em; color: #666;">Created: ${s}${r?" • ✓ Done":""}</div>\n          `,o.addEventListener("mouseenter",(()=>{o.style.backgroundColor=r?"#e0e0e0":"#e9ecef"})),o.addEventListener("mouseleave",(()=>{o.style.backgroundColor=r?"#f0f0f0":"#f8f9fa"})),o.addEventListener("click",(n=>{n.preventDefault(),n.stopPropagation(),z(e),t.remove()})),u.appendChild(o)}));const o=r.filter((e=>e.isDone)).length,i=r.length,s=n?"👁️":"👁️‍🗨️";a.textContent=`@${e} (${i-o}/${i}) ${d?s:""}`}u.id=`tasks-${e}`,a.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation();const n=c.get(e)||!1;c.set(e,!n),p()})),a.addEventListener("mouseenter",(()=>{a.style.color="#0066cc"})),a.addEventListener("mouseleave",(()=>{a.style.color="#333"})),o.appendChild(a),o.appendChild(u),p(),i.appendChild(o)}))}function u(e){"Escape"===e.key&&h()}function p(e){t.contains(e.target)||h()}function h(){t.remove(),document.removeEventListener("keydown",u),document.removeEventListener("click",p)}s.addEventListener("click",(()=>{h()})),setTimeout((()=>{document.addEventListener("keydown",u),document.addEventListener("click",p)}),100),i.addEventListener("click",(e=>{e.stopPropagation()}))}function K(){const e=document.createElement("div");e.classList.add("auto-sync-dialog"),e.style.cssText="\n    position: fixed;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    background: white;\n    border: 1px solid #ccc;\n    border-radius: 8px;\n    padding: 20px;\n    z-index: 10000;\n    width: 90vw;\n    max-width: 500px;\n    min-width: 320px;\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);\n  ";const t=m.A.getState(),n=(0,u.Q1)(t);e.innerHTML=`\n    <h3 style="margin: 0 0 20px 0; color: #333;">🔄 Auto-Sync Settings</h3>\n    \n    <div style="margin-bottom: 20px;">\n      <label style="display: flex; align-items: center; cursor: pointer;">\n        <input type="checkbox" id="autoSyncToggle" ${n?"checked":""} \n               style="margin-right: 10px; transform: scale(1.2);">\n        <span style="font-weight: 500;">Enable Global Auto-Sync</span>\n      </label>\n      <p style="margin: 8px 0 0 30px; font-size: 0.9em; color: #666;">\n        Automatically sync all network-enabled trays in the background\n      </p>\n    </div>\n    \n    <div style="margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 6px;">\n      <h4 style="margin: 0 0 10px 0; color: #555;">📊 Sync Status</h4>\n      <div id="syncStatusInfo" style="font-size: 0.9em; color: #666;">\n        Loading status...\n      </div>\n    </div>\n    \n    <div style="margin-bottom: 20px; padding: 15px; background: #fff3cd; border-radius: 6px; border-left: 4px solid #ffc107;">\n      <h4 style="margin: 0 0 10px 0; color: #856404;">⚠️ Conflict Resolution</h4>\n      <p style="margin: 0; font-size: 0.9em; color: #856404;">\n        When conflicts occur, you'll be prompted to choose how to resolve them. \n        Enhanced conflict resolution is coming soon.\n      </p>\n    </div>\n    \n    <div style="display: flex; gap: 10px; justify-content: flex-end;">\n      <button id="cancelAutoSync" style="padding: 8px 16px; border: 1px solid #ccc; background: white; border-radius: 4px; cursor: pointer;">\n        Cancel\n      </button>\n      <button id="saveAutoSync" style="padding: 8px 16px; border: none; background: #007bff; color: white; border-radius: 4px; cursor: pointer;">\n        Save\n      </button>\n    </div>\n  `,document.body.appendChild(e),(()=>{const t=e.querySelector("#syncStatusInfo");if(t){const e=v.io.getSyncStatus();t.innerHTML=`\n        <div>Network-enabled trays: <strong>${e.networkTrays}</strong></div>\n        <div>Auto-syncing trays: <strong>${e.autoSyncTrays}</strong></div>\n        <div>Sync queue: <strong>${e.queueLength}</strong></div>\n        <div>Active syncs: <strong>${e.activeSyncs}</strong></div>\n        <div>Global sync manager: <strong>${e.isRunning?"Running":"Stopped"}</strong></div>\n      `}})();const r=e.querySelector("#autoSyncToggle"),o=e.querySelector("#cancelAutoSync"),i=e.querySelector("#saveAutoSync");o.addEventListener("click",(()=>{e.remove()})),i.addEventListener("click",(()=>{const t=r.checked;if(t!==n){m.A.dispatch((0,u.ry)());const e=document.createElement("div");e.style.cssText="\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        background: #28a745;\n        color: white;\n        padding: 12px 16px;\n        border-radius: 6px;\n        z-index: 10001;\n        font-size: 14px;\n      ",e.textContent="Auto-sync "+(t?"enabled":"disabled"),document.body.appendChild(e),setTimeout((()=>e.remove()),3e3)}e.remove()}));const s=t=>{t.target===e&&(e.remove(),document.removeEventListener("click",s))};setTimeout((()=>{document.addEventListener("click",s)}),100);const a=t=>{"Escape"===t.key&&(e.remove(),document.removeEventListener("keydown",a),document.removeEventListener("click",s))};document.addEventListener("keydown",a)}},944:(e,t,n)=>{n.r(t),n.d(t,{_getHistoryLength:()=>c,recordState:()=>s,undo:()=>a});var r=n(859),o=n(185);const i=[];function s(e){if(!e){const t=n(681),i=(0,o.p0)();if(!i)return;const s=r.P.get(i);if(!s)return;e=t.serialize(s)}i.push(e),i.length>50&&i.shift()}function a(){if(i.length<2)return;i.pop();const e=i[i.length-1],t=n(681),r=t.deserialize(e);t.renderRootTray(r)}function c(){return i.length}},681:(e,t,n)=>{n.r(t),n.d(t,{deserialize:()=>I,deserializeJSONL:()=>L,exportData:()=>w,getAllSessionIds:()=>T,importData:()=>x,loadFromIndexedDB:()=>E,loadFromLocalStorage:()=>P,renderRootTray:()=>C,saveToIndexedDB:()=>k,serialize:()=>D,serializeAsync:()=>_});const r="trayData";var o=n(859),i=n(185),s=n(598),a=n(20),c=n(627),l=n(896),d=n(33);function u(){const e=d.A.getState().app.ui.focused;if(!e)return;const t=(0,l.yr)(e);if(!t)return;const n=(0,l.yr)(t.parentId);if(n){const e=new c.f(n.id,Date.now().toString(),"New Tray");n.addChild(e),n.isFolded=!1,n.updateAppearance(),e.element.focus();const t=e.element.querySelector(".tray-title");e.startTitleEdit(t)}}function p(){const e=d.A.getState().app.ui.focused;if(!e)return;const t=(0,l.yr)(e);if(!t)return;const n=new c.f(t.id,Date.now().toString(),"New Tray");t.addChild(n),t.isFolded=!1,t.updateAppearance(),n.element.focus();const r=n.element.querySelector(".tray-title");n.startTitleEdit(r)}const h={LEGACY:0,V1_SEPARATED:1,CURRENT:1};class y extends Error{constructor(e,t,n){super(t),this.name="AppError",this.code=e,this.context=n,this.timestamp=new Date}toJSON(){return{name:this.name,code:this.code,message:this.message,context:this.context,timestamp:this.timestamp,stack:this.stack}}}class f extends y{constructor(e,t,n,r){super("load"===e?"LOAD_FAILED":"SAVE_FAILED",t,r),this.name="IOError",this.operation=e,this.dataType=n}static saveFailure(e,t){return new f("save",`Failed to save data to ${e}: ${t}`,e,{reason:t})}static loadFailure(e,t){return new f("load",`Failed to load data from ${e}: ${t}`,e,{reason:t})}}new Set;var g=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};class m{static getInstance(){return m.instance||(m.instance=new m),m.instance}migrate(e,t){return g(this,void 0,void 0,(function*(){const n={fromVersion:t||this.detectVersion(e),toVersion:h.CURRENT,data:e,warnings:[]};try{return n.fromVersion===h.LEGACY&&(n.data=yield this.migrateLegacyToV1(e,n)),n}catch(e){throw n.warnings.push(`Migration failed: ${e instanceof Error?e.message:String(e)}`),e}}))}detectVersion(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){return h.LEGACY}if(!e||"object"!=typeof e)return h.LEGACY;const t=e;return"version"in t&&"number"==typeof t.version?t.version:("children"in t&&Array.isArray(t.children),h.LEGACY)}migrateLegacyToV1(e,t){return g(this,void 0,void 0,(function*(){var n;let r;if("string"==typeof e)try{r=JSON.parse(e)}catch(e){throw new Error(`Invalid JSON data: ${e instanceof Error?e.message:String(e)}`)}else r=e;if(!r.id||!r.name)throw new Error("Missing required fields: id and name");const o={};if(r.properties&&"object"==typeof r.properties){if("priority"in r.properties&&"number"==typeof r.properties.priority&&(o.priority=r.properties.priority),"tags"in r.properties&&Array.isArray(r.properties.tags)&&(o.tags=r.properties.tags.filter((e=>"string"==typeof e))),"dueDate"in r.properties)try{o.dueDate=new Date(r.properties.dueDate)}catch(e){t.warnings.push(`Invalid dueDate for tray ${r.id}, skipping`)}"color"in r.properties&&"string"==typeof r.properties.color&&(o.color=r.properties.color);const e=["priority","tags","dueDate","color"],n=Object.keys(r.properties).filter((t=>!e.includes(t))).reduce(((e,t)=>(e[t]=r.properties[t],e)),{});Object.keys(n).length>0&&(o.metadata=n,t.warnings.push(`Moved unknown properties to metadata for tray ${r.id}`))}let i;try{i=r.created_dt?new Date(r.created_dt):new Date,isNaN(i.getTime())&&(i=new Date,t.warnings.push(`Invalid created_dt for tray ${r.id}, using current date`))}catch(e){i=new Date,t.warnings.push(`Failed to parse created_dt for tray ${r.id}, using current date`)}return{id:r.id,name:r.name,parentId:null!==(n=r.parentId)&&void 0!==n?n:null,borderColor:r.borderColor||"#ffffff",created_dt:i,flexDirection:r.flexDirection||"column",host_url:r.host_url||null,filename:r.filename||null,isFolded:void 0===r.isFolded||r.isFolded,properties:o,hooks:Array.isArray(r.hooks)?r.hooks:[],isDone:r.isDone||!1,showDoneMarker:r.showDoneMarker||!1,version:h.V1_SEPARATED}}))}convertToLegacyFormat(e){var t;const n={};return void 0!==e.properties.priority&&(n.priority=e.properties.priority),e.properties.tags&&(n.tags=e.properties.tags),e.properties.dueDate&&(n.dueDate=e.properties.dueDate),e.properties.color&&(n.color=e.properties.color),e.properties.metadata&&Object.assign(n,e.properties.metadata),{id:e.id,name:e.name,parentId:null!==(t=e.parentId)&&void 0!==t?t:void 0,borderColor:e.borderColor,created_dt:e.created_dt,flexDirection:e.flexDirection,host_url:e.host_url,filename:e.filename,isFolded:e.isFolded,properties:n,hooks:e.hooks,isDone:e.isDone,showDoneMarker:e.showDoneMarker}}migrateHierarchical(e,t){return g(this,void 0,void 0,(function*(){t||(t={fromVersion:h.LEGACY,toVersion:h.CURRENT,data:e,warnings:[]});const n={},r=(e,...o)=>g(this,[e,...o],void 0,(function*(e,o=null){o&&(e.parentId=o);const i=yield this.migrateLegacyToV1(e,t);if(n[i.id]=i,e.children&&Array.isArray(e.children))for(const t of e.children)yield r(t,i.id);return i}));return{root:yield r(e),allTrays:n,warnings:t.warnings}}))}convertTrayToData(e){const t={};if(e.properties){if("number"==typeof e.properties.priority&&(t.priority=e.properties.priority),Array.isArray(e.properties.tags)&&(t.tags=e.properties.tags.filter((e=>"string"==typeof e))),e.properties.dueDate)try{t.dueDate=new Date(e.properties.dueDate)}catch(e){}"string"==typeof e.properties.color&&(t.color=e.properties.color);const n=["priority","tags","dueDate","color"],r=Object.keys(e.properties).filter((e=>!n.includes(e))).reduce(((t,n)=>(t[n]=e.properties[n],t)),{});Object.keys(r).length>0&&(t.metadata=r)}return{id:e.id,name:e.name,parentId:e.parentId,borderColor:e.borderColor,created_dt:e.created_dt,flexDirection:e.flexDirection,host_url:e.host_url,filename:e.filename,isFolded:e.isFolded,properties:t,hooks:[...e.hooks],isDone:e.isDone,showDoneMarker:e.showDoneMarker||!1,version:h.V1_SEPARATED}}convertDataToTrayParams(e){var t;const n={};return void 0!==e.properties.priority&&(n.priority=e.properties.priority),e.properties.tags&&(n.tags=e.properties.tags),e.properties.dueDate&&(n.dueDate=e.properties.dueDate),e.properties.color&&(n.color=e.properties.color),e.properties.metadata&&Object.assign(n,e.properties.metadata),{parentId:null!==(t=e.parentId)&&void 0!==t?t:"",id:e.id,name:e.name,color:e.borderColor,created_dt:e.created_dt,flexDirection:e.flexDirection,host_url:e.host_url,filename:e.filename,isFold:e.isFolded,properties:n,hooks:[...e.hooks],isDone:e.isDone}}validateMigration(e,t){try{return!(!t.id||!t.name||!t.version||t.version<h.V1_SEPARATED||!(t.created_dt instanceof Date)||isNaN(t.created_dt.getTime())||!t.properties||"object"!=typeof t.properties)}catch(e){return!1}}getMigrationSummary(e){const t=[`Migration from version ${e.fromVersion} to ${e.toVersion}`,`Warnings: ${e.warnings.length}`];return e.warnings.length>0&&(t.push("Warning details:"),e.warnings.forEach((e=>{t.push(`  - ${e}`)}))),t.join("\n")}}const v=m.getInstance();var b=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};function w(){const e=D(o.P.get((0,i.p0)()));if(!e)return void console.error("No data found to export.");const t=new Blob([e],{type:"application/json"}),n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download="tray_data.json",r.click(),URL.revokeObjectURL(n)}function x(){const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=e=>{const t=e.target,n=t.files?t.files[0]:null;if(!n)return;const s=new FileReader;s.onload=e=>b(this,void 0,void 0,(function*(){var t,n,s;try{const a=null===(t=e.target)||void 0===t?void 0:t.result;let c;try{c=JSON.parse(a)}catch(e){return console.error("Invalid JSON file:",e),void alert("無効なJSONファイルです。")}const l=v.detectVersion(c),d=h.CURRENT;let u=a;if(l<d){console.log(`Migrating imported data from version ${l} to ${d}`);try{let e;if(c.children&&Array.isArray(c.children)){const t=yield v.migrateHierarchical(c);console.log(`Import migration completed with ${(null===(n=t.warnings)||void 0===n?void 0:n.length)||0} warnings`),t.warnings&&t.warnings.length>0&&console.warn("Import migration warnings:",t.warnings);const r=v.convertToLegacyFormat(t.root);if(t.allTrays){const e=(n,r)=>{const o=Object.values(t.allTrays).filter((e=>e.parentId===r)).map((t=>{const n=v.convertToLegacyFormat(t);return e(n,t.id),n}));n.children=o};e(r,t.root.id)}e=I(JSON.stringify(r))}else{const t=yield v.migrate(c);console.log(`Import migration completed with ${(null===(s=t.warnings)||void 0===s?void 0:s.length)||0} warnings`),t.warnings&&t.warnings.length>0&&console.warn("Import migration warnings:",t.warnings);const n=v.convertToLegacyFormat(t.data);e=I(JSON.stringify(n))}u=D(e)}catch(e){console.error("Import migration failed, using original data:",e),u=a}}yield k("imported",u),yield k(r,u);const p=I(u),y=(0,i.p0)();if(o.P.get(y)&&p){p.isFolded=!1;const e=t=>{t.isFolded=!1,t.updateAppearance(),t.children.forEach((t=>e(t)))};e(p);const t=y.querySelector(".tray-content");t&&(t.innerHTML=""),o.P.delete(y),y.innerHTML="",y.appendChild(p.element),o.P.set(y,p),console.log("Data imported successfully")}return}catch(e){return console.error("Import error:",e),void alert("データのインポート中にエラーが発生しました。")}})),s.readAsText(n,"UTF-8")},e.click()}function k(){return b(this,arguments,void 0,(function*(e=null,t=null){return new Promise(((s,a)=>{const c=indexedDB.open("TrayDatabase",4);let l;c.onupgradeneeded=e=>{l=c.result,l.objectStoreNames.contains("trays")||l.createObjectStore("trays",{keyPath:"id"})},c.onerror=e=>{a(f.saveFailure("indexeddb",`Error opening database: ${c.error}`))},c.onsuccess=()=>{l=c.result;const d=(0,i.Vf)("sessionId"),u=(0,i.p0)();if(!u)return void a(f.saveFailure("indexeddb","Root element not found"));const p=o.P.get(u),h=t||D(p);try{const{recordState:e}=n(944);e(h)}catch(e){}if(!h)return void a(f.saveFailure("indexeddb","Serialize failed"));let y;y=e||d||r;const g=l.transaction("trays","readwrite").objectStore("trays").put({id:y,value:h});g.onsuccess=()=>{console.log(y),console.log("Data saved successfully");try{localStorage.setItem(`update_${y}`,Date.now().toString())}catch(e){}s(y)},g.onerror=e=>{a(f.saveFailure("indexeddb",`Error saving to IndexedDB: ${g.error}`))}}}))}))}function E(){return b(this,arguments,void 0,(function*(e=r){var t,o;try{const r=yield S(),i=yield function(e,t){return new Promise(((n,r)=>{const o=e.transaction("trays","readonly").objectStore("trays").get(t);o.onsuccess=()=>{n(o.result)},o.onerror=()=>{r(o.error)}}))}(r,e);let a;if(i)try{const n=i.value;let r;console.log("Loading data from IndexedDB, checking for migration...");try{r=JSON.parse(n)}catch(e){return console.error("Invalid JSON data in IndexedDB:",e),a=(0,s.e)(),void C(a)}const c=v.detectVersion(r),l=h.CURRENT;if(c<l){console.log(`Migrating data from version ${c} to ${l}`);try{if(r.children&&Array.isArray(r.children)){const n=yield v.migrateHierarchical(r);console.log(`Migration completed with ${(null===(t=n.warnings)||void 0===t?void 0:t.length)||0} warnings`),n.warnings&&n.warnings.length>0&&console.warn("Migration warnings:",n.warnings);const o=v.convertToLegacyFormat(n.root);if(n.allTrays){const e=(t,r)=>{const o=Object.values(n.allTrays).filter((e=>e.parentId===r)).map((t=>{const n=v.convertToLegacyFormat(t);return e(n,t.id),n}));t.children=o};e(o,n.root.id)}a=I(JSON.stringify(o));const i=D(a);yield k(e,i),console.log("Migrated data saved back to IndexedDB")}else{const t=yield v.migrate(r);console.log(`Migration completed with ${(null===(o=t.warnings)||void 0===o?void 0:o.length)||0} warnings`),t.warnings&&t.warnings.length>0&&console.warn("Migration warnings:",t.warnings);const n=v.convertToLegacyFormat(t.data);a=I(JSON.stringify(n));const i=D(a);yield k(e,i),console.log("Migrated data saved back to IndexedDB")}}catch(e){console.error("Migration failed, falling back to direct deserialization:",e),a=I(n)}}else console.log("Data is current version, no migration needed"),a=I(n)}catch(e){console.error("Error processing data:",e),a=(0,s.e)()}else a=(0,s.e)();C(a);try{const{recordState:e}=n(944);e(D(a))}catch(e){}}catch(e){console.error("Error loading from IndexedDB:",e);const t=(0,s.e)();C(t);try{const{recordState:e}=n(944);e(D(t))}catch(e){}}}))}function S(){return new Promise(((e,t)=>{const n=indexedDB.open("TrayDatabase",4);n.onupgradeneeded=e=>{const t=n.result;t.objectStoreNames.contains("trays")||t.createObjectStore("trays",{keyPath:"id"})},n.onsuccess=()=>{e(n.result)},n.onerror=()=>{t(n.error)}}))}function T(){return b(this,void 0,void 0,(function*(){const e=yield S();return new Promise(((t,n)=>{const r=e.transaction("trays","readonly").objectStore("trays").getAllKeys();r.onsuccess=()=>{t(r.result.filter((e=>"string"==typeof e)))},r.onerror=()=>n(r.error)}))}))}function C(e){document.body.innerHTML="",document.body.appendChild(e.element),(0,a.T0)();const t=function(){console.log("Creating action buttons");const e=document.createElement("div");e.classList.add("action-buttons");const t=document.createElement("button");t.textContent="+",t.classList.add("action-button","add-button"),t.addEventListener("click",u);const n=document.createElement("button");return n.textContent="↩",n.classList.add("action-button","insert-button"),n.addEventListener("click",p),e.appendChild(t),e.appendChild(n),console.log("Action buttons created:",e),e}();document.body.appendChild(t)}function D(e){return JSON.stringify(e)}function _(e){return b(this,void 0,void 0,(function*(){return Promise.resolve().then((()=>JSON.stringify(e)))}))}function A(e){var t,n,r;let o,i;o=e.host_url?e.host_url:e.url||null;try{i=new Date(e.created_dt),isNaN(i.getTime())&&(i=new Date)}catch(e){i=new Date}let s=new c.f(e.parentId||"",e.id,e.name,e.borderColor,i,e.flexDirection,o,e.filename,"boolean"!=typeof e.isFolded||e.isFolded,null!==(t=e.properties)&&void 0!==t?t:{},null!==(n=e.hooks)&&void 0!==n?n:[],null!==(r=e.isDone)&&void 0!==r&&r);const a=e.children;return a.length>0&&a.slice().reverse().map((e=>A(e))).forEach((e=>s.addChild(e))),s}function I(e){return A(JSON.parse(e))}function L(e){const t=e.split("\n").map((e=>JSON.parse(e))),n=new Map;t.forEach((e=>{var t,r,o;const i=new c.f(e.parentId,e.id,e.name,e.borderColor,e.created_dt,e.flexDirection,e.host_url,e.filename,e.isFolded,null!==(t=e.properties)&&void 0!==t?t:{},null!==(r=e.hooks)&&void 0!==r?r:[],null!==(o=e.isDone)&&void 0!==o&&o);n.set(e.id,i);const s=n.get(e.parentId);s&&s.children.push(i)}));const r=function(e){let t=e.get(e.keys().next().value);for(;;){const n=e.get(null==t?void 0:t.parentId);if(!n)break;t=n}return t}(n);return r}function P(){return b(this,arguments,void 0,(function*(e=r){var t,n;let o;try{const r=localStorage.getItem(e);if(r){let i;try{i=JSON.parse(r)}catch(e){return console.error("Invalid JSON in localStorage:",e),o=(0,s.e)(),void C(o)}console.log("Loading from localStorage, checking for migration...");const a=v.detectVersion(i),c=h.CURRENT;if(a<c){console.log(`Migrating localStorage data from version ${a} to ${c}`);try{if(i.children&&Array.isArray(i.children)){const e=yield v.migrateHierarchical(i);console.log(`localStorage migration completed with ${(null===(t=e.warnings)||void 0===t?void 0:t.length)||0} warnings`),e.warnings&&e.warnings.length>0&&console.warn("localStorage migration warnings:",e.warnings);const n=v.convertToLegacyFormat(e.root);if(e.allTrays){const t=(n,r)=>{const o=Object.values(e.allTrays).filter((e=>e.parentId===r)).map((e=>{const n=v.convertToLegacyFormat(e);return t(n,e.id),n}));n.children=o};t(n,e.root.id)}o=I(JSON.stringify(n))}else{const e=yield v.migrate(i);console.log(`localStorage migration completed with ${(null===(n=e.warnings)||void 0===n?void 0:n.length)||0} warnings`),e.warnings&&e.warnings.length>0&&console.warn("localStorage migration warnings:",e.warnings);const t=v.convertToLegacyFormat(e.data);o=I(JSON.stringify(t))}const r=D(o);localStorage.setItem(e,r),console.log("Migrated data saved back to localStorage")}catch(e){console.error("localStorage migration failed, using original data:",e),o=I(r)}}else console.log("localStorage data is current version, no migration needed"),o=I(r)}else o=(0,s.e)();o.isFolded=!1,o.updateAppearance(),o.updateChildrenAppearance()}catch(e){console.error("Error loading from localStorage:",e),o=(0,s.e)()}document.body.innerHTML="",document.body.appendChild(o.element),(0,a.T0)()}))}},973:(e,t,n)=>{n.d(t,{AC:()=>E,CW:()=>b,H6:()=>f,L:()=>v,N:()=>h,O6:()=>x,U2:()=>p,XF:()=>w,oy:()=>S,zC:()=>y});var r=n(681),o=n(896),i=n(669),s=n(830),a=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};const c=new Map,l=new Map;function d(e){let t=new Date(e.created_dt).getTime();for(const n of e.children){const e=d(n);e>t&&(t=e)}return t}function u(e,t){d(t)>d(e)&&(void 0!==t.name&&(e.name=t.name),e.created_dt=new Date(t.created_dt),void 0!==t.borderColor&&(e.borderColor=t.borderColor),void 0!==t.flexDirection&&(e.flexDirection=t.flexDirection),t.host_url&&(e.host_url=t.host_url),t.filename&&(e.filename=t.filename),void 0!==t.isFolded&&(e.isFolded=t.isFolded),e.properties=Object.assign(Object.assign({},e.properties),t.properties),e.hooks=Array.from(new Set([...e.hooks||[],...t.hooks||[]])),e.isDone=t.isDone,e.showDoneMarker=t.showDoneMarker);const n=new Map(e.children.map((e=>[e.id,e])));for(const r of t.children){const t=n.get(r.id);t?u(t,r):"function"==typeof e.addChild?e.addChild(r):(r.parentId=e.id,e.children.push(r))}}function p(e){return a(this,void 0,void 0,(function*(){const t=yield(0,r.serializeAsync)(e),n=c.get(e.id)||"";if(t===n)return;let a;try{a=yield w(e)}catch(e){a=void 0}if(a)try{if("undefined"!=typeof window&&"undefined"==typeof process&&window.location&&"string"==typeof window.location.href&&window.location.href.length>0){const t=yield s.oo.handleSyncConflict(e,a,n,r.serialize);if(t!==e){const n=(0,o.yr)(e.parentId);return(0,i.ql)(e),n.addChild(t),n.updateAppearance(),void c.set(e.id,yield(0,r.serializeAsync)(t))}}else u(e,a)}catch(t){if(t instanceof s.fK)throw console.log(`Conflict detected for tray ${e.name}, manual resolution required`),t;console.error("Error during conflict resolution:",t),u(e,a)}yield b(e),c.set(e.id,yield(0,r.serializeAsync)(e))}))}function h(e){y(e);const t=("undefined"!=typeof window&&window.setInterval||setInterval)((()=>{p(e).catch(console.error)}),6e4);l.set(e.id,t)}function y(e){const t=l.get(e.id);void 0!==t&&(clearInterval(t),l.delete(e.id))}function f(){console.log("Stopping all individual tray auto-uploads"),l.forEach((e=>{clearInterval(e)})),l.clear()}function g(e){try{const t=new URL(e);let n=t.origin;return t.pathname&&"/"!==t.pathname&&(n+=t.pathname.replace(/\/$/,"")),n}catch(t){return e.trim().replace(/\/$/,"")}}function m(e){const t=g(e),n=JSON.parse(localStorage.getItem("serverPasswords")||"{}");if(n[t])return n[t];for(const[e,r]of Object.entries(n))if(g(e)===t)return r;return localStorage.getItem("trayPassword")||null}function v(e){const t=localStorage.getItem("defaultServer")||"",n=prompt("Enter server URL:",t);if(!n)return;const o=m(n);o?fetch(`${n}/tray/list_auth`,{method:"GET",headers:{Authorization:o}}).then((e=>{if(401!==e.status){if(!e.ok)throw new Error("Network response was not ok");return e.json()}alert("Authentication failed. Please check your password.")})).then((t=>{t&&function(e,t,n){const o=document.createElement("div");o.classList.add("tray-selection-dialog"),o.innerHTML=`\n        <h3>Select a tray to add:</h3>\n        <select id="tray-select">\n          ${n.map((e=>`<option value="${e}">${e}</option>`)).join("")}\n        </select>\n        <button id="add-tray-btn">Add Tray</button>\n        <button id="cancel-btn">Cancel</button>\n      `,document.body.appendChild(o);const i=document.getElementById("add-tray-btn"),s=document.getElementById("cancel-btn"),c=document.getElementById("tray-select");i.addEventListener("click",(()=>{const n=c.value;!function(e,t,n){a(this,void 0,void 0,(function*(){try{const o=m(t);if(!o)return void alert("No password configured for this server. Please set up server passwords in the hamburger menu.");const i=yield fetch(`${t}/tray/load_auth`,{method:"GET",headers:{Authorization:o,filename:n}});if(401===i.status)return void alert("Authentication failed. Please check your password in the hamburger menu.");if(!i.ok)throw new Error("Network response was not ok");const s=yield i.json();e.addChild((0,r.deserialize)(JSON.stringify(s)))}catch(e){console.error("Error:",e),alert("Failed to add tray from server.")}}))}(e,t,n),o.remove()})),s.addEventListener("click",(()=>{o.remove()}))}(e,n,t.files)})).catch((e=>{console.error("Error:",e),alert("Failed to fetch tray list from server.")})):alert("No password configured for this server. Please set up server passwords in the hamburger menu.")}function b(e){return a(this,void 0,void 0,(function*(){const t=JSON.parse(yield(0,r.serializeAsync)(e));if(!e.host_url)return;if(!e.filename)return;const n=m(e.host_url);if(n)try{const r=yield fetch(`${e.host_url}/tray/upload_auth`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:n,filename:e.filename},body:JSON.stringify({data:t})});if(401===r.status)return void k("Authentication failed. Please check your password in the hamburger menu.",!0);if(!r.ok)throw new Error("Network response was not ok");const o=yield r.text();console.log(o),k("Data uploaded successfully.")}catch(e){throw console.error("Error:",e),k("Failed to upload data.",!0),e}else k("Password is required for secure upload.",!0)}))}function w(e){return a(this,void 0,void 0,(function*(){if(!e.filename)return;if(!e.host_url)return;const t=m(e.host_url);if(t)try{const n=yield fetch(`${e.host_url}/tray/load_auth`,{method:"GET",headers:{Authorization:t,filename:e.filename}});if(401===n.status)return void k("Authentication failed. Please check your password in the hamburger menu.",!0);if(!n.ok)throw new Error("Network response was not ok");const o=yield n.json();return(0,r.deserialize)(JSON.stringify(o))}catch(e){throw console.error("Error:",e),k("Failed to download data.",!0),e}else k("No password configured for this server. Please set up server passwords in the hamburger menu.",!0)}))}function x(e){return a(this,void 0,void 0,(function*(){if(!e.filename||!e.host_url)return;const t=c.get(e.id)||"";let n;try{n=yield w(e)}catch(e){n=void 0}n&&u(e,n);const o=yield(0,r.serializeAsync)(e);o!==t&&(yield b(e),c.set(e.id,o))}))}function k(e,t=!1){const n=document.createElement("div");n.textContent=e,n.style.position="fixed",n.style.bottom="20px",n.style.right="20px",n.style.padding="10px",n.style.borderRadius="5px",n.style.color="white",n.style.backgroundColor=t?"red":"green",n.style.zIndex="1000",document.body.appendChild(n),setTimeout((()=>{n.style.transition="opacity 0.5s",n.style.opacity="0",setTimeout((()=>{document.body.removeChild(n)}),500)}),3e3)}function E(e){const t=prompt("ホストURLを入力してください (空欄の場合、nullになります):",e.host_url||""),n=prompt("ファイル名を入力してください (空欄の場合、nullになります):",e.filename||"");e.host_url=t?""===t.trim()?null:t:null,e.filename=n?""===n.trim()?null:n:null,e.host_url&&e.filename&&(e.autoUpload=!0)}function S(e){return a(this,void 0,void 0,(function*(){if(!e.filename)return void k("No filename specified for removal.",!0);if(!e.host_url)return void k("No server URL specified for removal.",!0);const t=m(e.host_url);if(t)try{const n=yield fetch(`${e.host_url}/tray/remove`,{method:"DELETE",headers:{Authorization:t,filename:e.filename}});if(401===n.status)return void k("Authentication failed. Please check your password in the hamburger menu.",!0);if(!n.ok)throw new Error("Network response was not ok");k("File removed from server successfully.")}catch(e){throw console.error("Error:",e),k("Failed to remove file from server.",!0),e}else k("No password configured for this server. Please set up server passwords in the hamburger menu.",!0)}))}"undefined"!=typeof window&&window.addEventListener("beforeunload",(()=>{console.log("Cleaning up individual tray auto-upload intervals"),l.forEach((e=>{clearInterval(e)})),l.clear()}))},640:(e,t,n)=>{n.d(t,{X:()=>s});var r=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};const o=new class{constructor(){this.worker=null,this.messageId=0,this.pendingMessages=new Map}executePluginCode(e,t){return r(this,arguments,void 0,(function*(e,t,n=[]){const r=this.createSandboxedCode(e,n);return new Function("api","manifest",r)(this.createSandboxAPI(n),t)}))}createSandboxedCode(e,t){return`\n      'use strict';\n      \n      // Remove access to global objects\n      const window = undefined;\n      const document = undefined;\n      const global = undefined;\n      const globalThis = undefined;\n      \n      // Create plugin with restricted scope\n      const plugin = (function() {\n        return ${e};\n      })();\n      \n      // Validate and return plugin\n      if (!plugin || typeof plugin !== 'object') {\n        throw new Error('Plugin must export an object');\n      }\n      \n      if (!plugin.hooks || typeof plugin.hooks !== 'object') {\n        throw new Error('Plugin must have a hooks object');\n      }\n      \n      // Wrap hooks to ensure they're safe\n      const safeHooks = {};\n      for (const [hookName, hookFn] of Object.entries(plugin.hooks)) {\n        if (typeof hookFn === 'function') {\n          safeHooks[hookName] = async function(task, context) {\n            // Ensure task and context are read-only\n            const safeTask = Object.freeze({...task});\n            const safeContext = Object.freeze({...context});\n            \n            return await hookFn.call(plugin, safeTask, safeContext);\n          };\n        }\n      }\n      \n      return {\n        manifest: manifest,\n        hooks: safeHooks,\n        initialize: plugin.initialize ? plugin.initialize.bind(plugin) : undefined,\n        destroy: plugin.destroy ? plugin.destroy.bind(plugin) : undefined\n      };\n    `}createSandboxAPI(e){const t={console:{log:(...e)=>console.log("[Plugin]",...e),error:(...e)=>console.error("[Plugin]",...e),warn:(...e)=>console.warn("[Plugin]",...e)}};return e.includes("storage")&&(t.storage={get:e=>r(this,void 0,void 0,(function*(){const t=localStorage.getItem(`plugin_storage_${e}`);return t?JSON.parse(t):null})),set:(e,t)=>r(this,void 0,void 0,(function*(){localStorage.setItem(`plugin_storage_${e}`,JSON.stringify(t))})),remove:e=>r(this,void 0,void 0,(function*(){localStorage.removeItem(`plugin_storage_${e}`)}))}),e.includes("network")&&(t.network={fetch:(e,t)=>r(this,void 0,void 0,(function*(){return fetch(e,t)}))}),e.includes("clipboard")&&(t.clipboard={writeText:e=>r(this,void 0,void 0,(function*(){return navigator.clipboard.writeText(e)})),readText:()=>r(this,void 0,void 0,(function*(){return navigator.clipboard.readText()}))}),e.includes("notifications")&&(t.notifications={show:(e,t)=>r(this,void 0,void 0,(function*(){("granted"===Notification.permission||"denied"!==Notification.permission&&"granted"===(yield Notification.requestPermission()))&&new Notification(e,t)}))}),t}initializeWorkerSandbox(){return r(this,void 0,void 0,(function*(){const e=new Blob(["\n      self.onmessage = function(e) {\n        const { id, type, payload } = e.data;\n        \n        try {\n          switch (type) {\n            case 'execute':\n              // Execute plugin code in worker context\n              const result = executePlugin(payload);\n              self.postMessage({ id, success: true, result });\n              break;\n            default:\n              throw new Error('Unknown message type: ' + type);\n          }\n        } catch (error) {\n          self.postMessage({ id, success: false, error: error.message });\n        }\n      };\n      \n      function executePlugin(payload) {\n        // Implementation here\n        return { success: true };\n      }\n    "],{type:"application/javascript"}),t=URL.createObjectURL(e);this.worker=new Worker(t),this.worker.onmessage=e=>{const{id:t,success:n,result:r,error:o}=e.data,i=this.pendingMessages.get(t);i&&(n?i.resolve(r):i.reject(new Error(o)),this.pendingMessages.delete(t))}}))}destroy(){this.worker&&(this.worker.terminate(),this.worker=null),this.pendingMessages.clear()}};var i=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};const s=new class{constructor(){this.plugins=new Map,this.enabledPlugins=new Set,this.executionTimeouts=new Map,this.DEFAULT_TIMEOUT=5e3}registerPlugin(e){return i(this,void 0,void 0,(function*(){try{const t=yield this.loadPluginFromCode(e.code,e.manifest);this.validatePermissions(t.manifest.permissions||[]),this.plugins.set(e.id,t),e.enabled&&(this.enabledPlugins.add(e.id),t.initialize&&(yield this.executeWithTimeout(t.initialize.bind(t),this.DEFAULT_TIMEOUT)))}catch(t){throw new Error(`Failed to register plugin ${e.manifest.name}: ${t instanceof Error?t.message:String(t)}`)}}))}unregisterPlugin(e){return i(this,void 0,void 0,(function*(){const t=this.plugins.get(e);t&&t.destroy&&(yield this.executeWithTimeout(t.destroy.bind(t),this.DEFAULT_TIMEOUT)),this.plugins.delete(e),this.enabledPlugins.delete(e)}))}enablePlugin(e){this.plugins.has(e)&&this.enabledPlugins.add(e)}disablePlugin(e){this.enabledPlugins.delete(e)}executeHook(e,t,n){return i(this,void 0,void 0,(function*(){const r=[];for(const[o,i]of this.plugins){if(!this.enabledPlugins.has(o))continue;const s=i.hooks[e];if(!s)continue;const a=Date.now();try{yield this.executeWithTimeout((()=>s(t,n)),this.executionTimeouts.get(o)||this.DEFAULT_TIMEOUT),r.push({success:!0,executionTime:Date.now()-a})}catch(t){r.push({success:!1,error:t instanceof Error?t.message:String(t),executionTime:Date.now()-a}),console.error(`Plugin ${i.manifest.name} hook ${e} failed:`,t)}}return r}))}loadPluginFromCode(e,t){return i(this,void 0,void 0,(function*(){return o.executePluginCode(e,t,t.permissions||[])}))}validatePermissions(e){const t=["storage","network","clipboard","notifications"];for(const n of e)if(!t.includes(n))throw new Error(`Invalid permission: ${n}`)}executeWithTimeout(e,t){return i(this,void 0,void 0,(function*(){return new Promise(((n,r)=>{const o=setTimeout((()=>{r(new Error("Plugin execution timeout"))}),t);Promise.resolve(e()).then(n).catch(r).finally((()=>clearTimeout(o)))}))}))}getPlugin(e){return this.plugins.get(e)}getAllPlugins(){return Array.from(this.plugins.values())}getEnabledPlugins(){return Array.from(this.plugins.entries()).filter((([e])=>this.enabledPlugins.has(e))).map((([,e])=>e))}setPluginTimeout(e,t){this.executionTimeouts.set(e,t)}}},668:(e,t,n)=>{n.d(t,{j:()=>i});var r=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};const o="plugins",i=new class{constructor(){this.dbPromise=null}openDatabase(){return this.dbPromise||(this.dbPromise=new Promise(((e,t)=>{const n=indexedDB.open("TrayDatabase",4);n.onupgradeneeded=e=>{const t=n.result;if(t.objectStoreNames.contains("trays")||t.createObjectStore("trays",{keyPath:"id"}),!t.objectStoreNames.contains(o)){const e=t.createObjectStore(o,{keyPath:"id"});e.createIndex("name","manifest.name",{unique:!1}),e.createIndex("enabled","enabled",{unique:!1})}},n.onsuccess=()=>{e(n.result)},n.onerror=()=>{t(n.error)}}))),this.dbPromise}savePlugin(e){return r(this,void 0,void 0,(function*(){const t=yield this.openDatabase();return new Promise(((n,r)=>{const i=t.transaction(o,"readwrite").objectStore(o).put(Object.assign(Object.assign({},e),{lastUpdated:Date.now()}));i.onsuccess=()=>n(),i.onerror=()=>r(i.error)}))}))}getPlugin(e){return r(this,void 0,void 0,(function*(){const t=yield this.openDatabase();return new Promise(((n,r)=>{const i=t.transaction(o,"readonly").objectStore(o).get(e);i.onsuccess=()=>{n(i.result||null)},i.onerror=()=>r(i.error)}))}))}getAllPlugins(){return r(this,void 0,void 0,(function*(){try{const e=yield this.openDatabase();return e.objectStoreNames.contains(o)?new Promise(((t,n)=>{const r=e.transaction(o,"readonly").objectStore(o).getAll();r.onsuccess=()=>{t(r.result||[])},r.onerror=()=>n(r.error)})):(console.warn("Plugins store not found, returning empty array"),[])}catch(e){return console.error("Error getting all plugins:",e),[]}}))}getEnabledPlugins(){return r(this,void 0,void 0,(function*(){return(yield this.getAllPlugins()).filter((e=>e.enabled))}))}deletePlugin(e){return r(this,void 0,void 0,(function*(){const t=yield this.openDatabase();return new Promise(((n,r)=>{const i=t.transaction(o,"readwrite").objectStore(o).delete(e);i.onsuccess=()=>n(),i.onerror=()=>r(i.error)}))}))}updatePluginStatus(e,t){return r(this,void 0,void 0,(function*(){const n=yield this.getPlugin(e);if(!n)throw new Error(`Plugin ${e} not found`);n.enabled=t,n.lastUpdated=Date.now(),yield this.savePlugin(n)}))}installPlugin(e,t){return r(this,void 0,void 0,(function*(){const n={id:e.id,manifest:e,code:t,enabled:!1,installDate:Date.now(),lastUpdated:Date.now()};return yield this.savePlugin(n),n}))}}},569:(e,t,n)=>{n.d(t,{Ay:()=>F,B5:()=>N,G6:()=>M,Go:()=>L,II:()=>A,JS:()=>R,Q1:()=>$,ry:()=>C,tz:()=>I});var r=n(816);const o={trays:{},hierarchy:{rootId:null,parentToChildren:{},childToParent:{}},ui:{focused:null,selected:new Set,editing:null,collapsed:new Set,visible:new Set},app:{hamburgerMenuOpen:!1,contextMenuOpen:!1,hookDialogOpen:!1,autoUploadEnabled:!1,lastSyncTime:null},network:{autoUpload:{},syncStatus:{},lastError:null}},i=(0,r.Z0)({name:"app",initialState:o,reducers:{setTrayData(e,t){e.trays[t.payload.id]=t.payload.data},updateTrayData(e,t){const{id:n,updates:r}=t.payload;e.trays[n]&&(e.trays[n]=Object.assign(Object.assign({},e.trays[n]),r))},removeTrayData(e,t){delete e.trays[t.payload]},setHierarchy(e,t){e.hierarchy=t.payload},setRootId(e,t){e.hierarchy.rootId=t.payload},addChildToParent(e,t){const{parentId:n,childId:r}=t.payload;e.hierarchy.parentToChildren[n]||(e.hierarchy.parentToChildren[n]=[]),e.hierarchy.parentToChildren[n].includes(r)||e.hierarchy.parentToChildren[n].push(r),e.hierarchy.childToParent[r]=n},removeChildFromParent(e,t){const{parentId:n,childId:r}=t.payload;e.hierarchy.parentToChildren[n]&&(e.hierarchy.parentToChildren[n]=e.hierarchy.parentToChildren[n].filter((e=>e!==r))),delete e.hierarchy.childToParent[r]},setFocused(e,t){e.ui.focused=t.payload},toggleSelected(e,t){const n=t.payload;e.ui.selected.has(n)?e.ui.selected.delete(n):e.ui.selected.add(n)},setSelected(e,t){e.ui.selected=new Set(t.payload)},clearSelected(e){e.ui.selected.clear()},setEditing(e,t){e.ui.editing=t.payload},toggleCollapsed(e,t){const n=t.payload;e.ui.collapsed.has(n)?e.ui.collapsed.delete(n):e.ui.collapsed.add(n)},setCollapsed(e,t){const{id:n,collapsed:r}=t.payload;r?e.ui.collapsed.add(n):e.ui.collapsed.delete(n)},setVisible(e,t){e.ui.visible=new Set(t.payload)},toggleMenuOpening(e){e.app.hamburgerMenuOpen=!e.app.hamburgerMenuOpen},openMenu(e){e.app.hamburgerMenuOpen=!0},closeMenu(e){e.app.hamburgerMenuOpen=!1},setContextMenuOpen(e,t){e.app.contextMenuOpen=t.payload},setHookDialogOpen(e,t){e.app.hookDialogOpen=t.payload},toggleAutoUpload(e){e.app.autoUploadEnabled=!e.app.autoUploadEnabled},setLastSyncTime(e,t){e.app.lastSyncTime=t.payload},setTrayAutoUpload(e,t){const{id:n,autoUpload:r}=t.payload;e.network.autoUpload[n]=r},setTraySyncStatus(e,t){const{id:n,status:r}=t.payload;e.network.syncStatus[n]=r},setNetworkError(e,t){e.network.lastError=t.payload},setLastFocused(e,t){const n="string"==typeof t.payload?t.payload:t.payload.id;n&&(e.ui.focused=n)},loadAppState(e,t){const n=t.payload;n.trays&&(e.trays=n.trays),n.hierarchy&&(e.hierarchy=n.hierarchy),n.ui&&(e.ui=Object.assign(Object.assign(Object.assign({},e.ui),n.ui),{selected:new Set(Array.from(n.ui.selected||[])),collapsed:new Set(Array.from(n.ui.collapsed||[])),visible:new Set(Array.from(n.ui.visible||[]))})),n.app&&(e.app=Object.assign(Object.assign({},e.app),n.app)),n.network&&(e.network=Object.assign(Object.assign({},e.network),n.network))},resetState:e=>o}}),{setTrayData:s,updateTrayData:a,removeTrayData:c,setHierarchy:l,setRootId:d,addChildToParent:u,removeChildFromParent:p,setFocused:h,toggleSelected:y,setSelected:f,clearSelected:g,setEditing:m,toggleCollapsed:v,setCollapsed:b,setVisible:w,toggleMenuOpening:x,openMenu:k,closeMenu:E,setContextMenuOpen:S,setHookDialogOpen:T,toggleAutoUpload:C,setLastSyncTime:D,setTrayAutoUpload:_,setTraySyncStatus:A,setNetworkError:I,setLastFocused:L,loadAppState:P,resetState:O}=i.actions,$=e=>e.app.app.autoUploadEnabled,N=(e,t)=>e.app.network.autoUpload[t],M=(e,t)=>e.app.network.syncStatus[t],R=e=>e.app.network.lastError,F=i.reducer},33:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(816),o=n(569);const i=(0,r.U1)({reducer:{app:o.Ay}})},527:(e,t,n)=>{n.d(t,{O:()=>l});var r=n(33),o=n(569),i=n(278),s=n(935),a=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))};class c{constructor(e={}){this.globalIndicator=null,this.trayIndicators=new Map,this.notificationQueue=[],this.options=Object.assign({showProgress:!0,showErrors:!0,showStatus:!0,position:"top-right",autoHide:!0,hideDelay:5e3},e)}static getInstance(e){return c.instance||(c.instance=new c(e)),c.instance}initialize(){this.createGlobalIndicator(),this.setupStateListener(),this.createStyles(),console.log("Sync indicator system initialized")}createGlobalIndicator(){this.globalIndicator||(this.globalIndicator=document.createElement("div"),this.globalIndicator.className="sync-global-indicator",this.globalIndicator.style.cssText=this.getGlobalIndicatorStyles(),document.body.appendChild(this.globalIndicator),this.updateGlobalIndicator())}updateGlobalIndicator(){if(!this.globalIndicator)return;const e=r.A.getState(),t=(0,o.Q1)(e),n=i.io.getSyncStatus(),s=(0,o.JS)(e);let a="🔄",c="Auto-Sync",l="idle";t?s?(a="❌",c=`Sync Error: ${s}`,l="error"):n.activeSyncs>0?(a="🔄",c=`Syncing ${n.activeSyncs} tray(s)...`,l="syncing"):n.queueLength>0?(a="⏳",c=`${n.queueLength} tray(s) queued for sync`,l="pending"):n.autoSyncTrays>0&&(a="✅",c=`Auto-sync active (${n.autoSyncTrays} trays)`,l="active"):(a="⏸️",c="Auto-Sync: Disabled",l="disabled"),this.globalIndicator.innerHTML=`\n      <div class="sync-indicator-content">\n        <span class="sync-icon">${a}</span>\n        <span class="sync-text">${n.autoSyncTrays}</span>\n      </div>\n    `,this.globalIndicator.title=c,this.globalIndicator.className=`sync-global-indicator ${l}`,this.globalIndicator.onclick=()=>this.showSyncDetails()}addTrayIndicator(e,t){if(!e.host_url||!e.filename)return;const n=document.createElement("div");n.className="sync-tray-indicator",n.style.cssText=this.getTrayIndicatorStyles(),t.appendChild(n),this.trayIndicators.set(e.id,n),this.updateTrayIndicator(e.id)}updateTrayIndicator(e){const t=this.trayIndicators.get(e);if(!t)return;const n=r.A.getState(),i=(0,o.G6)(n,e);let s="",a="",c="";switch(i){case"syncing":s="🔄",a="syncing",c="Syncing...";break;case"synced":s="✅",a="synced",c="Synced";break;case"error":s="❌",a="error",c="Sync failed";break;default:s="⏳",a="pending",c="Pending sync"}t.innerHTML=s,t.className=`sync-tray-indicator ${a}`,t.title=c,"synced"===i&&this.options.autoHide&&setTimeout((()=>{t.className.includes("synced")&&(t.style.opacity="0.3")}),this.options.hideDelay||5e3)}removeTrayIndicator(e){const t=this.trayIndicators.get(e);t&&t.parentNode&&(t.parentNode.removeChild(t),this.trayIndicators.delete(e))}showSyncProgress(e,t){if(!this.options.showProgress)return;const n=this.createNotification("progress",e,t);this.showNotification(n)}showSyncError(e,t){if(!this.options.showErrors)return;const n=this.createNotification("error",e,void 0,t);this.showNotification(n)}showSyncSuccess(e){const t=this.createNotification("success",e);this.showNotification(t)}createNotification(e,t,n,r){const o=document.createElement("div");o.className=`sync-notification sync-notification-${e}`,o.style.cssText=this.getNotificationStyles(e);let i=`\n      <div class="sync-notification-header">\n        <span class="sync-notification-icon">${"error"===e?"❌":"success"===e?"✅":"🔄"}</span>\n        <span class="sync-notification-message">${t}</span>\n        <button class="sync-notification-close" onclick="this.parentElement.parentElement.remove()">×</button>\n      </div>\n    `;return void 0!==n&&(i+=`\n        <div class="sync-progress-bar">\n          <div class="sync-progress-fill" style="width: ${n}%"></div>\n        </div>\n      `),r&&(i+=`\n        <div class="sync-notification-details">${r}</div>\n      `),o.innerHTML=i,o}showNotification(e){document.body.appendChild(e),this.notificationQueue.push(e),this.updateNotificationPositions(),this.options.autoHide&&setTimeout((()=>{this.removeNotification(e)}),this.options.hideDelay||5e3)}removeNotification(e){e.parentNode&&(e.style.transition="opacity 0.3s, transform 0.3s",e.style.opacity="0",e.style.transform="translateX(100%)",setTimeout((()=>{e.parentNode&&e.parentNode.removeChild(e),this.notificationQueue=this.notificationQueue.filter((t=>t!==e)),this.updateNotificationPositions()}),300))}updateNotificationPositions(){this.notificationQueue.forEach(((e,t)=>{const n=80*t;e.style.transform=`translateY(${n}px)`}))}showSyncDetails(){const e=r.A.getState(),t=i.io.getSyncStatus(),n=(0,o.JS)(e),s=i.io.getResourceStats(),a=document.createElement("div");a.className="sync-details-modal",a.style.cssText=this.getModalStyles(),a.innerHTML=`\n      <div class="sync-details-content">\n        <div class="sync-details-header">\n          <h3>Sync Status Details</h3>\n          <button class="sync-details-close" onclick="this.parentElement.parentElement.parentElement.remove()">×</button>\n        </div>\n        \n        <div class="sync-details-body">\n          <div class="sync-status-grid">\n            <div class="sync-status-item">\n              <strong>Status:</strong> ${t.isRunning?"Running":"Stopped"}\n            </div>\n            <div class="sync-status-item">\n              <strong>Active Syncs:</strong> ${t.activeSyncs}\n            </div>\n            <div class="sync-status-item">\n              <strong>Queue Length:</strong> ${t.queueLength}\n            </div>\n            <div class="sync-status-item">\n              <strong>Network Trays:</strong> ${t.networkTrays}\n            </div>\n            <div class="sync-status-item">\n              <strong>Auto-Sync Trays:</strong> ${t.autoSyncTrays}\n            </div>\n            <div class="sync-status-item">\n              <strong>Memory Usage:</strong> ${s.memoryEstimate}\n            </div>\n          </div>\n          \n          ${n?`<div class="sync-error-display">\n            <strong>Last Error:</strong> ${n}\n          </div>`:""}\n          \n          <div class="sync-actions">\n            <button onclick="globalSyncManager.forceSyncCheck(); this.parentElement.parentElement.parentElement.parentElement.remove();">\n              🔄 Force Sync Check\n            </button>\n            <button onclick="globalSyncManager.stop(); this.parentElement.parentElement.parentElement.parentElement.remove();">\n              ⏹️ Stop Sync\n            </button>\n            <button onclick="globalSyncManager.start(); this.parentElement.parentElement.parentElement.parentElement.remove();">\n              ▶️ Start Sync\n            </button>\n            <button onclick="syncIndicatorManager.showIntegrityCheck(); this.parentElement.parentElement.parentElement.parentElement.remove();">\n              🔍 Data Integrity Check\n            </button>\n            <button onclick="syncIndicatorManager.showBackupManager(); this.parentElement.parentElement.parentElement.parentElement.remove();">\n              💾 Backup Manager\n            </button>\n          </div>\n        </div>\n      </div>\n    `,document.body.appendChild(a),a.addEventListener("click",(e=>{e.target===a&&a.remove()}))}setupStateListener(){r.A.subscribe((()=>{this.updateGlobalIndicator(),this.trayIndicators.forEach(((e,t)=>{this.updateTrayIndicator(t)}))}))}createStyles(){if(document.getElementById("sync-indicator-styles"))return;const e=document.createElement("style");e.id="sync-indicator-styles",e.textContent="\n      @keyframes sync-spin {\n        from { transform: rotate(0deg); }\n        to { transform: rotate(360deg); }\n      }\n      \n      @keyframes sync-pulse {\n        0%, 100% { opacity: 1; }\n        50% { opacity: 0.5; }\n      }\n      \n      .sync-global-indicator.syncing .sync-icon {\n        animation: sync-spin 1s linear infinite;\n      }\n      \n      .sync-tray-indicator.syncing {\n        animation: sync-spin 1s linear infinite;\n      }\n      \n      .sync-notification {\n        transition: all 0.3s ease;\n      }\n      \n      .sync-notification:hover {\n        transform: translateX(-5px);\n      }\n      \n      .sync-details-modal {\n        backdrop-filter: blur(4px);\n      }\n    ",document.head.appendChild(e)}getGlobalIndicatorStyles(){const e=this.options.position||"top-right",[t,n]=e.split("-");return`\n      position: fixed;\n      ${t}: 20px;\n      ${n}: 20px;\n      background: #fff;\n      border: 2px solid #ddd;\n      border-radius: 8px;\n      padding: 8px 12px;\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n      z-index: 10000;\n      cursor: pointer;\n      transition: all 0.3s ease;\n      font-family: system-ui, -apple-system, sans-serif;\n      font-size: 14px;\n      user-select: none;\n    `}getTrayIndicatorStyles(){return"\n      position: absolute;\n      top: 4px;\n      right: 4px;\n      width: 16px;\n      height: 16px;\n      border-radius: 50%;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      font-size: 10px;\n      z-index: 100;\n      transition: all 0.3s ease;\n    "}getNotificationStyles(e){return`\n      position: fixed;\n      top: 80px;\n      right: 20px;\n      background: white;\n      border-left: 4px solid ${{error:"#dc3545",success:"#28a745",progress:"#007bff"}[e]};\n      border-radius: 6px;\n      padding: 16px;\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n      z-index: 10001;\n      min-width: 300px;\n      max-width: 400px;\n      font-family: system-ui, -apple-system, sans-serif;\n      font-size: 14px;\n    `}getModalStyles(){return"\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0, 0, 0, 0.5);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      z-index: 10002;\n      font-family: system-ui, -apple-system, sans-serif;\n    "}showIntegrityCheck(){return a(this,void 0,void 0,(function*(){try{this.showSyncProgress("Running data integrity check...",0);const e=yield i.io.performIntegrityCheck(),t=document.createElement("div");t.className="sync-details-modal",t.style.cssText=this.getModalStyles();const n=e.details.map((e=>`\n        <div class="integrity-check-item ${e.isValid?"valid":"invalid"}">\n          <div class="tray-info">\n            <strong>${e.trayName}</strong> (${e.trayId})\n          </div>\n          <div class="validation-status">\n            ${e.isValid?"✅ Valid":"❌ Invalid"}\n            ${e.errorCount>0?` - ${e.errorCount} errors`:""}\n            ${e.warningCount>0?` - ${e.warningCount} warnings`:""}\n          </div>\n          ${e.isValid?"":`\n            <button onclick="syncIndicatorManager.showRecoveryOptions('${e.trayId}')">\n              🔧 Recovery Options\n            </button>\n          `}\n        </div>\n      `)).join("");t.innerHTML=`\n        <div class="sync-details-content">\n          <div class="sync-details-header">\n            <h3>Data Integrity Check Results</h3>\n            <button class="sync-details-close" onclick="this.parentElement.parentElement.parentElement.remove()">×</button>\n          </div>\n          \n          <div class="sync-details-body">\n            <div class="integrity-summary">\n              <div class="summary-item">\n                <strong>Total Trays:</strong> ${e.totalTrays}\n              </div>\n              <div class="summary-item">\n                <strong>Valid:</strong> <span class="valid-count">${e.validTrays}</span>\n              </div>\n              <div class="summary-item">\n                <strong>Invalid:</strong> <span class="invalid-count">${e.invalidTrays}</span>\n              </div>\n              <div class="summary-item">\n                <strong>Warnings:</strong> ${e.warnings}\n              </div>\n            </div>\n            \n            <div class="integrity-details">\n              <h4>Tray Details:</h4>\n              ${n||"<p>No trays found.</p>"}\n            </div>\n            \n            <div class="sync-actions">\n              <button onclick="this.parentElement.parentElement.parentElement.remove();">\n                Close\n              </button>\n            </div>\n          </div>\n        </div>\n      `,document.body.appendChild(t),t.addEventListener("click",(e=>{e.target===t&&t.remove()})),this.removeNotification(document.querySelector(".sync-notification-progress"))}catch(e){this.showSyncError("Integrity check failed",e instanceof Error?e.message:"Unknown error")}}))}showBackupManager(){return a(this,void 0,void 0,(function*(){try{const e=yield s.D.getBackupStats(),t=document.createElement("div");t.className="sync-details-modal",t.style.cssText=this.getModalStyles(),t.innerHTML=`\n        <div class="sync-details-content">\n          <div class="sync-details-header">\n            <h3>Backup Manager</h3>\n            <button class="sync-details-close" onclick="this.parentElement.parentElement.parentElement.remove()">×</button>\n          </div>\n          \n          <div class="sync-details-body">\n            <div class="backup-summary">\n              <div class="summary-item">\n                <strong>Total Backups:</strong> ${e.totalBackups}\n              </div>\n              <div class="summary-item">\n                <strong>Total Size:</strong> ${Math.round(e.totalSize/1024)}KB\n              </div>\n              <div class="summary-item">\n                <strong>Oldest:</strong> ${e.oldestBackup?e.oldestBackup.toLocaleString():"N/A"}\n              </div>\n              <div class="summary-item">\n                <strong>Newest:</strong> ${e.newestBackup?e.newestBackup.toLocaleString():"N/A"}\n              </div>\n            </div>\n            \n            <div class="backup-operations">\n              <h4>Operations by Type:</h4>\n              ${Object.entries(e.backupsByOperation).map((([e,t])=>`\n                <div class="operation-count">\n                  <strong>${e}:</strong> ${t}\n                </div>\n              `)).join("")}\n            </div>\n            \n            <div class="sync-actions">\n              <button onclick="dataIntegrityManager.cleanupBackups(); this.parentElement.parentElement.parentElement.parentElement.remove();">\n                🧹 Cleanup Old Backups\n              </button>\n              <button onclick="this.parentElement.parentElement.parentElement.remove();">\n                Close\n              </button>\n            </div>\n          </div>\n        </div>\n      `,document.body.appendChild(t),t.addEventListener("click",(e=>{e.target===t&&t.remove()}))}catch(e){this.showSyncError("Failed to load backup manager",e instanceof Error?e.message:"Unknown error")}}))}showRecoveryOptions(e){return a(this,void 0,void 0,(function*(){try{const t=yield i.io.getRecoveryOptions(e);if(0===t.length)return void this.showSyncError("No recovery options available","No backups found for this tray");const n=document.createElement("div");n.className="sync-details-modal",n.style.cssText=this.getModalStyles();const r=t.map((e=>`\n        <div class="recovery-option risk-${e.riskLevel}">\n          <div class="recovery-option-header">\n            <strong>${e.label}</strong>\n            <span class="risk-badge risk-${e.riskLevel}">${e.riskLevel.toUpperCase()} RISK</span>\n          </div>\n          <div class="recovery-option-description">\n            ${e.description}\n          </div>\n          <button onclick="syncIndicatorManager.performRecovery('${e.id}'); this.parentElement.parentElement.parentElement.parentElement.remove();">\n            Restore from this backup\n          </button>\n        </div>\n      `)).join("");n.innerHTML=`\n        <div class="sync-details-content">\n          <div class="sync-details-header">\n            <h3>Recovery Options</h3>\n            <button class="sync-details-close" onclick="this.parentElement.parentElement.parentElement.remove()">×</button>\n          </div>\n          \n          <div class="sync-details-body">\n            <div class="recovery-warning">\n              ⚠️ Recovery will replace the current tray data. Make sure you understand the implications.\n            </div>\n            \n            <div class="recovery-options">\n              ${r}\n            </div>\n            \n            <div class="sync-actions">\n              <button onclick="this.parentElement.parentElement.parentElement.remove();">\n                Cancel\n              </button>\n            </div>\n          </div>\n        </div>\n      `,document.body.appendChild(n),n.addEventListener("click",(e=>{e.target===n&&n.remove()}))}catch(e){this.showSyncError("Failed to load recovery options",e instanceof Error?e.message:"Unknown error")}}))}performRecovery(e){return a(this,void 0,void 0,(function*(){try{this.showSyncProgress("Recovering tray from backup...",50),yield i.io.recoverTrayFromBackup(e),this.showSyncSuccess("Tray recovered successfully")}catch(e){this.showSyncError("Recovery failed",e instanceof Error?e.message:"Unknown error")}}))}}c.instance=null;const l=c.getInstance()},627:(e,t,n)=>{n.d(t,{f:()=>S});var r=n(185),o=n(896),i=n(681),s=n(20),a=n(973),c=n(859),l=n(669),d=n(33),u=n(598);const p=[{act:"fetchTrayFromServer",label:"Fetch Tray from Server"},{act:"networkSetting",label:"Network Setting"},{act:"removeFromServer",label:"Remove from Server"},{act:"openTrayInOther",label:"Open This in Other"},{act:"toggleFlexDirection",label:"Toggle Flex Direction"},{act:"insertParentTray",label:"Insert Parent Tray"},{act:"insertChildTray",label:"Insert Child Tray"},{act:"meltTray",label:"Melt this Tray"},{act:"expandAll",label:"Expand All"},{act:"expandChildrenOneLevel",label:"Expand Children 1 Level"},{act:"copy",label:"Copy"},{act:"paste",label:"Paste"},{act:"cut",label:"Cut"},{act:"delete",label:"Remove"},{act:"add_fetch_networkTray_to_child",label:"Add Fetch NetworkTray to Child"},{act:"add_child_from_localStorage",label:"Add Child from Local Storage"},{act:"addProperty",label:"Set Property"},{act:"sortChildren",label:"Sort Children"},{act:"copyMarkdown",label:"Copy Markdown"},{act:"downloadMarkdown",label:"Download Markdown"}],h=function(){const e=document.createElement("div");e.className="context-menu",e.tabIndex=-1;for(const t of p){const n=document.createElement("div");n.className="menu-item","dataset"in n||(n.dataset={}),n.dataset.act=t.act,n.textContent=t.label,e.appendChild(n)}const t=document.createElement("div");t.className="menu-item";const n=document.createElement("input");return n.type="color",n.id="borderColorPicker",t.appendChild(n),e.appendChild(t),e}();function y(e,t){h.isConnected||document.body.appendChild(h),h.style.display="block",function(e,t){const n="clientX"in e?{x:e.clientX,y:e.clientY}:{x:e.touches[0].clientX,y:e.touches[0].clientY},{width:r,height:o}=t.getBoundingClientRect();let i=n.x+r>window.innerWidth?n.x-r:n.x,s=n.y+o>window.innerHeight?n.y-o:n.y;i=Math.max(0,i),s=Math.max(0,s),t.style.position="fixed",t.style.left=`${i}px`,t.style.top=`${s}px`,t.style.transform=""}(t,h),function(e){var t;const n=h.querySelector("#borderColorPicker");n.value=null!==(t=e.borderColor)&&void 0!==t?t:"#ffffff",n.onchange=t=>{var n;const r=t.target.value;e.borderColor=r,null===(n=e.changeBorderColor)||void 0===n||n.call(e,r),g()},h.onclick=t=>{const n=t.target.getAttribute("data-act");n&&function(e,t){var n,r,s;switch(t){case"copy":navigator.clipboard.writeText((0,i.serialize)((0,u.g)(e)));break;case"paste":(0,l.Iz)(e);break;case"cut":navigator.clipboard.writeText((0,i.serialize)((0,u.g)(e))),(0,l.ql)(e);break;case"delete":(0,l.ql)(e);break;case"networkSetting":(0,a.AC)(e);break;case"meltTray":(0,l.Lg)(e);break;case"expandChildrenOneLevel":(0,o.sN)(e);break;case"toggleFlexDirection":null===(n=e.toggleFlexDirection)||void 0===n||n.call(e);break;case"insertParentTray":null===(r=e.insertParentTray)||void 0===r||r.call(e);break;case"insertChildTray":null===(s=e.insertChildTray)||void 0===s||s.call(e);break;case"copyMarkdown":(0,l.wC)(e);break;case"downloadMarkdown":(0,l.ii)(e);break;case"fetchTrayFromServer":(0,a.L)(e);break;case"removeFromServer":confirm("Are you sure you want to remove this tray from the server?")&&(0,a.oy)(e);break;case"addProperty":{const t=prompt("Property name:","priority")||"priority",n=prompt(`Value for '${t}':`,"");null!==n&&e.addProperty(t,n);break}case"sortChildren":!function(e){const t=new Set;t.add("created_dt"),e.children.forEach((e=>{Object.keys(e.properties).forEach((e=>t.add(e)))}));const n=document.createElement("div");n.classList.add("sort-selection-dialog"),n.innerHTML=`\n      <h3>Sort Children</h3>\n      <label>Property:\n        <select id="sort-prop">\n          ${Array.from(t).map((e=>`<option value="${e}">${e}</option>`)).join("")}\n        </select>\n      </label>\n      <label>Order:\n        <select id="sort-order">\n          <option value="asc" selected>Ascending</option>\n          <option value="desc">Descending</option>\n        </select>\n      </label>\n      <button id="sort-ok">Sort</button>\n      <button id="sort-cancel">Cancel</button>\n    `,document.body.appendChild(n);const r=n.querySelector("#sort-ok"),o=n.querySelector("#sort-cancel");r.addEventListener("click",(()=>{const t=n.querySelector("#sort-prop").value,r=n.querySelector("#sort-order").value;e.sortChildren(t,"desc"===r),n.remove()})),o.addEventListener("click",(()=>n.remove()))}(e);break;default:console.warn(`Unknown context-menu action: ${t}`)}null===i.saveToIndexedDB||void 0===i.saveToIndexedDB||(0,i.saveToIndexedDB)(),g()}(e,n)}}(e),h.focus(),function(){const e=Array.from(h.querySelectorAll(".menu-item"));let t=0;const n=t=>{var n,r;e.forEach((e=>e.classList.remove("focused")));const o=e[t];o.classList.add("focused"),null===(r=(n=o).focus)||void 0===r||r.call(n)};n(t),m=r=>{switch(r.key){case"ArrowDown":r.preventDefault(),t=(t+1)%e.length,n(t);break;case"ArrowUp":r.preventDefault(),t=(t-1+e.length)%e.length,n(t);break;case"Enter":r.preventDefault(),e[t].click();break;case"Escape":r.preventDefault(),g()}},h.addEventListener("keydown",m)}(),console.log("openContextMenu OK");const n=e=>{h.contains(e.target)||(g(),document.removeEventListener("pointerdown",n))};document.addEventListener("pointerdown",n)}function f(e){const t=e.element.getBoundingClientRect();y(e,{clientX:t.left+t.width/2,clientY:t.top+t.height/2})}function g(){h.style.display="none",m&&(h.removeEventListener("keydown",m),m=null),h.querySelectorAll(".menu-item").forEach((e=>e.classList.remove("focused")))}document.body.appendChild(h),h.style.display="none";let m=null;var v=n(944);let b={trayId:"",time:0};function w(e,t){if(e.isEditing)return;if(d.A.getState().app.app.hamburgerMenuOpen)return;let n;switch(t){case"up":n=function(e){if(e.parentId){const t=(0,o.yr)(e.parentId),n=t.children.indexOf(e);return t.children[n-1]||null}return null}(e);break;case"down":n=function(e){if(e.parentId){const t=(0,o.yr)(e.parentId),n=t.children.indexOf(e);return t.children[n+1]||null}return null}(e);break;case"left":n=(0,o.yr)(e.parentId);break;case"right":n=e.children[0]}if(n){n.element.focus();const e=n.element.getBoundingClientRect(),t=window.innerHeight||document.documentElement.clientHeight;(e.top<0||e.bottom>t)&&n.element.scrollIntoView({behavior:"smooth",block:"nearest"})}}var x=n(569),k=n(640),E=n(527);class S{constructor(e,t,n,o=null,i=null,s="column",a=null,c=null,l=!0,d={},u=[],p=!1){this.id=t,this.name=n,this.children=[],this.parentId=e,this.isFolded=l,this.borderColor=o||(0,r.f4)(),this.created_dt=i?new Date(i):new Date,this.host_url=a,this.filename=c,this.flexDirection=s,this.properties=d,this.hooks=u.length>0?u:this.parseHooksFromName(n),this.isDone=p||this.checkDoneStateFromName(n),this.autoUpload=!(!a||!c),this.showDoneMarker=!1,this.isEditing=!1,this.isSelected=!1,this._element=null,this.updateAppearance(),this.updateBorderColor(this.borderColor)}get element(){if(!this._element){const e=this.createElement();this._element=e}return this._element}createElement(){const e=document.createElement("div");e.classList.add("tray"),e.setAttribute("draggable","true"),e.setAttribute("data-tray-id",this.id),e.style.display="block";const t=document.createElement("div");t.classList.add("tray-title-container");const n=document.createElement("div");n.classList.add("tray-checkbox-container");const r=document.createElement("span");r.classList.add("tray-created-time"),r.textContent=this.formatCreatedTime(),r.style.fontSize="0.8em",r.style.color="#888";const o=document.createElement("input");o.type="checkbox",o.classList.add("tray-checkbox"),o.checked=this.isSelected,o.addEventListener("change",this.onCheckboxChange.bind(this)),n.appendChild(o);const i=document.createElement("div");i.classList.add("tray-title"),i.setAttribute("contenteditable","false"),this.updateTitleContent(i);const s=document.createElement("button");s.classList.add("tray-context-menu-button"),s.textContent="⋮",s.addEventListener("click",this.onContextMenuButtonClick.bind(this)),i.addEventListener("contextmenu",(e=>{e.stopPropagation(),y(this,e)})),i.addEventListener("dblclick",(e=>{i.setAttribute("contenteditable","true"),e.stopPropagation(),e.target.focus()})),i.addEventListener("click",(e=>{e.stopPropagation(),this.toggleDoneMarker(i)})),this.setupTitleEditing(i);const l=document.createElement("div");l.classList.add("tray-content"),l.style.flexDirection=this.flexDirection,l.style.overflowY="auto",t.addEventListener("dblclick",this.onDoubleClick.bind(this));const u=document.createElement("button");u.classList.add("tray-fold-button"),u.textContent="▼",u.addEventListener("click",(e=>{1===e.detail?this.toggleFold():2===e.detail&&this.unfoldChildren()}));const p=document.createElement("button");p.classList.add("tray-fold-button-right"),p.textContent="▼",p.addEventListener("click",this.toggleFold.bind(this)),p.style.display="none",t.appendChild(u),t.appendChild(i),t.appendChild(p),t.appendChild(s),t.appendChild(n),e.appendChild(t),e.append(l),e.addEventListener("dragstart",this.onDragStart.bind(this)),e.addEventListener("dragover",this.onDragOver.bind(this)),e.addEventListener("dragenter",this.onDragEnter.bind(this)),e.addEventListener("dragleave",this.onDragLeave.bind(this)),e.addEventListener("dragend",this.onDragEnd.bind(this)),e.addEventListener("drop",this.onDrop.bind(this)),l.addEventListener("dblclick",this.onDoubleClick.bind(this)),c.P.set(e,this),this.host_url&&this.filename&&E.O.addTrayIndicator(this,e),this.setupKeyboardNavigation(e);const h=document.createElement("div");h.classList.add("network-tray-info");const f=document.createElement("button");f.textContent="URL",this.host_url&&""!==this.host_url.trim()?(f.style.backgroundColor="green",f.style.color="white"):(f.style.backgroundColor="gray",f.style.color="white"),f.title=this.host_url||"No URL set";const g=document.createElement("div");g.textContent=`${this.filename}`,h.appendChild(f),h.appendChild(g);const m=document.createElement("div");m.classList.add("network-tray-buttons"),m.style.display="flex",m.style.flexDirection="column",m.style.alignItems="flex-start",m.style.gap="5px";const v=document.createElement("div");v.classList.add("network-tray-actions");const b=document.createElement("button");b.textContent="↑",b.addEventListener("click",(()=>{(0,a.O6)(this).catch((e=>alert(e.message)))}));const w=document.createElement("button");w.textContent="↓",w.addEventListener("click",(()=>{(0,a.O6)(this).catch((e=>alert(e.message)))}));const k=document.createElement("button");return k.textContent="♻️",this.autoUpload&&k.classList.add("auto-upload-on"),k.addEventListener("click",(()=>this.toggleAutoUpload(k))),v.appendChild(b),v.appendChild(w),v.appendChild(k),m.appendChild(h),m.appendChild(v),null!=this.filename?(m.appendChild(r),t.appendChild(m)):t.appendChild(r),t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="space-between",e.addEventListener("focus",(e=>d.A.dispatch((0,x.Go)(this)))),e.addEventListener("click",(e=>{d.A.dispatch((0,x.Go)(this))})),e.addEventListener("touchstart",(e=>{d.A.dispatch((0,x.Go)(this))})),e}setupFocusTracking(e){e.element.addEventListener("focus",(()=>{(0,x.Go)(e)}),!0),e.element.addEventListener("click",(()=>{(0,x.Go)(e)}),!0)}formatCreatedTime(){const e=new Date(this.created_dt);return`${e.toLocaleDateString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit"})}\n${e.toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"})}`}onCheckboxChange(e){const t=e.target.checked;let n=[...s.km];t?n.push(this):n=n.filter((e=>e.id!==this.id)),s.km.length=0,s.km.push(...n),this.isSelected=t}toggleCheckbox(){const e=!this.isSelected;this.isSelected=e;const t=this.element.querySelector(".tray-checkbox");t&&(t.checked=e);const n=s.km.filter((e=>e.id!==this.id));e&&n.push(this),s.km.length=0,s.km.push(...n)}toggleFlexDirection(){this.flexDirection="column"===this.flexDirection?"row":"column",this.updateFlexDirection(),this.updateChildrenAppearance(),(0,i.saveToIndexedDB)()}toggleAutoUpload(e){this.autoUpload=!this.autoUpload,this.autoUpload?(0,a.N)(this):(0,a.zC)(this),e&&(e.textContent="♻️",this.autoUpload?e.classList.add("auto-upload-on"):e.classList.remove("auto-upload-on"))}setupEventListeners(e){let t,n,r;e.addEventListener("touchstart",(e=>{this.isEditing||(n=e.touches[0].clientX,r=e.touches[0].clientY,t=window.setTimeout((()=>{this.showContextMenu(e)}),500))})),e.addEventListener("touchmove",(e=>{this.isEditing||(Math.abs(e.touches[0].clientX-n)>10||Math.abs(e.touches[0].clientY-r)>10)&&clearTimeout(t)})),e.addEventListener("touchend",(()=>{this.isEditing||clearTimeout(t)}))}updateFlexDirection(){const e=this.element.querySelector(".tray-content");e&&(e.style.flexDirection=this.flexDirection,e.style.display="flex")}updateChildrenAppearance(){this.children.forEach((e=>{"row"===this.flexDirection?(e.element.style.boxSizing="border-box",e.element.style.width="calc(50% - 3px)"):e.element.style.width="100%"}))}removeChild(e){const t=this.children.find((t=>t.id===e));this.children=this.children.filter((t=>t.id!==e)),t&&t.element&&t.element.parentNode&&t.element.parentNode.removeChild(t.element),this.updateAppearance()}updateBorderColor(e){const t=this.element;t&&(t.style.borderLeftColor=e,t.style.borderLeftWidth="3px",t.style.borderLeftStyle="solid",t.style.borderBottomColor=e,t.style.borderBottomWidth="3px",t.style.borderBottomStyle="solid")}changeBorderColor(e){this.updateBorderColor(e),(0,i.saveToIndexedDB)()}isValidUrl(e){return/^https?:\/\/\S+/i.test(e)}isImageUrl(e){return!!e.startsWith("data:image/")||/^https?:\/\/\S+\.(png|jpe?g|gif|bmp|svg)(\?.*)?$/i.test(e)}updateTitleContent(e){this.isDone?e.classList.add("task-done"):e.classList.remove("task-done");const t=this.name;if(this.isImageUrl(t)){const n=document.createElement("img");n.src=t,n.alt=t,e.innerHTML="",e.appendChild(n)}else if(this.isValidUrl(t)){const n=document.createElement("a");n.href=t,n.textContent=t,n.target="_blank",e.innerHTML="",e.appendChild(n)}else e.textContent=t}setupTitleEditing(e){e.addEventListener("dblclick",(t=>{t.stopPropagation(),this.startTitleEdit(e),(0,i.saveToIndexedDB)()}))}toggleFold(){this.isFolded=!this.isFolded,this.foldChildren(),this.updateAppearance(),(0,i.saveToIndexedDB)()}foldChildren(){this.isFolded&&this.children.forEach((e=>{e.isFolded=!0,e.updateAppearance(),e.foldChildren()}))}unfoldChildren(){this.isFolded=!1,this.children.forEach((e=>{e.unfoldChildren()})),this.updateAppearance(),(0,i.saveToIndexedDB)()}updateAppearance(){const e=this.element.querySelector(".tray-content"),t=this.element.querySelector(".tray-fold-button"),n=this.element.querySelector(".tray-fold-button-right");e&&t&&n&&(this.children.length?(t.style.display="inline-block",n.style.display="inline-block",this.isFolded?(e.style.display="none",t.textContent="▶",t.style.display="inline-block",n.textContent="▼",n.style.display="none"):(this.updateBorderColor(this.borderColor),e.style.display="block",t.textContent="▼",t.style.display="none",n.textContent="▶",n.style.display="inline-block",this.updateFlexDirection())):(e.style.display="none",t.style.display="none"))}startTitleEdit(e){this.isEditing=!0,this.showDoneMarker=!0,e.setAttribute("contenteditable","true"),e.textContent=this.name;const t=document.createRange();t.selectNodeContents(e);const n=window.getSelection();n&&(n.removeAllRanges(),n.addRange(t)),e.addEventListener("keydown",(t=>{"Enter"!==t.key||t.shiftKey||(t.preventDefault(),e.blur())})),e.addEventListener("blur",(()=>{this.finishTitleEdit(e)}))}cancelTitleEdit(e){this.isEditing=!1,this.showDoneMarker=!1,e.setAttribute("contenteditable","false"),this.updateTitleContent(e)}onContextMenuButtonClick(e){e.preventDefault(),e.stopPropagation(),this.showContextMenu(e)}showContextMenu(e){y(this,e)}parseHooksFromName(e){const t=e.match(/@(\S+)/g);return t?t.map((e=>e.substring(1))):[]}checkDoneStateFromName(e){return e.includes("@@")}isDescendantOf(e){let t=this.parentId;const n=new Set;let r=0;for(;t&&r<100;){if(n.has(t))return console.warn(`Circular reference detected in tray hierarchy: ${t}`),!1;if(t===e)return!0;n.add(t);const i=(0,o.yr)(t);t=(null==i?void 0:i.parentId)||null,r++}return r>=100&&console.warn(`Maximum iterations reached in isDescendantOf for tray ${this.id}, possible infinite loop prevented`),!1}toggleDoneMarker(e){this.showDoneMarker=!this.showDoneMarker,this.updateTitleContent(e)}clearAllDragStyles(){["drag-over","drop-target","drop-before","drop-after","drop-inside","drag-top","drag-bottom","dragging"].forEach((e=>{this.element.classList.remove(e)})),this.element.style.display="block"}finishTitleEdit(e){return t=this,n=void 0,a=function*(){e.setAttribute("contenteditable","false"),this.name=(e.textContent||"").trim();const t=this.hooks||[];this.hooks=this.parseHooksFromName(this.name),this.isDone=this.checkDoneStateFromName(this.name);const n=this.hooks.filter((e=>!t.includes(e)));if(n.length>0){(0,s.o1)(n);const e={id:this.id,text:this.name,completed:this.isDone,createdAt:this.created_dt.getTime(),completedAt:this.isDone?Date.now():void 0},t={trayId:this.id,trayName:this.name,sessionId:(0,r.Vf)("sessionId")||"default",parentTrayId:this.parentId};yield k.X.executeHook("onTaskHooked",e,t)}const o=t.includes("@@")||this.name.includes("@@");if(this.isDone&&!o){const e={id:this.id,text:this.name,completed:!0,createdAt:this.created_dt.getTime(),completedAt:Date.now()},t={trayId:this.id,trayName:this.name,sessionId:(0,r.Vf)("sessionId")||"default",parentTrayId:this.parentId};yield k.X.executeHook("onTaskCompleted",e,t)}this.showDoneMarker=!1,this.updateTitleContent(e),this.isEditing=!1,(0,i.saveToIndexedDB)();const a=e.closest(".tray");a&&a.focus()},new((o=void 0)||(o=Promise))((function(e,r){function i(e){try{c(a.next(e))}catch(e){r(e)}}function s(e){try{c(a.throw(e))}catch(e){r(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(i,s)}c((a=a.apply(t,n||[])).next())}));var t,n,o,a}onDragStart(e){if(e.stopPropagation(),e.dataTransfer){if(s.km.length>0&&s.km.includes(this)){const t=s.km.map((e=>e.id)).join(",");e.dataTransfer.setData("text/plain",t)}else e.dataTransfer.setData("text/plain",this.id);e.dataTransfer.effectAllowed="move"}}onDragOver(e){try{e.preventDefault(),e.stopPropagation(),e.dataTransfer&&(e.dataTransfer.dropEffect="move")}catch(e){console.warn("Error in onDragOver:",e)}}setupKeyboardNavigation(e){e.tabIndex=0,e.addEventListener("keydown",(e=>function(e,t){if(!d.A.getState().app.app.hamburgerMenuOpen)if(t.stopPropagation(),e.isEditing)switch(t.key){case"Enter":t.shiftKey||(t.preventDefault(),e.finishTitleEdit(t.target));break;case"Escape":t.preventDefault(),e.cancelTitleEdit(t.target)}else{if(e.element.focus(),t.ctrlKey&&"ArrowUp"===t.key)return t.preventDefault(),void e.moveUp();if(t.ctrlKey&&"ArrowDown"===t.key)return t.preventDefault(),void e.moveDown();if(t.ctrlKey&&"ArrowRight"===t.key)return t.preventDefault(),void e.indentRight();if(t.ctrlKey&&"ArrowLeft"===t.key)return t.preventDefault(),void e.indentLeft();switch(t.key){case"ArrowUp":t.preventDefault(),w(e,"up");break;case"ArrowDown":t.preventDefault(),w(e,"down");break;case"ArrowLeft":t.preventDefault(),w(e,"left");break;case"ArrowRight":t.preventDefault(),w(e,"right");break;case"Enter":if(t.preventDefault(),t.ctrlKey)e.addNewChild();else if(t.shiftKey)(0,o.Ol)(e);else{const t=Date.now();b.trayId===e.id&&t-b.time<300?e.unfoldChildren():e.toggleFold(),b={trayId:e.id,time:t}}break;case"Delete":t.preventDefault(),t.ctrlKey&&(s.km.length>0?(0,s.jG)():(0,l.ql)(e));break;case"c":t.ctrlKey&&(t.preventDefault(),s.km.length>0?(0,s.$R)():(0,l.Ci)(e));break;case"x":t.ctrlKey&&(t.preventDefault(),s.km.length>0?(0,s.qb)():(0,l.rQ)(e));break;case"v":t.ctrlKey&&(t.preventDefault(),(0,l.Iz)(e));break;case"z":t.ctrlKey&&(t.preventDefault(),(0,v.undo)());break;case"m":if(t.ctrlKey){t.preventDefault(),(0,l.wC)(e);break}case"j":t.ctrlKey&&(t.preventDefault(),e.toggleCheckbox());break;case" ":t.ctrlKey&&(t.preventDefault(),f(e));break;case"ContextMenu":t.preventDefault(),f(e);break;case"F10":t.shiftKey&&(t.preventDefault(),f(e));break;case"t":t.ctrlKey&&(t.preventDefault(),(0,s.mT)())}}}(this,e)))}addNewChild(){const e=new S(this.id,Date.now().toString(),"New Tray");this.addChild(e),this.isFolded=!1,this.updateAppearance();const t=e.element.querySelector(".tray-title");e.startTitleEdit(t)}onDrop(e){var t;const n=performance.now();try{e.preventDefault(),e.stopPropagation(),this.clearAllDragStyles(),this.isFolded&&this.toggleFold(),this.updateAppearance();const r=null===(t=e.dataTransfer)||void 0===t?void 0:t.getData("text/plain");if(!r)return void console.warn("Drop operation failed: no drag data available");const s=r.split(",").filter((e=>e.trim().length>0));if(0===s.length)return void console.warn("Drop operation failed: no valid tray IDs");const a=s.map((e=>(0,o.yr)(e))).filter((e=>!!e));if(0===a.length)return void console.warn("Drop operation failed: no valid trays found for IDs",s);if(a.some((e=>{const t=this.isDescendantOf(e.id);return t&&console.warn(`Circular reference prevented: cannot move tray ${e.id} (${e.name}) into its descendant ${this.id} (${this.name})`),t})))return;const c=this.element.querySelector(".tray-content");if(!c)return void console.warn("Drop operation failed: target content element not found");const l=[];if(a.forEach((e=>{try{const t=(0,o.yr)(e.parentId);t&&t.removeChild(e.id),this.children.unshift(e),e.parentId=this.id,c.insertBefore(e.element,c.firstChild),e.element.style.display="block",e.clearAllDragStyles(),l.push(e)}catch(t){console.error(`Error moving tray ${e.id}:`,t)}})),this.isFolded=!1,this.updateAppearance(),l.length>0){(0,i.saveToIndexedDB)();const e=performance.now()-n;e>100&&console.log(`Drop operation took ${e.toFixed(2)}ms for ${l.length} trays`)}}catch(e){console.error("Critical error in onDrop:",e),this.clearAllDragStyles()}}onDragEnter(e){try{e.preventDefault(),e.stopPropagation(),this.clearAllDragStyles(),this.element.classList.add("drag-over")}catch(e){console.warn("Error in onDragEnter:",e)}}onDragLeave(e){e.preventDefault(),e.stopPropagation();try{const t=e.relatedTarget;t&&this.element.contains(t)||this.clearAllDragStyles()}catch(e){console.warn("Error in onDragLeave, clearing drag styles:",e),this.clearAllDragStyles()}}onDragEnd(e){e.stopPropagation(),this.clearAllDragStyles(),this.element.querySelectorAll(".tray").forEach((e=>{const t=c.P.get(e);t&&t.clearAllDragStyles()}))}onDoubleClick(e){e.stopPropagation();const t=new S(this.id,Date.now().toString(),"New Tray");this.addChild(t),this.isFolded=!1,this.updateAppearance();const n=t.element.querySelector(".tray-title");n&&t.startTitleEdit(n)}onMouseOver(e){}addChild(e){this.children.unshift(e),e.parentId=this.id;const t=this.element.querySelector(".tray-content");if(t&&t.insertBefore(e.element,t.firstChild),1===this.children.length){const e=this.borderColor==(0,r.f4)()?(0,r.NP)():this.borderColor;this.borderColor=e,this.updateBorderColor(this.borderColor),this.updateAppearance()}}moveFocusAfterDelete(e,t){let n;n=e.children.length>0?t<e.children.length?e.children[t].element:e.children[e.children.length-1].element:e.element,n&&n.focus()}add_child_from_localStorage(){const e=prompt("Input the sessionId","");if(!e)return;const t=localStorage.getItem(e);if(t){const e=(0,i.deserialize)(JSON.parse(t));e&&this.addChild(e)}}addProperty(e="priority",t){this.properties[e]=t,(0,i.saveToIndexedDB)()}moveInParent(e){const t=(0,o.yr)(this.parentId);if(!t)return;const n=t.children.indexOf(this),r=n+e;if(-1===n||r<0||r>=t.children.length)return;t.children.splice(n,1),t.children.splice(r,0,this);const s=t.element.querySelector(".tray-content");if(s){const e=t.children[r+1];s.insertBefore(this.element,e?e.element:null)}(0,i.saveToIndexedDB)()}moveUp(){this.moveInParent(-1),this.element.focus()}moveDown(){this.moveInParent(1),this.element.focus()}indentRight(){const e=(0,o.yr)(this.parentId);if(!e)return;const t=e.children.indexOf(this),n=e.children[t+1];n&&(e.removeChild(this.id),n.addChild(this),n.isFolded=!1,n.updateAppearance(),0===e.children.length&&e.updateAppearance(),this.element.focus(),(0,i.saveToIndexedDB)())}indentLeft(){const e=(0,o.yr)(this.parentId);if(!e)return;const t=(0,o.yr)(e.parentId);if(!t)return;const n=t.children.indexOf(e);e.removeChild(this.id),this.parentId=t.id,t.children.splice(n,0,this);const s=t.element.querySelector(".tray-content");if(s&&s.insertBefore(this.element,e.element),1===t.children.length){const e=t.borderColor==(0,r.f4)()?(0,r.NP)():t.borderColor;t.borderColor=e,t.updateBorderColor(t.borderColor)}t.updateAppearance(),this.element.focus(),(0,i.saveToIndexedDB)()}insertParentTray(){const e=(0,o.yr)(this.parentId);if(!e)return;const t=e.children.indexOf(this);if(-1===t)return;const n=new S(e.id,(0,r.lk)(),"New Tray");e.children.splice(t,1,n);const s=e.element.querySelector(".tray-content");s&&s.insertBefore(n.element,this.element),n.addChild(this),e.updateAppearance(),n.isFolded=!1,n.updateAppearance();const a=n.element.querySelector(".tray-title");n.startTitleEdit(a),n.element.focus(),(0,i.saveToIndexedDB)()}insertChildTray(){const e=[...this.children],t=this.element.querySelector(".tray-content");t&&e.forEach((e=>t.removeChild(e.element))),this.children=[];const n=new S(this.id,(0,r.lk)(),"New Tray");this.addChild(n);const o=n.element.querySelector(".tray-content");e.forEach((e=>{e.parentId=n.id,n.children.push(e),o&&o.appendChild(e.element)})),this.updateAppearance(),n.isFolded=!1,n.updateAppearance();const s=n.element.querySelector(".tray-title");n.startTitleEdit(s),n.element.focus(),(0,i.saveToIndexedDB)()}sortChildren(e="created_dt",t=!1){this.children.sort(((n,r)=>{let o,i;return"created_dt"===e?(o=new Date(n.created_dt).getTime(),i=new Date(r.created_dt).getTime()):(o=n.properties[e],i=r.properties[e]),void 0===o&&void 0===i?0:null==o?1:null==i?-1:o>i?t?-1:1:o<i?t?1:-1:0}));const n=this.element.querySelector(".tray-content");n&&this.children.forEach((e=>{n.appendChild(e.element)})),(0,i.saveToIndexedDB)()}}},598:(e,t,n)=>{n.d(t,{e:()=>i,g:()=>s});var r=n(627),o=n(185);function i(){const e=new r.f("0","0","Root Tray",null,null,"column",null,null,!1),t=(e.element.querySelector(".tray-content"),new r.f(e.id,(0,o.lk)(),"ToDo")),n=new r.f(e.id,(0,o.lk)(),"Doing"),i=new r.f(e.id,(0,o.lk)(),"Done");return e.addChild(i),e.addChild(n),e.addChild(t),e}function s(e){let t=JSON.parse(JSON.stringify(e));return t.id=(0,o.lk)(),t}},896:(e,t,n)=>{n.d(t,{Ol:()=>i,sN:()=>s,yr:()=>o});var r=n(859);function o(e){const t=document.querySelector(`[data-tray-id="${e}"]`);return r.P.get(t)}function i(e){console.log("editing");const t=e.element.querySelector(".tray-title");if(t){t.contentEditable="true",t.focus(),e.isEditing=!0;const n=window.getSelection();if(n){const e=document.createRange();e.selectNodeContents(t),n.removeAllRanges(),n.addRange(e)}}}function s(e){for(const t of e.children)t.isFolded=!1,t.updateAppearance()}},185:(e,t,n)=>{function r(){let e="#";for(let t=0;t<6;t++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e}function o(){return"#f5f5f5"}function i(e){const t=(new URLSearchParams(window.location.search).get(e)||"").trim();return t||"sessionId"!==e?t:"default"}function s(){return document.querySelector("body > div.tray")||null}function a(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}n.d(t,{NP:()=>r,Vf:()=>i,f4:()=>o,lk:()=>a,p0:()=>s})},816:(e,t,n)=>{function r(e){return`Minified Redux error #${e}; visit https://redux.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}n.d(t,{U1:()=>ue,Z0:()=>me});var o=(()=>"function"==typeof Symbol&&Symbol.observable||"@@observable")(),i=()=>Math.random().toString(36).substring(7).split("").join("."),s={INIT:`@@redux/INIT${i()}`,REPLACE:`@@redux/REPLACE${i()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${i()}`};function a(e){if("object"!=typeof e||null===e)return!1;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t||null===Object.getPrototypeOf(e)}function c(e,t,n){if("function"!=typeof e)throw new Error(r(2));if("function"==typeof t&&"function"==typeof n||"function"==typeof n&&"function"==typeof arguments[3])throw new Error(r(0));if("function"==typeof t&&void 0===n&&(n=t,t=void 0),void 0!==n){if("function"!=typeof n)throw new Error(r(1));return n(c)(e,t)}let i=e,l=t,d=new Map,u=d,p=0,h=!1;function y(){u===d&&(u=new Map,d.forEach(((e,t)=>{u.set(t,e)})))}function f(){if(h)throw new Error(r(3));return l}function g(e){if("function"!=typeof e)throw new Error(r(4));if(h)throw new Error(r(5));let t=!0;y();const n=p++;return u.set(n,e),function(){if(t){if(h)throw new Error(r(6));t=!1,y(),u.delete(n),d=null}}}function m(e){if(!a(e))throw new Error(r(7));if(void 0===e.type)throw new Error(r(8));if("string"!=typeof e.type)throw new Error(r(17));if(h)throw new Error(r(9));try{h=!0,l=i(l,e)}finally{h=!1}return(d=u).forEach((e=>{e()})),e}return m({type:s.INIT}),{dispatch:m,subscribe:g,getState:f,replaceReducer:function(e){if("function"!=typeof e)throw new Error(r(10));i=e,m({type:s.REPLACE})},[o]:function(){const e=g;return{subscribe(t){if("object"!=typeof t||null===t)throw new Error(r(11));function n(){const e=t;e.next&&e.next(f())}return n(),{unsubscribe:e(n)}},[o](){return this}}}}}function l(...e){return 0===e.length?e=>e:1===e.length?e[0]:e.reduce(((e,t)=>(...n)=>e(t(...n))))}function d(e){return({dispatch:t,getState:n})=>r=>o=>"function"==typeof o?o(t,n,e):r(o)}var u=d(),p=d,h=Symbol.for("immer-nothing"),y=Symbol.for("immer-draftable"),f=Symbol.for("immer-state");function g(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var m=Object.getPrototypeOf;function v(e){return!!e&&!!e[f]}function b(e){return!!e&&(x(e)||Array.isArray(e)||!!e[y]||!!e.constructor?.[y]||C(e)||D(e))}var w=Object.prototype.constructor.toString();function x(e){if(!e||"object"!=typeof e)return!1;const t=m(e);if(null===t)return!0;const n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return n===Object||"function"==typeof n&&Function.toString.call(n)===w}function k(e,t){0===E(e)?Reflect.ownKeys(e).forEach((n=>{t(n,e[n],e)})):e.forEach(((n,r)=>t(r,n,e)))}function E(e){const t=e[f];return t?t.type_:Array.isArray(e)?1:C(e)?2:D(e)?3:0}function S(e,t){return 2===E(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function T(e,t,n){const r=E(e);2===r?e.set(t,n):3===r?e.add(n):e[t]=n}function C(e){return e instanceof Map}function D(e){return e instanceof Set}function _(e){return e.copy_||e.base_}function A(e,t){if(C(e))return new Map(e);if(D(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const n=x(e);if(!0===t||"class_only"===t&&!n){const t=Object.getOwnPropertyDescriptors(e);delete t[f];let n=Reflect.ownKeys(t);for(let r=0;r<n.length;r++){const o=n[r],i=t[o];!1===i.writable&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(t[o]={configurable:!0,writable:!0,enumerable:i.enumerable,value:e[o]})}return Object.create(m(e),t)}{const t=m(e);if(null!==t&&n)return{...e};const r=Object.create(t);return Object.assign(r,e)}}function I(e,t=!1){return P(e)||v(e)||!b(e)||(E(e)>1&&(e.set=e.add=e.clear=e.delete=L),Object.freeze(e),t&&Object.entries(e).forEach((([e,t])=>I(t,!0)))),e}function L(){g(2)}function P(e){return Object.isFrozen(e)}var O,$={};function N(e){const t=$[e];return t||g(0),t}function M(){return O}function R(e,t){t&&(N("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function F(e){B(e),e.drafts_.forEach(U),e.drafts_=null}function B(e){e===O&&(O=e.parent_)}function j(e){return O={drafts_:[],parent_:O,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function U(e){const t=e[f];0===t.type_||1===t.type_?t.revoke_():t.revoked_=!0}function z(e,t){t.unfinalizedDrafts_=t.drafts_.length;const n=t.drafts_[0];return void 0!==e&&e!==n?(n[f].modified_&&(F(t),g(4)),b(e)&&(e=q(t,e),t.parent_||K(t,e)),t.patches_&&N("Patches").generateReplacementPatches_(n[f].base_,e,t.patches_,t.inversePatches_)):e=q(t,n,[]),F(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==h?e:void 0}function q(e,t,n){if(P(t))return t;const r=t[f];if(!r)return k(t,((o,i)=>H(e,r,t,o,i,n))),t;if(r.scope_!==e)return t;if(!r.modified_)return K(e,r.base_,!0),r.base_;if(!r.finalized_){r.finalized_=!0,r.scope_.unfinalizedDrafts_--;const t=r.copy_;let o=t,i=!1;3===r.type_&&(o=new Set(t),t.clear(),i=!0),k(o,((o,s)=>H(e,r,t,o,s,n,i))),K(e,t,!1),n&&e.patches_&&N("Patches").generatePatches_(r,n,e.patches_,e.inversePatches_)}return r.copy_}function H(e,t,n,r,o,i,s){if(v(o)){const s=q(e,o,i&&t&&3!==t.type_&&!S(t.assigned_,r)?i.concat(r):void 0);if(T(n,r,s),!v(s))return;e.canAutoFreeze_=!1}else s&&n.add(o);if(b(o)&&!P(o)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;q(e,o),t&&t.scope_.parent_||"symbol"==typeof r||!Object.prototype.propertyIsEnumerable.call(n,r)||K(e,o)}}function K(e,t,n=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&I(t,n)}var V={get(e,t){if(t===f)return e;const n=_(e);if(!S(n,t))return function(e,t,n){const r=X(t,n);return r?"value"in r?r.value:r.get?.call(e.draft_):void 0}(e,n,t);const r=n[t];return e.finalized_||!b(r)?r:r===G(e.base_,t)?(W(e),e.copy_[t]=Y(r,e)):r},has:(e,t)=>t in _(e),ownKeys:e=>Reflect.ownKeys(_(e)),set(e,t,n){const r=X(_(e),t);if(r?.set)return r.set.call(e.draft_,n),!0;if(!e.modified_){const r=G(_(e),t),s=r?.[f];if(s&&s.base_===n)return e.copy_[t]=n,e.assigned_[t]=!1,!0;if(((o=n)===(i=r)?0!==o||1/o==1/i:o!=o&&i!=i)&&(void 0!==n||S(e.base_,t)))return!0;W(e),Q(e)}var o,i;return e.copy_[t]===n&&(void 0!==n||t in e.copy_)||Number.isNaN(n)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=n,e.assigned_[t]=!0),!0},deleteProperty:(e,t)=>(void 0!==G(e.base_,t)||t in e.base_?(e.assigned_[t]=!1,W(e),Q(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0),getOwnPropertyDescriptor(e,t){const n=_(e),r=Reflect.getOwnPropertyDescriptor(n,t);return r?{writable:!0,configurable:1!==e.type_||"length"!==t,enumerable:r.enumerable,value:n[t]}:r},defineProperty(){g(11)},getPrototypeOf:e=>m(e.base_),setPrototypeOf(){g(12)}},J={};function G(e,t){const n=e[f];return(n?_(n):e)[t]}function X(e,t){if(!(t in e))return;let n=m(e);for(;n;){const e=Object.getOwnPropertyDescriptor(n,t);if(e)return e;n=m(n)}}function Q(e){e.modified_||(e.modified_=!0,e.parent_&&Q(e.parent_))}function W(e){e.copy_||(e.copy_=A(e.base_,e.scope_.immer_.useStrictShallowCopy_))}function Y(e,t){const n=C(e)?N("MapSet").proxyMap_(e,t):D(e)?N("MapSet").proxySet_(e,t):function(e,t){const n=Array.isArray(e),r={type_:n?1:0,scope_:t?t.scope_:M(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let o=r,i=V;n&&(o=[r],i=J);const{revoke:s,proxy:a}=Proxy.revocable(o,i);return r.draft_=a,r.revoke_=s,a}(e,t);return(t?t.scope_:M()).drafts_.push(n),n}function Z(e){if(!b(e)||P(e))return e;const t=e[f];let n;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,n=A(e,t.scope_.immer_.useStrictShallowCopy_)}else n=A(e,!0);return k(n,((e,t)=>{T(n,e,Z(t))})),t&&(t.finalized_=!1),n}k(V,((e,t)=>{J[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),J.deleteProperty=function(e,t){return J.set.call(this,e,t,void 0)},J.set=function(e,t,n){return V.set.call(this,e[0],t,n,e[0])};var ee=new class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,n)=>{if("function"==typeof e&&"function"!=typeof t){const n=t;t=e;const r=this;return function(e=n,...o){return r.produce(e,(e=>t.call(this,e,...o)))}}let r;if("function"!=typeof t&&g(6),void 0!==n&&"function"!=typeof n&&g(7),b(e)){const o=j(this),i=Y(e,void 0);let s=!0;try{r=t(i),s=!1}finally{s?F(o):B(o)}return R(o,n),z(r,o)}if(!e||"object"!=typeof e){if(r=t(e),void 0===r&&(r=e),r===h&&(r=void 0),this.autoFreeze_&&I(r,!0),n){const t=[],o=[];N("Patches").generateReplacementPatches_(e,r,t,o),n(t,o)}return r}g(1)},this.produceWithPatches=(e,t)=>{if("function"==typeof e)return(t,...n)=>this.produceWithPatches(t,(t=>e(t,...n)));let n,r;return[this.produce(e,t,((e,t)=>{n=e,r=t})),n,r]},"boolean"==typeof e?.autoFreeze&&this.setAutoFreeze(e.autoFreeze),"boolean"==typeof e?.useStrictShallowCopy&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){var t;b(e)||g(8),v(e)&&(v(t=e)||g(10),e=Z(t));const n=j(this),r=Y(e,void 0);return r[f].isManual_=!0,B(n),r}finishDraft(e,t){const n=e&&e[f];n&&n.isManual_||g(9);const{scope_:r}=n;return R(r,t),z(void 0,r)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let n;for(n=t.length-1;n>=0;n--){const r=t[n];if(0===r.path.length&&"replace"===r.op){e=r.value;break}}n>-1&&(t=t.slice(n+1));const r=N("Patches").applyPatches_;return v(e)?r(e,t):this.produce(e,(e=>r(e,t)))}},te=ee.produce;ee.produceWithPatches.bind(ee),ee.setAutoFreeze.bind(ee),ee.setUseStrictShallowCopy.bind(ee),ee.applyPatches.bind(ee),ee.createDraft.bind(ee),ee.finishDraft.bind(ee);var ne="undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(0!==arguments.length)return"object"==typeof arguments[0]?l:l.apply(null,arguments)};function re(e,t){function n(...n){if(t){let r=t(...n);if(!r)throw new Error(we(0));return{type:e,payload:r.payload,..."meta"in r&&{meta:r.meta},..."error"in r&&{error:r.error}}}return{type:e,payload:n[0]}}return n.toString=()=>`${e}`,n.type=e,n.match=t=>function(e){return a(e)&&"type"in e&&"string"==typeof e.type}(t)&&t.type===e,n}"undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__;var oe=class e extends Array{constructor(...t){super(...t),Object.setPrototypeOf(this,e.prototype)}static get[Symbol.species](){return e}concat(...e){return super.concat.apply(this,e)}prepend(...t){return 1===t.length&&Array.isArray(t[0])?new e(...t[0].concat(this)):new e(...t.concat(this))}};function ie(e){return b(e)?te(e,(()=>{})):e}function se(e,t,n){if(e.has(t)){let r=e.get(t);return n.update&&(r=n.update(r,t,e),e.set(t,r)),r}if(!n.insert)throw new Error(we(10));const r=n.insert(t,e);return e.set(t,r),r}var ae=()=>function(e){const{thunk:t=!0,immutableCheck:n=!0,serializableCheck:r=!0,actionCreatorCheck:o=!0}=e??{};let i=new oe;return t&&("boolean"==typeof t?i.push(u):i.push(p(t.extraArgument))),i},ce=e=>t=>{setTimeout(t,e)},le="undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame:ce(10),de=e=>function(t){const{autoBatch:n=!0}=t??{};let r=new oe(e);return n&&r.push(((e={type:"raf"})=>t=>(...n)=>{const r=t(...n);let o=!0,i=!1,s=!1;const a=new Set,c="tick"===e.type?queueMicrotask:"raf"===e.type?le:"callback"===e.type?e.queueNotification:ce(e.timeout),l=()=>{s=!1,i&&(i=!1,a.forEach((e=>e())))};return Object.assign({},r,{subscribe(e){const t=r.subscribe((()=>o&&e()));return a.add(e),()=>{t(),a.delete(e)}},dispatch(e){try{return o=!e?.meta?.RTK_autoBatch,i=!o,i&&(s||(s=!0,c(l))),r.dispatch(e)}finally{o=!0}}})})("object"==typeof n?n:void 0)),r};function ue(e){const t=ae(),{reducer:n,middleware:o,devTools:i=!0,preloadedState:d,enhancers:u}=e||{};let p,h;if("function"==typeof n)p=n;else{if(!a(n))throw new Error(we(1));p=function(e){const t=Object.keys(e),n={};for(let r=0;r<t.length;r++){const o=t[r];"function"==typeof e[o]&&(n[o]=e[o])}const o=Object.keys(n);let i;try{!function(e){Object.keys(e).forEach((t=>{const n=e[t];if(void 0===n(void 0,{type:s.INIT}))throw new Error(r(12));if(void 0===n(void 0,{type:s.PROBE_UNKNOWN_ACTION()}))throw new Error(r(13))}))}(n)}catch(e){i=e}return function(e={},t){if(i)throw i;let s=!1;const a={};for(let i=0;i<o.length;i++){const c=o[i],l=n[c],d=e[c],u=l(d,t);if(void 0===u)throw t&&t.type,new Error(r(14));a[c]=u,s=s||u!==d}return s=s||o.length!==Object.keys(e).length,s?a:e}}(n)}h="function"==typeof o?o(t):t();let y=l;i&&(y=ne({trace:!1,..."object"==typeof i&&i}));const f=function(...e){return t=>(n,o)=>{const i=t(n,o);let s=()=>{throw new Error(r(15))};const a={getState:i.getState,dispatch:(e,...t)=>s(e,...t)},c=e.map((e=>e(a)));return s=l(...c)(i.dispatch),{...i,dispatch:s}}}(...h),g=de(f);return c(p,d,y(..."function"==typeof u?u(g):g()))}function pe(e){const t={},n=[];let r;const o={addCase(e,n){const r="string"==typeof e?e:e.type;if(!r)throw new Error(we(28));if(r in t)throw new Error(we(29));return t[r]=n,o},addMatcher:(e,t)=>(n.push({matcher:e,reducer:t}),o),addDefaultCase:e=>(r=e,o)};return e(o),[t,n,r]}var he=Symbol.for("rtk-slice-createasyncthunk");function ye(e,t){return`${e}/${t}`}function fe({creators:e}={}){const t=e?.asyncThunk?.[he];return function(e){const{name:n,reducerPath:r=n}=e;if(!n)throw new Error(we(11));const o=("function"==typeof e.reducers?e.reducers(function(){function e(e,t){return{_reducerDefinitionType:"asyncThunk",payloadCreator:e,...t}}return e.withTypes=()=>e,{reducer:e=>Object.assign({[e.name]:(...t)=>e(...t)}[e.name],{_reducerDefinitionType:"reducer"}),preparedReducer:(e,t)=>({_reducerDefinitionType:"reducerWithPrepare",prepare:e,reducer:t}),asyncThunk:e}}()):e.reducers)||{},i=Object.keys(o),s={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},a={addCase(e,t){const n="string"==typeof e?e:e.type;if(!n)throw new Error(we(12));if(n in s.sliceCaseReducersByType)throw new Error(we(13));return s.sliceCaseReducersByType[n]=t,a},addMatcher:(e,t)=>(s.sliceMatchers.push({matcher:e,reducer:t}),a),exposeAction:(e,t)=>(s.actionCreators[e]=t,a),exposeCaseReducer:(e,t)=>(s.sliceCaseReducersByName[e]=t,a)};function c(){const[t={},n=[],r]="function"==typeof e.extraReducers?pe(e.extraReducers):[e.extraReducers],o={...t,...s.sliceCaseReducersByType};return function(e){let t,[i,a,c]=pe((e=>{for(let t in o)e.addCase(t,o[t]);for(let t of s.sliceMatchers)e.addMatcher(t.matcher,t.reducer);for(let t of n)e.addMatcher(t.matcher,t.reducer);r&&e.addDefaultCase(r)}));if("function"==typeof e)t=()=>ie(e());else{const n=ie(e);t=()=>n}function l(e=t(),n){let r=[i[n.type],...a.filter((({matcher:e})=>e(n))).map((({reducer:e})=>e))];return 0===r.filter((e=>!!e)).length&&(r=[c]),r.reduce(((e,t)=>{if(t){if(v(e)){const r=t(e,n);return void 0===r?e:r}if(b(e))return te(e,(e=>t(e,n)));{const r=t(e,n);if(void 0===r){if(null===e)return e;throw new Error(we(9))}return r}}return e}),e)}return l.getInitialState=t,l}(e.initialState)}i.forEach((r=>{const i=o[r],s={reducerName:r,type:ye(n,r),createNotation:"function"==typeof e.reducers};!function(e){return"asyncThunk"===e._reducerDefinitionType}(i)?function({type:e,reducerName:t,createNotation:n},r,o){let i,s;if("reducer"in r){if(n&&!function(e){return"reducerWithPrepare"===e._reducerDefinitionType}(r))throw new Error(we(17));i=r.reducer,s=r.prepare}else i=r;o.addCase(e,i).exposeCaseReducer(t,i).exposeAction(t,s?re(e,s):re(e))}(s,i,a):function({type:e,reducerName:t},n,r,o){if(!o)throw new Error(we(18));const{payloadCreator:i,fulfilled:s,pending:a,rejected:c,settled:l,options:d}=n,u=o(e,i,d);r.exposeAction(t,u),s&&r.addCase(u.fulfilled,s),a&&r.addCase(u.pending,a),c&&r.addCase(u.rejected,c),l&&r.addMatcher(u.settled,l),r.exposeCaseReducer(t,{fulfilled:s||ve,pending:a||ve,rejected:c||ve,settled:l||ve})}(s,i,a,t)}));const l=e=>e,d=new Map;let u;function p(e,t){return u||(u=c()),u(e,t)}function h(){return u||(u=c()),u.getInitialState()}function y(t,n=!1){function r(e){let r=e[t];return void 0===r&&n&&(r=h()),r}function o(t=l){const r=se(d,n,{insert:()=>new WeakMap});return se(r,t,{insert:()=>{const r={};for(const[o,i]of Object.entries(e.selectors??{}))r[o]=ge(i,t,h,n);return r}})}return{reducerPath:t,getSelectors:o,get selectors(){return o(r)},selectSlice:r}}const f={name:n,reducer:p,actions:s.actionCreators,caseReducers:s.sliceCaseReducersByName,getInitialState:h,...y(r),injectInto(e,{reducerPath:t,...n}={}){const o=t??r;return e.inject({reducerPath:o,reducer:p},n),{...f,...y(o,!0)}}};return f}}function ge(e,t,n,r){function o(o,...i){let s=t(o);return void 0===s&&r&&(s=n()),e(s,...i)}return o.unwrapped=e,o}var me=fe();function ve(){}var{assign:be}=Object;function we(e){return`Minified Redux Toolkit error #${e}; visit https://redux-toolkit.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}Symbol.for("rtk-state-proxy-original")}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(859)})();