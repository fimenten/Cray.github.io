(()=>{"use strict";var e={859:(e,t,n)=>{n.d(t,{P:()=>a});var r=n(185),o=n(574),i=n(973);const a=new WeakMap;new Map,window.addEventListener("storage",(e=>{if("hidden"===document.visibilityState){const t=(0,r.Vf)("sessionId")||"trayData";e.key===`update_${t}`&&(0,o.loadFromIndexedDB)(t)}})),window.addEventListener("DOMContentLoaded",(()=>{return e=void 0,t=void 0,s=function*(){let e=(0,r.Vf)("sessionId");if("new"==e){let e=(0,r.lk)();window.location.replace(window.location.href.replace("?sessionId=new","?sessionId="+e))}if(e?yield(0,o.loadFromIndexedDB)(e):yield(0,o.loadFromIndexedDB)(),console.log("loaded"),e){const t=localStorage.getItem(e+"_title");t&&(document.title=t)}const t=(0,r.p0)();if(t){const e=a.get(t);e&&(yield(0,i.U2)(e),e.autoUpload&&(0,i.N)(e))}},new((n=void 0)||(n=Promise))((function(r,o){function i(e){try{c(s.next(e))}catch(e){o(e)}}function a(e){try{c(s.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((s=s.apply(e,t||[])).next())}));var e,t,n,s}))},669:(e,t,n)=>{n.d(t,{wC:()=>l,Ci:()=>u,rQ:()=>p,ql:()=>h,ii:()=>d,Lg:()=>s,Iz:()=>f});var r=n(574),o=n(627),i=n(185),a=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};function s(e){const t=(0,i.yr)(e.parentId);t&&(e.children.forEach((e=>{t.addChild(e)})),e.children.length=0,t.removeChild(e.id),e.element.remove(),t.element.focus(),(0,r.saveToIndexedDB)())}function c(e,t=0){let n=`${"  ".repeat(t)}- ${e.name}\n`;for(const r of e.children)n+=c(r,t+1);return n}function l(e){const t=c(e);navigator.clipboard&&navigator.clipboard.writeText(t).catch((()=>{}))}function d(e){const t=c(e),n=new Blob([t],{type:"text/markdown"}),r=document.createElement("a");r.href=URL.createObjectURL(n),r.download="tray_structure.md",document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(r.href)}function u(e){const t=(0,r.serialize)((0,i.g_)(e));navigator.clipboard.writeText(t)}function p(e){const t=(0,r.serialize)((0,i.g_)(e));navigator.clipboard.writeText(t)}function f(e){return a(this,void 0,void 0,(function*(){if(navigator.clipboard.read)try{const t=yield navigator.clipboard.read();for(const n of t)for(const t of n.types)if(t.startsWith("image/")){const r=yield n.getType(t),a=URL.createObjectURL(r),s=new o.f(e.id,(0,i.lk)(),a);return void e.addChild(s)}}catch(e){}const t=yield navigator.clipboard.readText();try{let n=(0,r.deserialize)(t);if(!n)return;e.addChild(n)}catch(n){!function(e,t){const n=e.split(/\r?\n/).filter((e=>""!==e.trim())),r=[];for(const e of n){const n=e.match(/^(\s*)/),a=n?Math.floor(n[1].length/2):0,s=e.trim().replace(/^[-*]\s*/,""),c=0===a?t:r[a-1]||t,l=new o.f(c.id,(0,i.lk)(),s);c.addChild(l),r[a]=l,r.length=a+1}}(t,e)}}))}function h(e){const t=(0,i.yr)(e.parentId),n=t.children.findIndex((t=>t.id===e.id));t.removeChild(e.id),e.element.remove(),e.moveFocusAfterDelete(t,n),(0,r.saveToIndexedDB)()}},271:(e,t,n)=>{n.d(t,{$R:()=>L,T0:()=>v,jG:()=>D,km:()=>u,qb:()=>T});var r=n(185),o=n(574),i=n(859),a=n(627),s=n(973),c=n(669),l=n(569),d=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};let u=[];function p(e){try{const t=new URL(e);let n=t.origin;return t.pathname&&"/"!==t.pathname&&(n+=t.pathname.replace(/\/$/,"")),n}catch(t){return e.trim().replace(/\/$/,"")}}const f=[{action:"search",label:"🔍 Search Trays"},{action:"viewByHooks",label:"🏷️ View Tasks by Hook"},{action:"reset",label:"トレイをリセット"},{action:"save",label:"現在の状態を保存"},{action:"load",label:"保存した状態を読み込む"},{action:"export",label:"データのエクスポート"},{action:"import",label:"データのインポート"},{action:"set_default_server",label:"set_default_server"},{action:"manage_server_passwords",label:"Manage Server Passwords"},{action:"import_network_tray_directly_as_root",label:"import_network_tray_directly_as_root"},{action:"editTitle",label:"ページタイトルを編集"},{action:"uploadAll",label:"Upload All"},{action:"downloadAll",label:"Download All"},{action:"editSessionId",label:"セッションIDを編集"},{action:"newSession",label:"New Session"},{action:"temporalTray",label:"Temporal Tray"}],h=[{action:"copySelected",label:"Copy selected"},{action:"cutSelected",label:"Cut selected"}];function y(e,t){t.forEach((({action:t,label:n})=>{const r=document.createElement("div");r.classList.add("menu-item"),r.dataset.action=t,r.textContent=n,e.appendChild(r)}))}function m(){u=[],document.querySelectorAll(".tray-checkbox").forEach((e=>{e.checked=!1}))}function v(){const e=document.createElement("div");e.classList.add("left-bar"),document.body.appendChild(e);const t=document.createElement("div");t.classList.add("hamburger-menu"),t.innerHTML="☰",e.appendChild(t);const n=document.createElement("div");n.classList.add("session-list-button"),n.innerHTML="📑",e.appendChild(n),n.addEventListener("click",E);const i=document.createElement("div");i.classList.add("selection-menu-button"),i.innerHTML="✔",e.appendChild(i);const a=document.createElement("div");a.classList.add("selection-menu-items"),a.style.display="none",e.appendChild(a),a.style.position="fixed",y(a,h);const s=document.createElement("div");s.classList.add("hamburger-menu-items"),s.style.display="none",e.appendChild(s),s.style.position="fixed",y(s,f),document.body.appendChild(s);const c=s.querySelectorAll(".menu-item");c.forEach((e=>{e.style.padding="5px 10px",e.style.cursor="pointer",e.style.transition="background-color 0.3s"})),t.addEventListener("click",(t=>{if(s.style.display="none"===s.style.display?"block":"none","block"===s.style.display){const t=e.getBoundingClientRect();s.style.left=`${t.right}px`,s.style.top=`${t.top}px`}t.stopPropagation()})),i.addEventListener("click",(t=>{if(a.style.display="none"===a.style.display?"block":"none","block"===a.style.display){const t=e.getBoundingClientRect();a.style.left=`${t.right}px`,a.style.top=`${t.top}px`}t.stopPropagation()})),document.addEventListener("click",(e=>{const n=e.target;s.contains(n)||n===t||a.contains(n)||n===i||(s.style.display="none",a.style.display="none")}));const l={search:O,viewByHooks:N,reset:()=>{confirm("すべてのトレイをリセットしますか？この操作は元に戻せません。")&&function(){localStorage.removeItem("trayData");const e=(0,r.eb)();document.body.innerHTML="",document.body.appendChild(e.element),v()}()},export:o.exportData,import:o.importData,set_default_server:S,manage_server_passwords:A,editTitle:g,uploadAll:()=>w(),downloadAll:()=>x(),editSessionId:b,newSession:C,temporalTray:_,cutSelected:T,copySelected:L};return s.addEventListener("click",(e=>{const t=e.target.getAttribute("data-action")||"",n=l[t];n&&n(),s.style.display="none"})),a.addEventListener("click",(e=>{const t=e.target.getAttribute("data-action")||"",n=l[t];n&&n(),a.style.display="none"})),c.forEach((e=>{e.addEventListener("mouseover",(()=>{e.style.backgroundColor="#f0f0f0"})),e.addEventListener("mouseout",(()=>{e.style.backgroundColor="transparent"}))})),{hamburger:t,menu:s,selectionMenu:a,leftBar:e}}function g(){const e=document.title,t=prompt("新しいページタイトルを入力してください:",e);if(null!==t&&""!==t.trim()){document.title=t.trim();const e=(0,r.Vf)("sessionId");e&&(localStorage.setItem(e+"_title",t.trim()),alert("ページタイトルを更新しました。"))}}function b(){const e=(0,r.Vf)("sessionId"),t=prompt("新しいセッションIDを入力してください:",e||"");t&&""!==t.trim()&&(window.location.href=`${window.location.pathname}?sessionId=${t.trim()}`)}function w(e=null){e||(e=i.P.get((0,r.p0)())),e.host_url&&(0,s.CW)(e),e.children.length&&e.children.map((e=>w(e)))}function x(e=null){e||(e=i.P.get((0,r.p0)())),e.host_url&&(0,s.XF)(e),e.children.length&&e.children.map((e=>x(e)))}function E(){return d(this,void 0,void 0,(function*(){const e=(yield(0,o.getAllSessionIds)()).filter((e=>"trayData"!==e)),t=document.createElement("div");t.classList.add("session-selection-dialog"),t.innerHTML=`\n      <h3>Sessions</h3>\n      <select id="session-select">\n        ${e.map((e=>`<option value="${e}">${e}</option>`)).join("")}\n      </select>\n      <button id="session-open">Open</button>\n      <button id="session-cancel">Cancel</button>\n    `,document.body.appendChild(t);const n=t.querySelector("#session-open"),r=t.querySelector("#session-cancel"),i=t.querySelector("#session-select");n.addEventListener("click",(()=>{const e=i.value;e&&(window.location.href=`${window.location.pathname}?sessionId=${e}`)})),r.addEventListener("click",(()=>t.remove()))}))}function C(){const e=(0,r.lk)();window.open(`${window.location.pathname}?sessionId=${e}`,"_blank")}const k="temp-global";function _(){window.open(`${window.location.pathname}?sessionId=${k}`,"_blank")}function S(){let e=localStorage.getItem("defaultServer");e=prompt("set default URL",e||""),e&&localStorage.setItem("defaultServer",p(e))}function T(){if(0!==u.length){const e=new a.f((0,r.lk)(),(0,r.lk)(),"selected Trays");u.forEach((t=>e.children.push((0,r.g_)(t)))),(0,c.Ci)(e),u.forEach((e=>(0,c.ql)(e))),m()}}function L(){if(0!==u.length){const e=new a.f((0,r.lk)(),(0,r.lk)(),"selected Trays");u.forEach((t=>e.children.push((0,r.g_)(t)))),(0,c.Ci)(e),m()}}function D(){0!==u.length&&(u.forEach((e=>(0,c.ql)(e))),m())}function A(){const e=JSON.parse(localStorage.getItem("serverPasswords")||"{}"),t=document.createElement("div");function n(){const n=t.querySelector("#server-list");n.innerHTML="",Object.entries(e).forEach((([e])=>{const t=document.createElement("div");t.style.cssText="display: flex; align-items: center; margin-bottom: 10px; padding: 10px; border: 1px solid #eee; border-radius: 4px;",t.innerHTML=`\n        <span style="flex: 1; font-weight: bold;">${e}</span>\n        <span style="flex: 1; font-family: monospace;">••••••••</span>\n        <button class="edit-btn" data-server="${e}" style="margin-left: 10px;">Edit</button>\n        <button class="delete-btn" data-server="${e}" style="margin-left: 5px;">Delete</button>\n      `,n.appendChild(t)}))}t.classList.add("server-password-dialog"),t.style.cssText="\n    position: fixed;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    background: white;\n    border: 1px solid #ccc;\n    border-radius: 8px;\n    padding: 20px;\n    z-index: 10000;\n    min-width: 400px;\n    max-height: 70vh;\n    overflow-y: auto;\n  ",t.innerHTML='\n    <h3>Manage Server Passwords</h3>\n    <div id="server-list"></div>\n    <div style="margin-top: 15px;">\n      <input type="text" id="new-server" placeholder="Server URL" style="width: 200px; margin-right: 10px;">\n      <input type="password" id="new-password" placeholder="Password" style="width: 150px; margin-right: 10px;">\n      <button id="add-server">Add</button>\n    </div>\n    <div style="margin-top: 15px;">\n      <button id="close-dialog">Close</button>\n    </div>\n  ',document.body.appendChild(t),n(),t.addEventListener("click",(r=>{const o=r.target;if(o.classList.contains("delete-btn")){const t=o.getAttribute("data-server");confirm(`Delete password for ${t}?`)&&(delete e[t],localStorage.setItem("serverPasswords",JSON.stringify(e)),n())}if(o.classList.contains("edit-btn")){const t=o.getAttribute("data-server"),r=prompt(`Enter new password for ${t}:`,"");null!==r&&(e[t]=r,localStorage.setItem("serverPasswords",JSON.stringify(e)),n())}if("add-server"===o.id){const r=t.querySelector("#new-server"),o=t.querySelector("#new-password"),i=r.value.trim(),a=o.value;if(i&&a){const t=p(i);e[t]=a,localStorage.setItem("serverPasswords",JSON.stringify(e)),r.value="",o.value="",n()}else alert("Please enter both server URL and password")}"close-dialog"===o.id&&t.remove()}))}function P(e){const t=[],n=new Set;return function e(r){if(r&&!n.has(r.id)&&(n.add(r.id),t.push(r),r.children&&Array.isArray(r.children)))for(const t of r.children)e(t)}(e),t}function I(e){console.log("expandAllParentsAndFocus called for:",e.name,e.id);try{if(!i.P.get((0,r.p0)()))return void console.log("No root tray found");const t=[],n=new Set;let a=e;for(;a&&a.parentId&&!n.has(a.id);){n.add(a.id);const e=(0,r.yr)(a.parentId);if(!e||n.has(e.id))break;t.push(e),a=e}console.log("Path to root:",t.map((e=>e.name))),t.reverse().forEach((e=>{e.isFolded&&(console.log("Expanding parent:",e.name),e.isFolded=!1,e.updateAppearance())})),(0,o.saveToIndexedDB)(),console.log("Focusing and scrolling to:",e.name),(0,l.Go)(e),setTimeout((()=>{e.element.focus(),e.element.scrollIntoView({behavior:"smooth",block:"center"})}),100)}catch(e){console.error("Error in expandAllParentsAndFocus:",e)}}function O(){const e=i.P.get((0,r.p0)());if(!e)return;const t=document.createElement("div");t.classList.add("search-dialog"),t.style.cssText="\n    position: fixed;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    background: white;\n    border: 1px solid #ccc;\n    border-radius: 8px;\n    padding: 20px;\n    z-index: 10000;\n    min-width: 400px;\n    max-height: 70vh;\n    overflow-y: auto;\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);\n  ",t.innerHTML='\n    <h3>Search Trays</h3>\n    <div style="margin-bottom: 15px;">\n      <input type="text" id="search-input" placeholder="Enter search term..." \n             style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 16px;">\n    </div>\n    <div id="search-results" style="max-height: 300px; overflow-y: auto; border: 1px solid #eee; border-radius: 4px; padding: 10px;">\n      <div style="text-align: center; color: #999; padding: 20px;">Enter a search term to find trays</div>\n    </div>\n    <div style="margin-top: 15px; text-align: right;">\n      <button id="close-search" style="padding: 8px 16px; background: #f0f0f0; border: 1px solid #ccc; border-radius: 4px; cursor: pointer;">Close</button>\n    </div>\n  ',document.body.appendChild(t);const n=t.querySelector("#search-input"),o=t.querySelector("#search-results"),a=t.querySelector("#close-search");n.addEventListener("input",(n=>{!function(n){if(!n.trim())return void(o.innerHTML='<div style="text-align: center; color: #999; padding: 20px;">Enter a search term to find trays</div>');const r=P(e).filter((e=>{if(!e||!e.name)return!1;try{const t=e.name.toLowerCase().includes(n.toLowerCase()),r=e.properties&&"object"==typeof e.properties&&Object.values(e.properties).some((e=>null!=e&&String(e).toLowerCase().includes(n.toLowerCase())));return t||r}catch(t){return console.error("Error filtering tray:",t,e),!1}}));0!==r.length?(o.innerHTML="",r.forEach((e=>{const n=document.createElement("div");n.style.cssText="\n        padding: 10px;\n        border-bottom: 1px solid #eee;\n        cursor: pointer;\n        transition: background-color 0.2s;\n      ";const r=e.name||"Untitled",i=e.id||"unknown",a=e.created_dt?e.created_dt.toLocaleDateString():"unknown date";n.innerHTML=`\n        <div style="font-weight: bold; margin-bottom: 4px;">${r}</div>\n        <div style="font-size: 0.8em; color: #666;">ID: ${i}</div>\n        <div style="font-size: 0.8em; color: #666;">Created: ${a}</div>\n      `,n.addEventListener("mouseenter",(()=>{n.style.backgroundColor="#f0f0f0"})),n.addEventListener("mouseleave",(()=>{n.style.backgroundColor="transparent"})),n.addEventListener("click",(n=>{n.preventDefault(),n.stopPropagation(),console.log("Search result clicked:",e.name,e.id),I(e),t.remove()})),o.appendChild(n)}))):o.innerHTML='<div style="text-align: center; color: #999; padding: 20px;">No trays found matching your search</div>'}(n.target.value)})),n.addEventListener("keydown",(e=>{"Escape"===e.key&&t.remove()})),a.addEventListener("click",(()=>{t.remove()})),n.focus(),t.addEventListener("click",(e=>{e.target===t&&t.remove()})),o.addEventListener("click",(e=>{e.stopPropagation()}))}function N(){const e=i.P.get((0,r.p0)());if(!e)return;const t=document.createElement("div");t.classList.add("hook-view-dialog"),t.style.cssText="\n    position: fixed;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    background: white;\n    border: 1px solid #ccc;\n    border-radius: 8px;\n    padding: 20px;\n    z-index: 10000;\n    min-width: 600px;\n    max-height: 80vh;\n    overflow-y: auto;\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);\n  ",t.innerHTML='\n    <h3>Tasks Organized by Hooks</h3>\n    <div id="hook-content" style="max-height: 60vh; overflow-y: auto;">\n      <div style="text-align: center; color: #999; padding: 20px;">Loading hooks...</div>\n    </div>\n    <div style="margin-top: 15px; text-align: right;">\n      <button id="close-hook-view" style="padding: 8px 16px; background: #f0f0f0; border: 1px solid #ccc; border-radius: 4px; cursor: pointer;">Close</button>\n    </div>\n  ',document.body.appendChild(t);const n=t.querySelector("#hook-content"),o=t.querySelector("#close-hook-view"),a=P(e),s=new Map;a.forEach((e=>{e.hooks&&e.hooks.length>0&&e.hooks.forEach((t=>{s.has(t)||s.set(t,[]),s.get(t).push(e)}))})),0===s.size?n.innerHTML='<div style="text-align: center; color: #999; padding: 20px;">No tasks with hooks found. Use @hookname in tray names to organize by hooks.</div>':(n.innerHTML="",Array.from(s.keys()).sort().forEach((e=>{const r=document.createElement("div");r.style.cssText="margin-bottom: 20px; border: 1px solid #ddd; border-radius: 6px; padding: 15px;";const o=document.createElement("h4");o.textContent=`@${e}`,o.style.cssText="margin: 0 0 10px 0; color: #333; font-size: 1.1em; font-weight: bold;",r.appendChild(o),s.get(e).forEach((e=>{const n=document.createElement("div");n.style.cssText=`\n          padding: 8px 12px;\n          margin-bottom: 6px;\n          background: #f8f9fa;\n          border-radius: 4px;\n          cursor: pointer;\n          transition: background-color 0.2s;\n          border-left: 3px solid ${e.borderColor};\n        `;const o=e.name||"Untitled",i=e.created_dt?e.created_dt.toLocaleDateString():"unknown date";n.innerHTML=`\n          <div style="font-weight: 500; margin-bottom: 2px;">${o}</div>\n          <div style="font-size: 0.8em; color: #666;">Created: ${i}</div>\n        `,n.addEventListener("mouseenter",(()=>{n.style.backgroundColor="#e9ecef"})),n.addEventListener("mouseleave",(()=>{n.style.backgroundColor="#f8f9fa"})),n.addEventListener("click",(n=>{n.preventDefault(),n.stopPropagation(),I(e),t.remove()})),r.appendChild(n)})),n.appendChild(r)}))),o.addEventListener("click",(()=>{t.remove()})),t.addEventListener("click",(e=>{e.target===t&&t.remove()})),n.addEventListener("click",(e=>{e.stopPropagation()}))}},944:(e,t,n)=>{n.r(t),n.d(t,{_getHistoryLength:()=>c,recordState:()=>a,undo:()=>s});var r=n(859),o=n(185);const i=[];function a(e){if(!e){const t=n(574),i=(0,o.p0)();if(!i)return;const a=r.P.get(i);if(!a)return;e=t.serialize(a)}i.push(e),i.length>50&&i.shift()}function s(){if(i.length<2)return;i.pop();const e=i[i.length-1],t=n(574),r=t.deserialize(e);t.renderRootTray(r)}function c(){return i.length}},574:(e,t,n)=>{n.r(t),n.d(t,{deserialize:()=>E,deserializeJSONL:()=>C,exportData:()=>p,getAllSessionIds:()=>v,importData:()=>f,loadFromIndexedDB:()=>y,loadFromLocalStorage:()=>k,renderRootTray:()=>g,saveToIndexedDB:()=>h,serialize:()=>b,serializeAsync:()=>w});const r="trayData";var o=n(859),i=n(185),a=n(271),s=n(627),c=n(33);function l(){const e=c.A.getState().app.lastFocused;if(!e)return;const t=(0,i.yr)(e);if(!t)return;const n=(0,i.yr)(t.parentId);if(n){const e=new s.f(n.id,Date.now().toString(),"New Tray");n.addChild(e),n.isFolded=!1,n.updateAppearance(),e.element.focus();const t=e.element.querySelector(".tray-title");e.startTitleEdit(t)}}function d(){const e=c.A.getState().app.lastFocused;if(!e)return;const t=(0,i.yr)(e);if(!t)return;const n=new s.f(t.id,Date.now().toString(),"New Tray");t.addChild(n),t.isFolded=!1,t.updateAppearance(),n.element.focus();const r=n.element.querySelector(".tray-title");n.startTitleEdit(r)}var u=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};function p(){const e=b(o.P.get((0,i.p0)()));if(!e)return void console.error("No data found to export.");const t=new Blob([e],{type:"application/json"}),n=URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download="tray_data.json",r.click(),URL.revokeObjectURL(n)}function f(){const e=document.createElement("input");e.type="file",e.accept=".json",e.onchange=e=>{const t=e.target,n=t.files?t.files[0]:null;if(!n)return;const o=new FileReader;o.onload=e=>{var t;try{const n=null===(t=e.target)||void 0===t?void 0:t.result;return JSON.parse(n),h("imported",n),void h(r,n)}catch(e){return console.error("Invalid JSON file:",e),void alert("無効なJSONファイルです。")}},o.readAsText(n,"UTF-8")},e.click()}function h(){return u(this,arguments,void 0,(function*(e=null,t=null){return new Promise(((a,s)=>{const c=indexedDB.open("TrayDatabase",1);let l;c.onupgradeneeded=e=>{l=c.result,l.objectStoreNames.contains("trays")||l.createObjectStore("trays",{keyPath:"id"})},c.onerror=e=>{s(`Error opening database: ${c.error}`)},c.onsuccess=()=>{l=c.result;const d=(0,i.Vf)("sessionId"),u=(0,i.p0)();if(!u)return void s("Root element not found");const p=o.P.get(u),f=t||b(p);try{const{recordState:e}=n(944);e(f)}catch(e){}if(!f)return void s("Serialize failed");let h;h=e||d||r;const y=l.transaction("trays","readwrite").objectStore("trays").put({id:h,value:f});y.onsuccess=()=>{console.log(h),console.log("Data saved successfully");try{localStorage.setItem(`update_${h}`,Date.now().toString())}catch(e){}a(h)},y.onerror=e=>{s(`Error saving to IndexedDB: ${y.error}`)}}}))}))}function y(){return u(this,arguments,void 0,(function*(e=r){try{const t=yield m(),r=yield function(e,t){return new Promise(((n,r)=>{const o=e.transaction("trays","readonly").objectStore("trays").get(t);o.onsuccess=()=>{n(o.result)},o.onerror=()=>{r(o.error)}}))}(t,e);let o;if(r)try{o=E(r.value)}catch(e){console.error("Error deserializing data:",e),o=(0,i.eb)()}else o=(0,i.eb)();g(o);try{const{recordState:e}=n(944);e(b(o))}catch(e){}}catch(e){console.error("Error loading from IndexedDB:",e);const t=(0,i.eb)();g(t);try{const{recordState:e}=n(944);e(b(t))}catch(e){}}}))}function m(){return new Promise(((e,t)=>{const n=indexedDB.open("TrayDatabase",1);n.onupgradeneeded=e=>{const t=n.result;t.objectStoreNames.contains("trays")||t.createObjectStore("trays",{keyPath:"id"})},n.onsuccess=()=>{e(n.result)},n.onerror=()=>{t(n.error)}}))}function v(){return u(this,void 0,void 0,(function*(){const e=yield m();return new Promise(((t,n)=>{const r=e.transaction("trays","readonly").objectStore("trays").getAllKeys();r.onsuccess=()=>{t(r.result.filter((e=>"string"==typeof e)))},r.onerror=()=>n(r.error)}))}))}function g(e){document.body.innerHTML="",document.body.appendChild(e.element),(0,a.T0)();const t=function(){console.log("Creating action buttons");const e=document.createElement("div");e.classList.add("action-buttons");const t=document.createElement("button");t.textContent="+",t.classList.add("action-button","add-button"),t.addEventListener("click",l);const n=document.createElement("button");return n.textContent="↩",n.classList.add("action-button","insert-button"),n.addEventListener("click",d),e.appendChild(t),e.appendChild(n),console.log("Action buttons created:",e),e}();document.body.appendChild(t)}function b(e){return JSON.stringify(e)}function w(e){return u(this,void 0,void 0,(function*(){return Promise.resolve().then((()=>JSON.stringify(e)))}))}function x(e){var t,n;let r;r=e.host_url?e.host_url:e.url;let o=new s.f(e.parentId,e.id,e.name,e.borderColor,e.created_dt,e.flexDirection,r,e.filename,"boolean"!=typeof e.isFolded||e.isFolded,null!==(t=e.properties)&&void 0!==t?t:{},null!==(n=e.hooks)&&void 0!==n?n:[]);const i=e.children;return i.length>0&&i.slice().reverse().map((e=>x(e))).forEach((e=>o.addChild(e))),o}function E(e){return x(JSON.parse(e))}function C(e){const t=e.split("\n").map((e=>JSON.parse(e))),n=new Map;t.forEach((e=>{var t,r;const o=new s.f(e.parentId,e.id,e.name,e.borderColor,e.created_dt,e.flexDirection,e.host_url,e.filename,e.isFolded,null!==(t=e.properties)&&void 0!==t?t:{},null!==(r=e.hooks)&&void 0!==r?r:[]);n.set(e.id,o);const i=n.get(e.parentId);i&&i.children.push(o)}));const r=function(e){let t=e.get(e.keys().next().value);for(;;){const n=e.get(null==t?void 0:t.parentId);if(!n)break;t=n}return t}(n);return r}function k(e=r){let t;try{const n=localStorage.getItem(e);let r;r=n?JSON.parse(n):i.eb,console.log(r),t=r?E(JSON.stringify(r)):(0,i.eb)(),t.isFolded=!1,t.updateAppearance(),t.updateChildrenAppearance()}catch(e){console.error("Error loading from localStorage:",e),t=(0,i.eb)()}document.body.innerHTML="",document.body.appendChild(t.element),(0,a.T0)()}},973:(e,t,n)=>{n.d(t,{AC:()=>w,CW:()=>m,L:()=>y,N:()=>u,O6:()=>g,U2:()=>d,XF:()=>v,oy:()=>x,zC:()=>p});var r=n(574),o=n(185),i=n(669),a=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))};const s=new Map,c=new Map;function l(e){let t=new Date(e.created_dt).getTime();for(const n of e.children){const e=l(n);e>t&&(t=e)}return t}function d(e){return a(this,void 0,void 0,(function*(){const t=yield(0,r.serializeAsync)(e);if(t===(s.get(e.id)||""))return;let n;try{n=yield v(e)}catch(e){n=void 0}if(n&&l(n)>l(e)){const t=(0,o.yr)(e.parentId);return(0,i.ql)(e),t.addChild(n),t.updateAppearance(),void s.set(e.id,yield(0,r.serializeAsync)(n))}yield m(e),s.set(e.id,t)}))}function u(e){p(e);const t=window.setInterval((()=>{d(e).catch(console.error)}),6e4);c.set(e.id,t)}function p(e){const t=c.get(e.id);void 0!==t&&(clearInterval(t),c.delete(e.id))}function f(e){try{const t=new URL(e);let n=t.origin;return t.pathname&&"/"!==t.pathname&&(n+=t.pathname.replace(/\/$/,"")),n}catch(t){return e.trim().replace(/\/$/,"")}}function h(e){const t=f(e),n=JSON.parse(localStorage.getItem("serverPasswords")||"{}");if(n[t])return n[t];for(const[e,r]of Object.entries(n))if(f(e)===t)return r;return localStorage.getItem("trayPassword")||null}function y(e){const t=localStorage.getItem("defaultServer")||"",n=prompt("Enter server URL:",t);if(!n)return;const o=h(n);o?fetch(`${n}/tray/list_auth`,{method:"GET",headers:{Authorization:o}}).then((e=>{if(401!==e.status){if(!e.ok)throw new Error("Network response was not ok");return e.json()}alert("Authentication failed. Please check your password.")})).then((t=>{t&&function(e,t,n){const o=document.createElement("div");o.classList.add("tray-selection-dialog"),o.innerHTML=`\n        <h3>Select a tray to add:</h3>\n        <select id="tray-select">\n          ${n.map((e=>`<option value="${e}">${e}</option>`)).join("")}\n        </select>\n        <button id="add-tray-btn">Add Tray</button>\n        <button id="cancel-btn">Cancel</button>\n      `,document.body.appendChild(o);const i=document.getElementById("add-tray-btn"),s=document.getElementById("cancel-btn"),c=document.getElementById("tray-select");i.addEventListener("click",(()=>{const n=c.value;!function(e,t,n){a(this,void 0,void 0,(function*(){try{const o=h(t);if(!o)return void alert("No password configured for this server. Please set up server passwords in the hamburger menu.");const i=yield fetch(`${t}/tray/load_auth`,{method:"GET",headers:{Authorization:o,filename:n}});if(401===i.status)return void alert("Authentication failed. Please check your password in the hamburger menu.");if(!i.ok)throw new Error("Network response was not ok");const a=yield i.json();e.addChild((0,r.deserialize)(JSON.stringify(a)))}catch(e){console.error("Error:",e),alert("Failed to add tray from server.")}}))}(e,t,n),o.remove()})),s.addEventListener("click",(()=>{o.remove()}))}(e,n,t.files)})).catch((e=>{console.error("Error:",e),alert("Failed to fetch tray list from server.")})):alert("No password configured for this server. Please set up server passwords in the hamburger menu.")}function m(e){return a(this,void 0,void 0,(function*(){const t=JSON.parse(yield(0,r.serializeAsync)(e));if(!e.host_url)return;if(!e.filename)return;const n=h(e.host_url);if(n)try{const r=yield fetch(`${e.host_url}/tray/upload_auth`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:n,filename:e.filename},body:JSON.stringify({data:t})});if(401===r.status)return void b("Authentication failed. Please check your password in the hamburger menu.",!0);if(!r.ok)throw new Error("Network response was not ok");const o=yield r.text();console.log(o),b("Data uploaded successfully.")}catch(e){throw console.error("Error:",e),b("Failed to upload data.",!0),e}else b("Password is required for secure upload.",!0)}))}function v(e){return a(this,void 0,void 0,(function*(){if(!e.filename)return;if(!e.host_url)return;const t=h(e.host_url);if(t)try{const n=yield fetch(`${e.host_url}/tray/load_auth`,{method:"GET",headers:{Authorization:t,filename:e.filename}});if(401===n.status)return void b("Authentication failed. Please check your password in the hamburger menu.",!0);if(!n.ok)throw new Error("Network response was not ok");const o=yield n.json();return(0,r.deserialize)(JSON.stringify(o))}catch(e){throw console.error("Error:",e),b("Failed to download data.",!0),e}else b("No password configured for this server. Please set up server passwords in the hamburger menu.",!0)}))}function g(e){return a(this,void 0,void 0,(function*(){if(!e.filename||!e.host_url)return;const t=yield(0,r.serializeAsync)(e),n=s.get(e.id);let a;try{a=yield v(e)}catch(e){throw e}if(!n){if(a){const t=(0,o.yr)(e.parentId);(0,i.ql)(e),t.addChild(a),t.updateAppearance(),s.set(e.id,yield(0,r.serializeAsync)(a))}else yield m(e),s.set(e.id,t);return}const c=a?yield(0,r.serializeAsync)(a):"",l=t!==n,d=!!a&&c!==n;if(l&&d)throw new Error("Data conflict");if(d){const t=(0,o.yr)(e.parentId);(0,i.ql)(e),t.addChild(a),t.updateAppearance(),s.set(e.id,c)}else l&&(yield m(e),s.set(e.id,t))}))}function b(e,t=!1){const n=document.createElement("div");n.textContent=e,n.style.position="fixed",n.style.bottom="20px",n.style.right="20px",n.style.padding="10px",n.style.borderRadius="5px",n.style.color="white",n.style.backgroundColor=t?"red":"green",n.style.zIndex="1000",document.body.appendChild(n),setTimeout((()=>{n.style.transition="opacity 0.5s",n.style.opacity="0",setTimeout((()=>{document.body.removeChild(n)}),500)}),3e3)}function w(e){const t=prompt("ホストURLを入力してください (空欄の場合、nullになります):",e.host_url||""),n=prompt("ファイル名を入力してください (空欄の場合、nullになります):",e.filename||"");e.host_url=t?""===t.trim()?null:t:null,e.filename=n?""===n.trim()?null:n:null}function x(e){return a(this,void 0,void 0,(function*(){if(!e.filename)return void b("No filename specified for removal.",!0);if(!e.host_url)return void b("No server URL specified for removal.",!0);const t=h(e.host_url);if(t)try{const n=yield fetch(`${e.host_url}/tray/remove`,{method:"DELETE",headers:{Authorization:t,filename:e.filename}});if(401===n.status)return void b("Authentication failed. Please check your password in the hamburger menu.",!0);if(!n.ok)throw new Error("Network response was not ok");b("File removed from server successfully.")}catch(e){throw console.error("Error:",e),b("Failed to remove file from server.",!0),e}else b("No password configured for this server. Please set up server passwords in the hamburger menu.",!0)}))}},569:(e,t,n)=>{n.d(t,{Ay:()=>l,Go:()=>o});const r=(0,n(816).Z0)({name:"app",initialState:{lastFocused:null,menuOpening:!1,autoUpload:!1},reducers:{setLastFocused(e,t){t.payload.id&&(e.lastFocused=t.payload.id)},toggleMenuOpening(e){e.menuOpening=!e.menuOpening},openMenu(e){e.menuOpening=!0},closeMenu(e){e.menuOpening=!1},toggleAutoUpload(e){e.autoUpload=!e.autoUpload}}}),{setLastFocused:o,toggleMenuOpening:i,openMenu:a,closeMenu:s,toggleAutoUpload:c}=r.actions,l=r.reducer},33:(e,t,n)=>{n.d(t,{A:()=>i});var r=n(816),o=n(569);const i=(0,r.U1)({reducer:{app:o.Ay}})},627:(e,t,n)=>{n.d(t,{f:()=>w});var r=n(185),o=n(574),i=n(271),a=n(973),s=n(859),c=n(669),l=n(33);const d=[{act:"fetchTrayFromServer",label:"Fetch Tray from Server"},{act:"networkSetting",label:"Network Setting"},{act:"removeFromServer",label:"Remove from Server"},{act:"openTrayInOther",label:"Open This in Other"},{act:"toggleFlexDirection",label:"Toggle Flex Direction"},{act:"insertParentTray",label:"Insert Parent Tray"},{act:"insertChildTray",label:"Insert Child Tray"},{act:"meltTray",label:"Melt this Tray"},{act:"expandAll",label:"Expand All"},{act:"expandChildrenOneLevel",label:"Expand Children 1 Level"},{act:"copy",label:"Copy"},{act:"paste",label:"Paste"},{act:"cut",label:"Cut"},{act:"delete",label:"Remove"},{act:"add_fetch_networkTray_to_child",label:"Add Fetch NetworkTray to Child"},{act:"add_child_from_localStorage",label:"Add Child from Local Storage"},{act:"addProperty",label:"Set Property"},{act:"sortChildren",label:"Sort Children"},{act:"copyMarkdown",label:"Copy Markdown"},{act:"downloadMarkdown",label:"Download Markdown"}],u=function(){const e=document.createElement("div");e.className="context-menu",e.tabIndex=-1;for(const t of d){const n=document.createElement("div");n.className="menu-item","dataset"in n||(n.dataset={}),n.dataset.act=t.act,n.textContent=t.label,e.appendChild(n)}const t=document.createElement("div");t.className="menu-item";const n=document.createElement("input");return n.type="color",n.id="borderColorPicker",t.appendChild(n),e.appendChild(t),e}();function p(e,t){u.isConnected||document.body.appendChild(u),u.style.display="block",function(e,t){const n="clientX"in e?{x:e.clientX,y:e.clientY}:{x:e.touches[0].clientX,y:e.touches[0].clientY},{width:r,height:o}=t.getBoundingClientRect();let i=n.x+r>window.innerWidth?n.x-r:n.x,a=n.y+o>window.innerHeight?n.y-o:n.y;i=Math.max(0,i),a=Math.max(0,a),t.style.position="fixed",t.style.left=`${i}px`,t.style.top=`${a}px`,t.style.transform=""}(t,u),function(e){var t;const n=u.querySelector("#borderColorPicker");n.value=null!==(t=e.borderColor)&&void 0!==t?t:"#ffffff",n.onchange=t=>{var n;const r=t.target.value;e.borderColor=r,null===(n=e.changeBorderColor)||void 0===n||n.call(e,r),h()},u.onclick=t=>{const n=t.target.getAttribute("data-act");n&&function(e,t){var n,i,s;switch(t){case"copy":navigator.clipboard.writeText((0,o.serialize)((0,r.g_)(e)));break;case"paste":(0,c.Iz)(e);break;case"cut":navigator.clipboard.writeText((0,o.serialize)((0,r.g_)(e))),(0,c.ql)(e);break;case"delete":(0,c.ql)(e);break;case"networkSetting":(0,a.AC)(e);break;case"meltTray":(0,c.Lg)(e);break;case"expandChildrenOneLevel":(0,r.sN)(e);break;case"toggleFlexDirection":null===(n=e.toggleFlexDirection)||void 0===n||n.call(e);break;case"insertParentTray":null===(i=e.insertParentTray)||void 0===i||i.call(e);break;case"insertChildTray":null===(s=e.insertChildTray)||void 0===s||s.call(e);break;case"copyMarkdown":(0,c.wC)(e);break;case"downloadMarkdown":(0,c.ii)(e);break;case"fetchTrayFromServer":(0,a.L)(e);break;case"removeFromServer":confirm("Are you sure you want to remove this tray from the server?")&&(0,a.oy)(e);break;case"addProperty":{const t=prompt("Property name:","priority")||"priority",n=prompt(`Value for '${t}':`,"");null!==n&&e.addProperty(t,n);break}case"sortChildren":!function(e){const t=new Set;t.add("created_dt"),e.children.forEach((e=>{Object.keys(e.properties).forEach((e=>t.add(e)))}));const n=document.createElement("div");n.classList.add("sort-selection-dialog"),n.innerHTML=`\n      <h3>Sort Children</h3>\n      <label>Property:\n        <select id="sort-prop">\n          ${Array.from(t).map((e=>`<option value="${e}">${e}</option>`)).join("")}\n        </select>\n      </label>\n      <label>Order:\n        <select id="sort-order">\n          <option value="asc" selected>Ascending</option>\n          <option value="desc">Descending</option>\n        </select>\n      </label>\n      <button id="sort-ok">Sort</button>\n      <button id="sort-cancel">Cancel</button>\n    `,document.body.appendChild(n);const r=n.querySelector("#sort-ok"),o=n.querySelector("#sort-cancel");r.addEventListener("click",(()=>{const t=n.querySelector("#sort-prop").value,r=n.querySelector("#sort-order").value;e.sortChildren(t,"desc"===r),n.remove()})),o.addEventListener("click",(()=>n.remove()))}(e);break;default:console.warn(`Unknown context-menu action: ${t}`)}null===o.saveToIndexedDB||void 0===o.saveToIndexedDB||(0,o.saveToIndexedDB)(),h()}(e,n)}}(e),u.focus(),function(){const e=Array.from(u.querySelectorAll(".menu-item"));let t=0;const n=t=>{var n,r;e.forEach((e=>e.classList.remove("focused")));const o=e[t];o.classList.add("focused"),null===(r=(n=o).focus)||void 0===r||r.call(n)};n(t),y=r=>{switch(r.key){case"ArrowDown":r.preventDefault(),t=(t+1)%e.length,n(t);break;case"ArrowUp":r.preventDefault(),t=(t-1+e.length)%e.length,n(t);break;case"Enter":r.preventDefault(),e[t].click();break;case"Escape":r.preventDefault(),h()}},u.addEventListener("keydown",y)}(),console.log("openContextMenu OK");const n=e=>{u.contains(e.target)||(h(),document.removeEventListener("pointerdown",n))};document.addEventListener("pointerdown",n)}function f(e){const t=e.element.getBoundingClientRect();p(e,{clientX:t.left+t.width/2,clientY:t.top+t.height/2})}function h(){u.style.display="none",y&&(u.removeEventListener("keydown",y),y=null),u.querySelectorAll(".menu-item").forEach((e=>e.classList.remove("focused")))}document.body.appendChild(u),u.style.display="none";let y=null;var m=n(944);let v={trayId:"",time:0};function g(e,t){if(e.isEditing)return;if(l.A.getState().app.menuOpening)return;let n;switch(t){case"up":n=function(e){if(e.parentId){const t=(0,r.yr)(e.parentId),n=t.children.indexOf(e);return t.children[n-1]||null}return null}(e);break;case"down":n=function(e){if(e.parentId){const t=(0,r.yr)(e.parentId),n=t.children.indexOf(e);return t.children[n+1]||null}return null}(e);break;case"left":n=(0,r.yr)(e.parentId);break;case"right":n=e.children[0]}n&&n.element.focus()}var b=n(569);class w{constructor(e,t,n,o=null,i=null,a="column",s=null,c=null,l=!0,d={},u=[]){this.id=t,this.name=n,this.children=[],this.parentId=e,this.isFolded=l,this.borderColor=o||(0,r.f4)(),this.created_dt=i?new Date(i):new Date,this.host_url=s,this.filename=c,this.flexDirection=a,this.properties=d,this.hooks=u.length>0?u:this.parseHooksFromName(n),this.autoUpload=!1,this.isEditing=!1,this.isSelected=!1,this._element=null,this.updateAppearance(),this.updateBorderColor(this.borderColor)}get element(){if(!this._element){const e=this.createElement();this._element=e}return this._element}createElement(){const e=document.createElement("div");e.classList.add("tray"),e.setAttribute("draggable","true"),e.setAttribute("data-tray-id",this.id),e.style.display="block";const t=document.createElement("div");t.classList.add("tray-title-container");const n=document.createElement("div");n.classList.add("tray-checkbox-container");const r=document.createElement("span");r.classList.add("tray-created-time"),r.textContent=this.formatCreatedTime(),r.style.fontSize="0.8em",r.style.color="#888";const o=document.createElement("input");o.type="checkbox",o.classList.add("tray-checkbox"),o.checked=this.isSelected,o.addEventListener("change",this.onCheckboxChange.bind(this)),n.appendChild(o);const i=document.createElement("div");i.classList.add("tray-title"),i.setAttribute("contenteditable","false"),this.updateTitleContent(i);const c=document.createElement("button");c.classList.add("tray-context-menu-button"),c.textContent="⋮",c.addEventListener("click",this.onContextMenuButtonClick.bind(this)),i.addEventListener("contextmenu",(e=>{e.stopPropagation(),p(this,e)})),i.addEventListener("dblclick",(e=>{i.setAttribute("contenteditable","true"),e.stopPropagation(),e.target.focus()})),this.setupTitleEditing(i);const d=document.createElement("div");d.classList.add("tray-content"),d.style.flexDirection=this.flexDirection,d.style.overflowY="auto",t.addEventListener("dblclick",this.onDoubleClick.bind(this));const u=document.createElement("button");u.classList.add("tray-fold-button"),u.textContent="▼",u.addEventListener("click",(e=>{1===e.detail?this.toggleFold():2===e.detail&&this.unfoldChildren()}));const f=document.createElement("button");f.classList.add("tray-fold-button-right"),f.textContent="▼",f.addEventListener("click",this.toggleFold.bind(this)),f.style.display="none",t.appendChild(u),t.appendChild(i),t.appendChild(f),t.appendChild(c),t.appendChild(n),e.appendChild(t),e.append(d),e.addEventListener("dragstart",this.onDragStart.bind(this)),e.addEventListener("dragover",this.onDragOver.bind(this)),e.addEventListener("drop",this.onDrop.bind(this)),d.addEventListener("dblclick",this.onDoubleClick.bind(this)),s.P.set(e,this),this.setupKeyboardNavigation(e);const h=document.createElement("div");h.classList.add("network-tray-info");const y=document.createElement("button");y.textContent="URL",this.host_url&&""!==this.host_url.trim()?(y.style.backgroundColor="green",y.style.color="white"):(y.style.backgroundColor="gray",y.style.color="white"),y.title=this.host_url||"No URL set";const m=document.createElement("div");m.textContent=`${this.filename}`,h.appendChild(y),h.appendChild(m);const v=document.createElement("div");v.classList.add("network-tray-buttons"),v.style.display="flex",v.style.flexDirection="column",v.style.alignItems="flex-start",v.style.gap="5px";const g=document.createElement("div");g.classList.add("network-tray-actions");const w=document.createElement("button");w.textContent="↑",w.addEventListener("click",(e=>(0,a.CW)(this)));const x=document.createElement("button");x.textContent="↓",x.addEventListener("click",(()=>{(0,a.O6)(this).catch((e=>alert(e.message)))}));const E=document.createElement("button");return E.textContent="♻️",this.autoUpload&&E.classList.add("auto-upload-on"),E.addEventListener("click",(()=>this.toggleAutoUpload(E))),g.appendChild(w),g.appendChild(x),g.appendChild(E),v.appendChild(h),v.appendChild(g),null!=this.filename?(v.appendChild(r),t.appendChild(v)):t.appendChild(r),t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="space-between",e.addEventListener("focus",(e=>l.A.dispatch((0,b.Go)(this)))),e.addEventListener("click",(e=>{l.A.dispatch((0,b.Go)(this))})),e.addEventListener("touchstart",(e=>{l.A.dispatch((0,b.Go)(this))})),e}setupFocusTracking(e){e.element.addEventListener("focus",(()=>{(0,b.Go)(e)}),!0),e.element.addEventListener("click",(()=>{(0,b.Go)(e)}),!0)}formatCreatedTime(){const e=new Date(this.created_dt);return`${e.toLocaleDateString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit"})}\n${e.toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"})}`}onCheckboxChange(e){const t=e.target.checked;let n=[...i.km];t?n.push(this):n=n.filter((e=>e.id!==this.id)),i.km.length=0,i.km.push(...n),this.isSelected=t}toggleCheckbox(){const e=!this.isSelected;this.isSelected=e;const t=this.element.querySelector(".tray-checkbox");t&&(t.checked=e);const n=i.km.filter((e=>e.id!==this.id));e&&n.push(this),i.km.length=0,i.km.push(...n)}toggleFlexDirection(){this.flexDirection="column"===this.flexDirection?"row":"column",this.updateFlexDirection(),this.updateChildrenAppearance(),(0,o.saveToIndexedDB)()}toggleAutoUpload(e){this.autoUpload=!this.autoUpload,this.autoUpload?(0,a.N)(this):(0,a.zC)(this),e&&(e.textContent="♻️",this.autoUpload?e.classList.add("auto-upload-on"):e.classList.remove("auto-upload-on"))}setupEventListeners(e){let t,n,r;e.addEventListener("touchstart",(e=>{this.isEditing||(n=e.touches[0].clientX,r=e.touches[0].clientY,t=window.setTimeout((()=>{this.showContextMenu(e)}),500))})),e.addEventListener("touchmove",(e=>{this.isEditing||(Math.abs(e.touches[0].clientX-n)>10||Math.abs(e.touches[0].clientY-r)>10)&&clearTimeout(t)})),e.addEventListener("touchend",(()=>{this.isEditing||clearTimeout(t)}))}updateFlexDirection(){const e=this.element.querySelector(".tray-content");e&&(e.style.flexDirection=this.flexDirection,e.style.display="flex")}updateChildrenAppearance(){this.children.forEach((e=>{"row"===this.flexDirection?(e.element.style.boxSizing="border-box",e.element.style.width="calc(50% - 3px)"):e.element.style.width="100%"}))}removeChild(e){this.children=this.children.filter((t=>t.id!==e)),this.updateAppearance()}updateBorderColor(e){const t=this.element;t&&(t.style.borderLeftColor=e,t.style.borderLeftWidth="3px",t.style.borderLeftStyle="solid",t.style.borderBottomColor=e,t.style.borderBottomWidth="3px",t.style.borderBottomStyle="solid")}changeBorderColor(e){this.updateBorderColor(e),(0,o.saveToIndexedDB)()}isValidUrl(e){return/^https?:\/\/\S+/i.test(e)}isImageUrl(e){return!!e.startsWith("data:image/")||/^https?:\/\/\S+\.(png|jpe?g|gif|bmp|svg)(\?.*)?$/i.test(e)}updateTitleContent(e){if(this.isImageUrl(this.name)){const t=document.createElement("img");t.src=this.name,t.alt=this.name,e.innerHTML="",e.appendChild(t)}else if(this.isValidUrl(this.name)){const t=document.createElement("a");t.href=this.name,t.textContent=this.name,t.target="_blank",e.innerHTML="",e.appendChild(t)}else e.textContent=this.name}setupTitleEditing(e){e.addEventListener("dblclick",(t=>{t.stopPropagation(),this.startTitleEdit(e),(0,o.saveToIndexedDB)()}))}toggleFold(){this.isFolded=!this.isFolded,this.foldChildren(),this.updateAppearance(),(0,o.saveToIndexedDB)()}foldChildren(){this.isFolded&&this.children.forEach((e=>{e.isFolded=!0,e.updateAppearance(),e.foldChildren()}))}unfoldChildren(){this.isFolded=!1,this.children.forEach((e=>{e.unfoldChildren()})),this.updateAppearance(),(0,o.saveToIndexedDB)()}updateAppearance(){const e=this.element.querySelector(".tray-content"),t=this.element.querySelector(".tray-fold-button"),n=this.element.querySelector(".tray-fold-button-right");e&&t&&n&&(this.children.length?(t.style.display="inline-block",n.style.display="inline-block",this.isFolded?(e.style.display="none",t.textContent="▶",t.style.display="inline-block",n.textContent="▼",n.style.display="none"):(this.updateBorderColor(this.borderColor),e.style.display="block",t.textContent="▼",t.style.display="none",n.textContent="▶",n.style.display="inline-block",this.updateFlexDirection())):(e.style.display="none",t.style.display="none"))}startTitleEdit(e){this.isEditing=!0,e.setAttribute("contenteditable","true"),e.textContent=this.name;const t=document.createRange();t.selectNodeContents(e);const n=window.getSelection();n&&(n.removeAllRanges(),n.addRange(t)),e.addEventListener("keydown",(t=>{"Enter"!==t.key||t.shiftKey||(t.preventDefault(),e.blur())})),e.addEventListener("blur",(()=>{this.finishTitleEdit(e)}))}cancelTitleEdit(e){this.isEditing=!1,e.setAttribute("contenteditable","false"),this.updateTitleContent(e)}onContextMenuButtonClick(e){e.preventDefault(),e.stopPropagation(),this.showContextMenu(e)}showContextMenu(e){p(this,e)}parseHooksFromName(e){const t=e.match(/@(\w+)/g);return t?t.map((e=>e.substring(1))):[]}finishTitleEdit(e){e.setAttribute("contenteditable","false"),this.name=(e.textContent||"").trim(),this.hooks=this.parseHooksFromName(this.name),this.updateTitleContent(e),this.isEditing=!1,(0,o.saveToIndexedDB)()}onDragStart(e){if(e.stopPropagation(),e.dataTransfer){if(i.km.length>0&&i.km.includes(this)){const t=i.km.map((e=>e.id)).join(",");e.dataTransfer.setData("text/plain",t)}else e.dataTransfer.setData("text/plain",this.id);e.dataTransfer.effectAllowed="move"}}onDragOver(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer&&(e.dataTransfer.dropEffect="move")}setupKeyboardNavigation(e){e.tabIndex=0,e.addEventListener("keydown",(e=>function(e,t){if(!l.A.getState().app.menuOpening)if(t.stopPropagation(),e.isEditing)switch(t.key){case"Enter":t.shiftKey||(t.preventDefault(),e.finishTitleEdit(t.target));break;case"Escape":t.preventDefault(),e.cancelTitleEdit(t.target)}else{if(e.element.focus(),t.ctrlKey&&"ArrowUp"===t.key)return t.preventDefault(),void e.moveUp();if(t.ctrlKey&&"ArrowDown"===t.key)return t.preventDefault(),void e.moveDown();if(t.ctrlKey&&"ArrowRight"===t.key)return t.preventDefault(),void e.indentRight();if(t.ctrlKey&&"ArrowLeft"===t.key)return t.preventDefault(),void e.indentLeft();switch(t.key){case"ArrowUp":t.preventDefault(),g(e,"up");break;case"ArrowDown":t.preventDefault(),g(e,"down");break;case"ArrowLeft":t.preventDefault(),g(e,"left");break;case"ArrowRight":t.preventDefault(),g(e,"right");break;case"Enter":if(t.preventDefault(),t.ctrlKey)e.addNewChild();else if(t.shiftKey)(0,r.Ol)(e);else{const t=Date.now();v.trayId===e.id&&t-v.time<300?e.unfoldChildren():e.toggleFold(),v={trayId:e.id,time:t}}break;case"Delete":t.preventDefault(),t.ctrlKey&&(i.km.length>0?(0,i.jG)():(0,c.ql)(e));break;case"c":t.ctrlKey&&(t.preventDefault(),i.km.length>0?(0,i.$R)():(0,c.Ci)(e));break;case"x":t.ctrlKey&&(t.preventDefault(),i.km.length>0?(0,i.qb)():(0,c.rQ)(e));break;case"v":t.ctrlKey&&(t.preventDefault(),(0,c.Iz)(e));break;case"z":t.ctrlKey&&(t.preventDefault(),(0,m.undo)());break;case"m":if(t.ctrlKey){t.preventDefault(),(0,c.wC)(e);break}case"j":t.ctrlKey&&(t.preventDefault(),e.toggleCheckbox());break;case" ":t.ctrlKey&&(t.preventDefault(),f(e));break;case"ContextMenu":t.preventDefault(),f(e);break;case"F10":t.shiftKey&&(t.preventDefault(),f(e))}}}(this,e)))}addNewChild(){const e=new w(this.id,Date.now().toString(),"New Tray");this.addChild(e),this.isFolded=!1,this.updateAppearance();const t=e.element.querySelector(".tray-title");e.startTitleEdit(t)}onDrop(e){var t;e.preventDefault(),e.stopPropagation(),this.isFolded&&this.toggleFold(),this.updateAppearance();const n=null===(t=e.dataTransfer)||void 0===t?void 0:t.getData("text/plain");if(!n)return;const i=n.split(",").map((e=>(0,r.yr)(e))).filter((e=>!!e)),a=this.element.querySelector(".tray-content");i.forEach((e=>{const t=(0,r.yr)(e.parentId);t&&t.removeChild(e.id),this.children.unshift(e),e.parentId=this.id,a&&a.insertBefore(e.element,a.firstChild),e.element.style.display="block"})),this.isFolded=!1,this.updateAppearance(),(0,o.saveToIndexedDB)()}onDragEnd(e){e.stopPropagation(),this.element.classList.remove("drag-over"),this.element.style.display="block"}onDoubleClick(e){e.stopPropagation();const t=new w(this.id,Date.now().toString(),"New Tray");this.addChild(t),this.isFolded=!1,this.updateAppearance();const n=t.element.querySelector(".tray-title");n&&t.startTitleEdit(n)}onMouseOver(e){}addChild(e){this.children.unshift(e),e.parentId=this.id;const t=this.element.querySelector(".tray-content");if(t&&t.insertBefore(e.element,t.firstChild),1===this.children.length){const e=this.borderColor==(0,r.f4)()?(0,r.NP)():this.borderColor;this.borderColor=e,this.updateBorderColor(this.borderColor),this.updateAppearance()}}moveFocusAfterDelete(e,t){let n;n=e.children.length>0?t<e.children.length?e.children[t].element:e.children[e.children.length-1].element:e.element,n&&n.focus()}add_child_from_localStorage(){const e=prompt("Input the sessionId","");if(!e)return;const t=localStorage.getItem(e);if(t){const e=(0,o.deserialize)(JSON.parse(t));e&&this.addChild(e)}}addProperty(e="priority",t){this.properties[e]=t,(0,o.saveToIndexedDB)()}moveInParent(e){const t=(0,r.yr)(this.parentId);if(!t)return;const n=t.children.indexOf(this),i=n+e;if(-1===n||i<0||i>=t.children.length)return;t.children.splice(n,1),t.children.splice(i,0,this);const a=t.element.querySelector(".tray-content");if(a){const e=t.children[i+1];a.insertBefore(this.element,e?e.element:null)}(0,o.saveToIndexedDB)()}moveUp(){this.moveInParent(-1),this.element.focus()}moveDown(){this.moveInParent(1),this.element.focus()}indentRight(){const e=(0,r.yr)(this.parentId);if(!e)return;const t=e.children.indexOf(this),n=e.children[t+1];n&&(e.removeChild(this.id),n.addChild(this),n.isFolded=!1,n.updateAppearance(),0===e.children.length&&e.updateAppearance(),this.element.focus(),(0,o.saveToIndexedDB)())}indentLeft(){const e=(0,r.yr)(this.parentId);if(!e)return;const t=(0,r.yr)(e.parentId);if(!t)return;const n=t.children.indexOf(e);e.removeChild(this.id),this.parentId=t.id,t.children.splice(n,0,this);const i=t.element.querySelector(".tray-content");if(i&&i.insertBefore(this.element,e.element),1===t.children.length){const e=t.borderColor==(0,r.f4)()?(0,r.NP)():t.borderColor;t.borderColor=e,t.updateBorderColor(t.borderColor)}t.updateAppearance(),this.element.focus(),(0,o.saveToIndexedDB)()}insertParentTray(){const e=(0,r.yr)(this.parentId);if(!e)return;const t=e.children.indexOf(this);if(-1===t)return;const n=new w(e.id,(0,r.lk)(),"New Tray");e.children.splice(t,1,n);const i=e.element.querySelector(".tray-content");i&&i.insertBefore(n.element,this.element),n.addChild(this),e.updateAppearance(),n.isFolded=!1,n.updateAppearance();const a=n.element.querySelector(".tray-title");n.startTitleEdit(a),n.element.focus(),(0,o.saveToIndexedDB)()}insertChildTray(){const e=[...this.children],t=this.element.querySelector(".tray-content");t&&e.forEach((e=>t.removeChild(e.element))),this.children=[];const n=new w(this.id,(0,r.lk)(),"New Tray");this.addChild(n);const i=n.element.querySelector(".tray-content");e.forEach((e=>{e.parentId=n.id,n.children.push(e),i&&i.appendChild(e.element)})),this.updateAppearance(),n.isFolded=!1,n.updateAppearance();const a=n.element.querySelector(".tray-title");n.startTitleEdit(a),n.element.focus(),(0,o.saveToIndexedDB)()}sortChildren(e="created_dt",t=!1){this.children.sort(((n,r)=>{let o,i;return"created_dt"===e?(o=new Date(n.created_dt).getTime(),i=new Date(r.created_dt).getTime()):(o=n.properties[e],i=r.properties[e]),void 0===o&&void 0===i?0:void 0===o?1:void 0===i?-1:o>i?t?-1:1:o<i?t?1:-1:0}));const n=this.element.querySelector(".tray-content");n&&this.children.forEach((e=>{n.appendChild(e.element)})),(0,o.saveToIndexedDB)()}}},185:(e,t,n)=>{n.d(t,{NP:()=>a,Ol:()=>f,Vf:()=>c,eb:()=>d,f4:()=>s,g_:()=>p,lk:()=>u,p0:()=>l,sN:()=>h,yr:()=>i});var r=n(859),o=n(627);function i(e){const t=document.querySelector(`[data-tray-id="${e}"]`);return r.P.get(t)}function a(){let e="#";for(let t=0;t<6;t++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e}function s(){return"#f5f5f5"}function c(e){const t=(new URLSearchParams(window.location.search).get(e)||"").trim();return t||"sessionId"!==e?t:"default"}function l(){return document.querySelector("body > div.tray")||null}function d(){const e=new o.f("0","0","Root Tray"),t=(e.element.querySelector(".tray-content"),new o.f(e.id,u(),"ToDo")),n=new o.f(e.id,u(),"Doing"),r=new o.f(e.id,u(),"Done");return e.addChild(t),e.addChild(n),e.addChild(r),e}function u(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}function p(e){let t=JSON.parse(JSON.stringify(e));return t.id=u(),t}function f(e){const t=e.element.querySelector(".tray-title");t&&("true"===t.getAttribute("contenteditable")?e.finishTitleEdit(t):e.startTitleEdit(t))}function h(e){e.children.forEach((e=>{e.isFolded=!1,e.updateAppearance()}))}},816:(e,t,n)=>{function r(e){return`Minified Redux error #${e}; visit https://redux.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}n.d(t,{U1:()=>ue,Z0:()=>ve});var o=(()=>"function"==typeof Symbol&&Symbol.observable||"@@observable")(),i=()=>Math.random().toString(36).substring(7).split("").join("."),a={INIT:`@@redux/INIT${i()}`,REPLACE:`@@redux/REPLACE${i()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${i()}`};function s(e){if("object"!=typeof e||null===e)return!1;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t||null===Object.getPrototypeOf(e)}function c(e,t,n){if("function"!=typeof e)throw new Error(r(2));if("function"==typeof t&&"function"==typeof n||"function"==typeof n&&"function"==typeof arguments[3])throw new Error(r(0));if("function"==typeof t&&void 0===n&&(n=t,t=void 0),void 0!==n){if("function"!=typeof n)throw new Error(r(1));return n(c)(e,t)}let i=e,l=t,d=new Map,u=d,p=0,f=!1;function h(){u===d&&(u=new Map,d.forEach(((e,t)=>{u.set(t,e)})))}function y(){if(f)throw new Error(r(3));return l}function m(e){if("function"!=typeof e)throw new Error(r(4));if(f)throw new Error(r(5));let t=!0;h();const n=p++;return u.set(n,e),function(){if(t){if(f)throw new Error(r(6));t=!1,h(),u.delete(n),d=null}}}function v(e){if(!s(e))throw new Error(r(7));if(void 0===e.type)throw new Error(r(8));if("string"!=typeof e.type)throw new Error(r(17));if(f)throw new Error(r(9));try{f=!0,l=i(l,e)}finally{f=!1}return(d=u).forEach((e=>{e()})),e}return v({type:a.INIT}),{dispatch:v,subscribe:m,getState:y,replaceReducer:function(e){if("function"!=typeof e)throw new Error(r(10));i=e,v({type:a.REPLACE})},[o]:function(){const e=m;return{subscribe(t){if("object"!=typeof t||null===t)throw new Error(r(11));function n(){const e=t;e.next&&e.next(y())}return n(),{unsubscribe:e(n)}},[o](){return this}}}}}function l(...e){return 0===e.length?e=>e:1===e.length?e[0]:e.reduce(((e,t)=>(...n)=>e(t(...n))))}function d(e){return({dispatch:t,getState:n})=>r=>o=>"function"==typeof o?o(t,n,e):r(o)}var u=d(),p=d,f=Symbol.for("immer-nothing"),h=Symbol.for("immer-draftable"),y=Symbol.for("immer-state");function m(e,...t){throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var v=Object.getPrototypeOf;function g(e){return!!e&&!!e[y]}function b(e){return!!e&&(x(e)||Array.isArray(e)||!!e[h]||!!e.constructor?.[h]||S(e)||T(e))}var w=Object.prototype.constructor.toString();function x(e){if(!e||"object"!=typeof e)return!1;const t=v(e);if(null===t)return!0;const n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return n===Object||"function"==typeof n&&Function.toString.call(n)===w}function E(e,t){0===C(e)?Reflect.ownKeys(e).forEach((n=>{t(n,e[n],e)})):e.forEach(((n,r)=>t(r,n,e)))}function C(e){const t=e[y];return t?t.type_:Array.isArray(e)?1:S(e)?2:T(e)?3:0}function k(e,t){return 2===C(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function _(e,t,n){const r=C(e);2===r?e.set(t,n):3===r?e.add(n):e[t]=n}function S(e){return e instanceof Map}function T(e){return e instanceof Set}function L(e){return e.copy_||e.base_}function D(e,t){if(S(e))return new Map(e);if(T(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const n=x(e);if(!0===t||"class_only"===t&&!n){const t=Object.getOwnPropertyDescriptors(e);delete t[y];let n=Reflect.ownKeys(t);for(let r=0;r<n.length;r++){const o=n[r],i=t[o];!1===i.writable&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(t[o]={configurable:!0,writable:!0,enumerable:i.enumerable,value:e[o]})}return Object.create(v(e),t)}{const t=v(e);if(null!==t&&n)return{...e};const r=Object.create(t);return Object.assign(r,e)}}function A(e,t=!1){return I(e)||g(e)||!b(e)||(C(e)>1&&(e.set=e.add=e.clear=e.delete=P),Object.freeze(e),t&&Object.entries(e).forEach((([e,t])=>A(t,!0)))),e}function P(){m(2)}function I(e){return Object.isFrozen(e)}var O,N={};function F(e){const t=N[e];return t||m(0),t}function M(){return O}function j(e,t){t&&(F("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function R(e){z(e),e.drafts_.forEach($),e.drafts_=null}function z(e){e===O&&(O=e.parent_)}function B(e){return O={drafts_:[],parent_:O,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function $(e){const t=e[y];0===t.type_||1===t.type_?t.revoke_():t.revoked_=!0}function U(e,t){t.unfinalizedDrafts_=t.drafts_.length;const n=t.drafts_[0];return void 0!==e&&e!==n?(n[y].modified_&&(R(t),m(4)),b(e)&&(e=q(t,e),t.parent_||K(t,e)),t.patches_&&F("Patches").generateReplacementPatches_(n[y].base_,e,t.patches_,t.inversePatches_)):e=q(t,n,[]),R(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==f?e:void 0}function q(e,t,n){if(I(t))return t;const r=t[y];if(!r)return E(t,((o,i)=>H(e,r,t,o,i,n))),t;if(r.scope_!==e)return t;if(!r.modified_)return K(e,r.base_,!0),r.base_;if(!r.finalized_){r.finalized_=!0,r.scope_.unfinalizedDrafts_--;const t=r.copy_;let o=t,i=!1;3===r.type_&&(o=new Set(t),t.clear(),i=!0),E(o,((o,a)=>H(e,r,t,o,a,n,i))),K(e,t,!1),n&&e.patches_&&F("Patches").generatePatches_(r,n,e.patches_,e.inversePatches_)}return r.copy_}function H(e,t,n,r,o,i,a){if(g(o)){const a=q(e,o,i&&t&&3!==t.type_&&!k(t.assigned_,r)?i.concat(r):void 0);if(_(n,r,a),!g(a))return;e.canAutoFreeze_=!1}else a&&n.add(o);if(b(o)&&!I(o)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;q(e,o),t&&t.scope_.parent_||"symbol"==typeof r||!Object.prototype.propertyIsEnumerable.call(n,r)||K(e,o)}}function K(e,t,n=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&A(t,n)}var J={get(e,t){if(t===y)return e;const n=L(e);if(!k(n,t))return function(e,t,n){const r=V(t,n);return r?"value"in r?r.value:r.get?.call(e.draft_):void 0}(e,n,t);const r=n[t];return e.finalized_||!b(r)?r:r===X(e.base_,t)?(Y(e),e.copy_[t]=Q(r,e)):r},has:(e,t)=>t in L(e),ownKeys:e=>Reflect.ownKeys(L(e)),set(e,t,n){const r=V(L(e),t);if(r?.set)return r.set.call(e.draft_,n),!0;if(!e.modified_){const r=X(L(e),t),a=r?.[y];if(a&&a.base_===n)return e.copy_[t]=n,e.assigned_[t]=!1,!0;if(((o=n)===(i=r)?0!==o||1/o==1/i:o!=o&&i!=i)&&(void 0!==n||k(e.base_,t)))return!0;Y(e),G(e)}var o,i;return e.copy_[t]===n&&(void 0!==n||t in e.copy_)||Number.isNaN(n)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=n,e.assigned_[t]=!0),!0},deleteProperty:(e,t)=>(void 0!==X(e.base_,t)||t in e.base_?(e.assigned_[t]=!1,Y(e),G(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0),getOwnPropertyDescriptor(e,t){const n=L(e),r=Reflect.getOwnPropertyDescriptor(n,t);return r?{writable:!0,configurable:1!==e.type_||"length"!==t,enumerable:r.enumerable,value:n[t]}:r},defineProperty(){m(11)},getPrototypeOf:e=>v(e.base_),setPrototypeOf(){m(12)}},W={};function X(e,t){const n=e[y];return(n?L(n):e)[t]}function V(e,t){if(!(t in e))return;let n=v(e);for(;n;){const e=Object.getOwnPropertyDescriptor(n,t);if(e)return e;n=v(n)}}function G(e){e.modified_||(e.modified_=!0,e.parent_&&G(e.parent_))}function Y(e){e.copy_||(e.copy_=D(e.base_,e.scope_.immer_.useStrictShallowCopy_))}function Q(e,t){const n=S(e)?F("MapSet").proxyMap_(e,t):T(e)?F("MapSet").proxySet_(e,t):function(e,t){const n=Array.isArray(e),r={type_:n?1:0,scope_:t?t.scope_:M(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let o=r,i=J;n&&(o=[r],i=W);const{revoke:a,proxy:s}=Proxy.revocable(o,i);return r.draft_=s,r.revoke_=a,s}(e,t);return(t?t.scope_:M()).drafts_.push(n),n}function Z(e){if(!b(e)||I(e))return e;const t=e[y];let n;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,n=D(e,t.scope_.immer_.useStrictShallowCopy_)}else n=D(e,!0);return E(n,((e,t)=>{_(n,e,Z(t))})),t&&(t.finalized_=!1),n}E(J,((e,t)=>{W[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),W.deleteProperty=function(e,t){return W.set.call(this,e,t,void 0)},W.set=function(e,t,n){return J.set.call(this,e[0],t,n,e[0])};var ee=new class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,n)=>{if("function"==typeof e&&"function"!=typeof t){const n=t;t=e;const r=this;return function(e=n,...o){return r.produce(e,(e=>t.call(this,e,...o)))}}let r;if("function"!=typeof t&&m(6),void 0!==n&&"function"!=typeof n&&m(7),b(e)){const o=B(this),i=Q(e,void 0);let a=!0;try{r=t(i),a=!1}finally{a?R(o):z(o)}return j(o,n),U(r,o)}if(!e||"object"!=typeof e){if(r=t(e),void 0===r&&(r=e),r===f&&(r=void 0),this.autoFreeze_&&A(r,!0),n){const t=[],o=[];F("Patches").generateReplacementPatches_(e,r,t,o),n(t,o)}return r}m(1)},this.produceWithPatches=(e,t)=>{if("function"==typeof e)return(t,...n)=>this.produceWithPatches(t,(t=>e(t,...n)));let n,r;return[this.produce(e,t,((e,t)=>{n=e,r=t})),n,r]},"boolean"==typeof e?.autoFreeze&&this.setAutoFreeze(e.autoFreeze),"boolean"==typeof e?.useStrictShallowCopy&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){var t;b(e)||m(8),g(e)&&(g(t=e)||m(10),e=Z(t));const n=B(this),r=Q(e,void 0);return r[y].isManual_=!0,z(n),r}finishDraft(e,t){const n=e&&e[y];n&&n.isManual_||m(9);const{scope_:r}=n;return j(r,t),U(void 0,r)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let n;for(n=t.length-1;n>=0;n--){const r=t[n];if(0===r.path.length&&"replace"===r.op){e=r.value;break}}n>-1&&(t=t.slice(n+1));const r=F("Patches").applyPatches_;return g(e)?r(e,t):this.produce(e,(e=>r(e,t)))}},te=ee.produce;ee.produceWithPatches.bind(ee),ee.setAutoFreeze.bind(ee),ee.setUseStrictShallowCopy.bind(ee),ee.applyPatches.bind(ee),ee.createDraft.bind(ee),ee.finishDraft.bind(ee);var ne="undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(0!==arguments.length)return"object"==typeof arguments[0]?l:l.apply(null,arguments)};function re(e,t){function n(...n){if(t){let r=t(...n);if(!r)throw new Error(we(0));return{type:e,payload:r.payload,..."meta"in r&&{meta:r.meta},..."error"in r&&{error:r.error}}}return{type:e,payload:n[0]}}return n.toString=()=>`${e}`,n.type=e,n.match=t=>function(e){return s(e)&&"type"in e&&"string"==typeof e.type}(t)&&t.type===e,n}"undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__;var oe=class e extends Array{constructor(...t){super(...t),Object.setPrototypeOf(this,e.prototype)}static get[Symbol.species](){return e}concat(...e){return super.concat.apply(this,e)}prepend(...t){return 1===t.length&&Array.isArray(t[0])?new e(...t[0].concat(this)):new e(...t.concat(this))}};function ie(e){return b(e)?te(e,(()=>{})):e}function ae(e,t,n){if(e.has(t)){let r=e.get(t);return n.update&&(r=n.update(r,t,e),e.set(t,r)),r}if(!n.insert)throw new Error(we(10));const r=n.insert(t,e);return e.set(t,r),r}var se=()=>function(e){const{thunk:t=!0,immutableCheck:n=!0,serializableCheck:r=!0,actionCreatorCheck:o=!0}=e??{};let i=new oe;return t&&("boolean"==typeof t?i.push(u):i.push(p(t.extraArgument))),i},ce=e=>t=>{setTimeout(t,e)},le="undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame:ce(10),de=e=>function(t){const{autoBatch:n=!0}=t??{};let r=new oe(e);return n&&r.push(((e={type:"raf"})=>t=>(...n)=>{const r=t(...n);let o=!0,i=!1,a=!1;const s=new Set,c="tick"===e.type?queueMicrotask:"raf"===e.type?le:"callback"===e.type?e.queueNotification:ce(e.timeout),l=()=>{a=!1,i&&(i=!1,s.forEach((e=>e())))};return Object.assign({},r,{subscribe(e){const t=r.subscribe((()=>o&&e()));return s.add(e),()=>{t(),s.delete(e)}},dispatch(e){try{return o=!e?.meta?.RTK_autoBatch,i=!o,i&&(a||(a=!0,c(l))),r.dispatch(e)}finally{o=!0}}})})("object"==typeof n?n:void 0)),r};function ue(e){const t=se(),{reducer:n,middleware:o,devTools:i=!0,preloadedState:d,enhancers:u}=e||{};let p,f;if("function"==typeof n)p=n;else{if(!s(n))throw new Error(we(1));p=function(e){const t=Object.keys(e),n={};for(let r=0;r<t.length;r++){const o=t[r];"function"==typeof e[o]&&(n[o]=e[o])}const o=Object.keys(n);let i;try{!function(e){Object.keys(e).forEach((t=>{const n=e[t];if(void 0===n(void 0,{type:a.INIT}))throw new Error(r(12));if(void 0===n(void 0,{type:a.PROBE_UNKNOWN_ACTION()}))throw new Error(r(13))}))}(n)}catch(e){i=e}return function(e={},t){if(i)throw i;let a=!1;const s={};for(let i=0;i<o.length;i++){const c=o[i],l=n[c],d=e[c],u=l(d,t);if(void 0===u)throw t&&t.type,new Error(r(14));s[c]=u,a=a||u!==d}return a=a||o.length!==Object.keys(e).length,a?s:e}}(n)}f="function"==typeof o?o(t):t();let h=l;i&&(h=ne({trace:!1,..."object"==typeof i&&i}));const y=function(...e){return t=>(n,o)=>{const i=t(n,o);let a=()=>{throw new Error(r(15))};const s={getState:i.getState,dispatch:(e,...t)=>a(e,...t)},c=e.map((e=>e(s)));return a=l(...c)(i.dispatch),{...i,dispatch:a}}}(...f),m=de(y);return c(p,d,h(..."function"==typeof u?u(m):m()))}function pe(e){const t={},n=[];let r;const o={addCase(e,n){const r="string"==typeof e?e:e.type;if(!r)throw new Error(we(28));if(r in t)throw new Error(we(29));return t[r]=n,o},addMatcher:(e,t)=>(n.push({matcher:e,reducer:t}),o),addDefaultCase:e=>(r=e,o)};return e(o),[t,n,r]}var fe=Symbol.for("rtk-slice-createasyncthunk");function he(e,t){return`${e}/${t}`}function ye({creators:e}={}){const t=e?.asyncThunk?.[fe];return function(e){const{name:n,reducerPath:r=n}=e;if(!n)throw new Error(we(11));const o=("function"==typeof e.reducers?e.reducers(function(){function e(e,t){return{_reducerDefinitionType:"asyncThunk",payloadCreator:e,...t}}return e.withTypes=()=>e,{reducer:e=>Object.assign({[e.name]:(...t)=>e(...t)}[e.name],{_reducerDefinitionType:"reducer"}),preparedReducer:(e,t)=>({_reducerDefinitionType:"reducerWithPrepare",prepare:e,reducer:t}),asyncThunk:e}}()):e.reducers)||{},i=Object.keys(o),a={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},s={addCase(e,t){const n="string"==typeof e?e:e.type;if(!n)throw new Error(we(12));if(n in a.sliceCaseReducersByType)throw new Error(we(13));return a.sliceCaseReducersByType[n]=t,s},addMatcher:(e,t)=>(a.sliceMatchers.push({matcher:e,reducer:t}),s),exposeAction:(e,t)=>(a.actionCreators[e]=t,s),exposeCaseReducer:(e,t)=>(a.sliceCaseReducersByName[e]=t,s)};function c(){const[t={},n=[],r]="function"==typeof e.extraReducers?pe(e.extraReducers):[e.extraReducers],o={...t,...a.sliceCaseReducersByType};return function(e){let t,[i,s,c]=pe((e=>{for(let t in o)e.addCase(t,o[t]);for(let t of a.sliceMatchers)e.addMatcher(t.matcher,t.reducer);for(let t of n)e.addMatcher(t.matcher,t.reducer);r&&e.addDefaultCase(r)}));if("function"==typeof e)t=()=>ie(e());else{const n=ie(e);t=()=>n}function l(e=t(),n){let r=[i[n.type],...s.filter((({matcher:e})=>e(n))).map((({reducer:e})=>e))];return 0===r.filter((e=>!!e)).length&&(r=[c]),r.reduce(((e,t)=>{if(t){if(g(e)){const r=t(e,n);return void 0===r?e:r}if(b(e))return te(e,(e=>t(e,n)));{const r=t(e,n);if(void 0===r){if(null===e)return e;throw new Error(we(9))}return r}}return e}),e)}return l.getInitialState=t,l}(e.initialState)}i.forEach((r=>{const i=o[r],a={reducerName:r,type:he(n,r),createNotation:"function"==typeof e.reducers};!function(e){return"asyncThunk"===e._reducerDefinitionType}(i)?function({type:e,reducerName:t,createNotation:n},r,o){let i,a;if("reducer"in r){if(n&&!function(e){return"reducerWithPrepare"===e._reducerDefinitionType}(r))throw new Error(we(17));i=r.reducer,a=r.prepare}else i=r;o.addCase(e,i).exposeCaseReducer(t,i).exposeAction(t,a?re(e,a):re(e))}(a,i,s):function({type:e,reducerName:t},n,r,o){if(!o)throw new Error(we(18));const{payloadCreator:i,fulfilled:a,pending:s,rejected:c,settled:l,options:d}=n,u=o(e,i,d);r.exposeAction(t,u),a&&r.addCase(u.fulfilled,a),s&&r.addCase(u.pending,s),c&&r.addCase(u.rejected,c),l&&r.addMatcher(u.settled,l),r.exposeCaseReducer(t,{fulfilled:a||ge,pending:s||ge,rejected:c||ge,settled:l||ge})}(a,i,s,t)}));const l=e=>e,d=new Map;let u;function p(e,t){return u||(u=c()),u(e,t)}function f(){return u||(u=c()),u.getInitialState()}function h(t,n=!1){function r(e){let r=e[t];return void 0===r&&n&&(r=f()),r}function o(t=l){const r=ae(d,n,{insert:()=>new WeakMap});return ae(r,t,{insert:()=>{const r={};for(const[o,i]of Object.entries(e.selectors??{}))r[o]=me(i,t,f,n);return r}})}return{reducerPath:t,getSelectors:o,get selectors(){return o(r)},selectSlice:r}}const y={name:n,reducer:p,actions:a.actionCreators,caseReducers:a.sliceCaseReducersByName,getInitialState:f,...h(r),injectInto(e,{reducerPath:t,...n}={}){const o=t??r;return e.inject({reducerPath:o,reducer:p},n),{...y,...h(o,!0)}}};return y}}function me(e,t,n,r){function o(o,...i){let a=t(o);return void 0===a&&r&&(a=n()),e(a,...i)}return o.unwrapped=e,o}var ve=ye();function ge(){}var{assign:be}=Object;function we(e){return`Minified Redux Toolkit error #${e}; visit https://redux-toolkit.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}Symbol.for("rtk-state-proxy-original")}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(859)})();